{"version":3,"file":"60.js","mappings":"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","sources":["webpack://tableturf-replica/./node_modules/regression/dist/regression.js","webpack://tableturf-replica/./node_modules/uuid/dist/esm-browser/native.js","webpack://tableturf-replica/./node_modules/uuid/dist/esm-browser/rng.js","webpack://tableturf-replica/./node_modules/uuid/dist/esm-browser/stringify.js","webpack://tableturf-replica/./node_modules/uuid/dist/esm-browser/v4.js","webpack://tableturf-replica/./web/2d/pixi/events/EventHandler.ts","webpack://tableturf-replica/./web/2d/pixi/events/PointerHandler.ts","webpack://tableturf-replica/./web/2d/pixi/animations/TargetAnimation.ts","webpack://tableturf-replica/./web/2d/ButtonComponent.ts","webpack://tableturf-replica/./web/2d/ColorPalette.ts","webpack://tableturf-replica/./web/2d/pixi/Scene.ts","webpack://tableturf-replica/./web/scripts/EntryScene.ts","webpack://tableturf-replica/./core/MatrixUtil.ts","webpack://tableturf-replica/./core/Common.ts","webpack://tableturf-replica/./core/MiniGameBoardInfo.ts","webpack://tableturf-replica/./core/Board.ts","webpack://tableturf-replica/./core/Card.ts","webpack://tableturf-replica/./core/Utils.ts","webpack://tableturf-replica/./core/Deck.ts","webpack://tableturf-replica/./core/GameState.ts","webpack://tableturf-replica/./core/GameController.ts","webpack://tableturf-replica/./web/2d/GridComponent.ts","webpack://tableturf-replica/./web/2d/pixi/RenderBuffer.ts","webpack://tableturf-replica/./web/2d/EmptySpaceTexture.ts","webpack://tableturf-replica/./web/2d/SpFireTexture.ts","webpack://tableturf-replica/./web/shaders/SpFire.glsl","webpack://tableturf-replica/./web/2d/OverlayTexture.ts","webpack://tableturf-replica/./web/shaders/SpaceOverlay.glsl","webpack://tableturf-replica/./web/2d/pixi/events/DragHandler.ts","webpack://tableturf-replica/./web/2d/BoardComponent.ts","webpack://tableturf-replica/./web/2d/CardGridComponent.ts","webpack://tableturf-replica/./web/2d/pixi/animations/PulseAnimation.ts","webpack://tableturf-replica/./web/2d/CardInteractions.ts","webpack://tableturf-replica/./web/shaders/HoverGlow.glsl","webpack://tableturf-replica/./web/2d/SmallCardComponent.ts","webpack://tableturf-replica/./web/2d/HandComponent.ts","webpack://tableturf-replica/./web/2d/SpCutInAnimation.ts","webpack://tableturf-replica/./web/shaders/SpCutInBg.glsl","webpack://tableturf-replica/./web/shaders/SpCutInImg.glsl","webpack://tableturf-replica/./web/2d/SzMeterComponent.ts","webpack://tableturf-replica/./web/2d/CardComponent.ts","webpack://tableturf-replica/./web/2d/GamePlayCardComponent.ts","webpack://tableturf-replica/./web/2d/TurnMeterComponent.ts","webpack://tableturf-replica/./web/shaders/Blend.glsl","webpack://tableturf-replica/./web/2d/pixi/events/WheelHandler.ts","webpack://tableturf-replica/./web/2d/SpMeterComponent.ts","webpack://tableturf-replica/./web/scripts/GamePlayScene.ts","webpack://tableturf-replica/./web/scripts/InkResetAnimation.ts","webpack://tableturf-replica/./web/shaders/InkReset.glsl","webpack://tableturf-replica/./web/2d/ItemListComponent.ts","webpack://tableturf-replica/./web/scripts/DeckEditScene.ts","webpack://tableturf-replica/./web/Main.ts"],"sourcesContent":["(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define(['module'], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(module);\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(mod);\n    global.regression = mod.exports;\n  }\n})(this, function (module) {\n  'use strict';\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  var _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  function _toConsumableArray(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n        arr2[i] = arr[i];\n      }\n\n      return arr2;\n    } else {\n      return Array.from(arr);\n    }\n  }\n\n  var DEFAULT_OPTIONS = { order: 2, precision: 2, period: null };\n\n  /**\n  * Determine the coefficient of determination (r^2) of a fit from the observations\n  * and predictions.\n  *\n  * @param {Array<Array<number>>} data - Pairs of observed x-y values\n  * @param {Array<Array<number>>} results - Pairs of observed predicted x-y values\n  *\n  * @return {number} - The r^2 value, or NaN if one cannot be calculated.\n  */\n  function determinationCoefficient(data, results) {\n    var predictions = [];\n    var observations = [];\n\n    data.forEach(function (d, i) {\n      if (d[1] !== null) {\n        observations.push(d);\n        predictions.push(results[i]);\n      }\n    });\n\n    var sum = observations.reduce(function (a, observation) {\n      return a + observation[1];\n    }, 0);\n    var mean = sum / observations.length;\n\n    var ssyy = observations.reduce(function (a, observation) {\n      var difference = observation[1] - mean;\n      return a + difference * difference;\n    }, 0);\n\n    var sse = observations.reduce(function (accum, observation, index) {\n      var prediction = predictions[index];\n      var residual = observation[1] - prediction[1];\n      return accum + residual * residual;\n    }, 0);\n\n    return 1 - sse / ssyy;\n  }\n\n  /**\n  * Determine the solution of a system of linear equations A * x = b using\n  * Gaussian elimination.\n  *\n  * @param {Array<Array<number>>} input - A 2-d matrix of data in row-major form [ A | b ]\n  * @param {number} order - How many degrees to solve for\n  *\n  * @return {Array<number>} - Vector of normalized solution coefficients matrix (x)\n  */\n  function gaussianElimination(input, order) {\n    var matrix = input;\n    var n = input.length - 1;\n    var coefficients = [order];\n\n    for (var i = 0; i < n; i++) {\n      var maxrow = i;\n      for (var j = i + 1; j < n; j++) {\n        if (Math.abs(matrix[i][j]) > Math.abs(matrix[i][maxrow])) {\n          maxrow = j;\n        }\n      }\n\n      for (var k = i; k < n + 1; k++) {\n        var tmp = matrix[k][i];\n        matrix[k][i] = matrix[k][maxrow];\n        matrix[k][maxrow] = tmp;\n      }\n\n      for (var _j = i + 1; _j < n; _j++) {\n        for (var _k = n; _k >= i; _k--) {\n          matrix[_k][_j] -= matrix[_k][i] * matrix[i][_j] / matrix[i][i];\n        }\n      }\n    }\n\n    for (var _j2 = n - 1; _j2 >= 0; _j2--) {\n      var total = 0;\n      for (var _k2 = _j2 + 1; _k2 < n; _k2++) {\n        total += matrix[_k2][_j2] * coefficients[_k2];\n      }\n\n      coefficients[_j2] = (matrix[n][_j2] - total) / matrix[_j2][_j2];\n    }\n\n    return coefficients;\n  }\n\n  /**\n  * Round a number to a precision, specificed in number of decimal places\n  *\n  * @param {number} number - The number to round\n  * @param {number} precision - The number of decimal places to round to:\n  *                             > 0 means decimals, < 0 means powers of 10\n  *\n  *\n  * @return {numbr} - The number, rounded\n  */\n  function round(number, precision) {\n    var factor = Math.pow(10, precision);\n    return Math.round(number * factor) / factor;\n  }\n\n  /**\n  * The set of all fitting methods\n  *\n  * @namespace\n  */\n  var methods = {\n    linear: function linear(data, options) {\n      var sum = [0, 0, 0, 0, 0];\n      var len = 0;\n\n      for (var n = 0; n < data.length; n++) {\n        if (data[n][1] !== null) {\n          len++;\n          sum[0] += data[n][0];\n          sum[1] += data[n][1];\n          sum[2] += data[n][0] * data[n][0];\n          sum[3] += data[n][0] * data[n][1];\n          sum[4] += data[n][1] * data[n][1];\n        }\n      }\n\n      var run = len * sum[2] - sum[0] * sum[0];\n      var rise = len * sum[3] - sum[0] * sum[1];\n      var gradient = run === 0 ? 0 : round(rise / run, options.precision);\n      var intercept = round(sum[1] / len - gradient * sum[0] / len, options.precision);\n\n      var predict = function predict(x) {\n        return [round(x, options.precision), round(gradient * x + intercept, options.precision)];\n      };\n\n      var points = data.map(function (point) {\n        return predict(point[0]);\n      });\n\n      return {\n        points: points,\n        predict: predict,\n        equation: [gradient, intercept],\n        r2: round(determinationCoefficient(data, points), options.precision),\n        string: intercept === 0 ? 'y = ' + gradient + 'x' : 'y = ' + gradient + 'x + ' + intercept\n      };\n    },\n    exponential: function exponential(data, options) {\n      var sum = [0, 0, 0, 0, 0, 0];\n\n      for (var n = 0; n < data.length; n++) {\n        if (data[n][1] !== null) {\n          sum[0] += data[n][0];\n          sum[1] += data[n][1];\n          sum[2] += data[n][0] * data[n][0] * data[n][1];\n          sum[3] += data[n][1] * Math.log(data[n][1]);\n          sum[4] += data[n][0] * data[n][1] * Math.log(data[n][1]);\n          sum[5] += data[n][0] * data[n][1];\n        }\n      }\n\n      var denominator = sum[1] * sum[2] - sum[5] * sum[5];\n      var a = Math.exp((sum[2] * sum[3] - sum[5] * sum[4]) / denominator);\n      var b = (sum[1] * sum[4] - sum[5] * sum[3]) / denominator;\n      var coeffA = round(a, options.precision);\n      var coeffB = round(b, options.precision);\n      var predict = function predict(x) {\n        return [round(x, options.precision), round(coeffA * Math.exp(coeffB * x), options.precision)];\n      };\n\n      var points = data.map(function (point) {\n        return predict(point[0]);\n      });\n\n      return {\n        points: points,\n        predict: predict,\n        equation: [coeffA, coeffB],\n        string: 'y = ' + coeffA + 'e^(' + coeffB + 'x)',\n        r2: round(determinationCoefficient(data, points), options.precision)\n      };\n    },\n    logarithmic: function logarithmic(data, options) {\n      var sum = [0, 0, 0, 0];\n      var len = data.length;\n\n      for (var n = 0; n < len; n++) {\n        if (data[n][1] !== null) {\n          sum[0] += Math.log(data[n][0]);\n          sum[1] += data[n][1] * Math.log(data[n][0]);\n          sum[2] += data[n][1];\n          sum[3] += Math.pow(Math.log(data[n][0]), 2);\n        }\n      }\n\n      var a = (len * sum[1] - sum[2] * sum[0]) / (len * sum[3] - sum[0] * sum[0]);\n      var coeffB = round(a, options.precision);\n      var coeffA = round((sum[2] - coeffB * sum[0]) / len, options.precision);\n\n      var predict = function predict(x) {\n        return [round(x, options.precision), round(round(coeffA + coeffB * Math.log(x), options.precision), options.precision)];\n      };\n\n      var points = data.map(function (point) {\n        return predict(point[0]);\n      });\n\n      return {\n        points: points,\n        predict: predict,\n        equation: [coeffA, coeffB],\n        string: 'y = ' + coeffA + ' + ' + coeffB + ' ln(x)',\n        r2: round(determinationCoefficient(data, points), options.precision)\n      };\n    },\n    power: function power(data, options) {\n      var sum = [0, 0, 0, 0, 0];\n      var len = data.length;\n\n      for (var n = 0; n < len; n++) {\n        if (data[n][1] !== null) {\n          sum[0] += Math.log(data[n][0]);\n          sum[1] += Math.log(data[n][1]) * Math.log(data[n][0]);\n          sum[2] += Math.log(data[n][1]);\n          sum[3] += Math.pow(Math.log(data[n][0]), 2);\n        }\n      }\n\n      var b = (len * sum[1] - sum[0] * sum[2]) / (len * sum[3] - Math.pow(sum[0], 2));\n      var a = (sum[2] - b * sum[0]) / len;\n      var coeffA = round(Math.exp(a), options.precision);\n      var coeffB = round(b, options.precision);\n\n      var predict = function predict(x) {\n        return [round(x, options.precision), round(round(coeffA * Math.pow(x, coeffB), options.precision), options.precision)];\n      };\n\n      var points = data.map(function (point) {\n        return predict(point[0]);\n      });\n\n      return {\n        points: points,\n        predict: predict,\n        equation: [coeffA, coeffB],\n        string: 'y = ' + coeffA + 'x^' + coeffB,\n        r2: round(determinationCoefficient(data, points), options.precision)\n      };\n    },\n    polynomial: function polynomial(data, options) {\n      var lhs = [];\n      var rhs = [];\n      var a = 0;\n      var b = 0;\n      var len = data.length;\n      var k = options.order + 1;\n\n      for (var i = 0; i < k; i++) {\n        for (var l = 0; l < len; l++) {\n          if (data[l][1] !== null) {\n            a += Math.pow(data[l][0], i) * data[l][1];\n          }\n        }\n\n        lhs.push(a);\n        a = 0;\n\n        var c = [];\n        for (var j = 0; j < k; j++) {\n          for (var _l = 0; _l < len; _l++) {\n            if (data[_l][1] !== null) {\n              b += Math.pow(data[_l][0], i + j);\n            }\n          }\n          c.push(b);\n          b = 0;\n        }\n        rhs.push(c);\n      }\n      rhs.push(lhs);\n\n      var coefficients = gaussianElimination(rhs, k).map(function (v) {\n        return round(v, options.precision);\n      });\n\n      var predict = function predict(x) {\n        return [round(x, options.precision), round(coefficients.reduce(function (sum, coeff, power) {\n          return sum + coeff * Math.pow(x, power);\n        }, 0), options.precision)];\n      };\n\n      var points = data.map(function (point) {\n        return predict(point[0]);\n      });\n\n      var string = 'y = ';\n      for (var _i = coefficients.length - 1; _i >= 0; _i--) {\n        if (_i > 1) {\n          string += coefficients[_i] + 'x^' + _i + ' + ';\n        } else if (_i === 1) {\n          string += coefficients[_i] + 'x + ';\n        } else {\n          string += coefficients[_i];\n        }\n      }\n\n      return {\n        string: string,\n        points: points,\n        predict: predict,\n        equation: [].concat(_toConsumableArray(coefficients)).reverse(),\n        r2: round(determinationCoefficient(data, points), options.precision)\n      };\n    }\n  };\n\n  function createWrapper() {\n    var reduce = function reduce(accumulator, name) {\n      return _extends({\n        _round: round\n      }, accumulator, _defineProperty({}, name, function (data, supplied) {\n        return methods[name](data, _extends({}, DEFAULT_OPTIONS, supplied));\n      }));\n    };\n\n    return Object.keys(methods).reduce(reduce, {});\n  }\n\n  module.exports = createWrapper();\n});\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase();\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","import { v4 } from \"uuid\";\r\nimport { Component } from \"../Component\";\r\n\r\nexport class EventHandler {\r\n  readonly id = v4();\r\n  readonly stops: EventType[] = [];\r\n  allowFire: boolean = true;\r\n\r\n  constructor(readonly type: EventType, readonly sender: Component) {}\r\n\r\n  get name() {\r\n    return `${this.type}(${this.id})`;\r\n  }\r\n\r\n  _bootstrap(): EventHandler {\r\n    return Object.setPrototypeOf({}, this);\r\n  }\r\n\r\n  _pointermove(pos: Coordinate): EventHandler {\r\n    return null;\r\n  }\r\n\r\n  _pointerdown(pos: Coordinate): EventHandler {\r\n    return null;\r\n  }\r\n\r\n  _pointerup(pos: Coordinate): EventHandler {\r\n    return null;\r\n  }\r\n\r\n  _wheel(evt: WheelEvent): EventHandler {\r\n    return null;\r\n  }\r\n}\r\n","import { Component } from \"../Component\";\r\nimport { Platform } from \"../Platform\";\r\nimport { EventHandler } from \"./EventHandler\";\r\nimport { hitTest } from \"./Utils\";\r\n\r\nexport class PointerHandler extends EventHandler {\r\n  readonly triggerThresholdPx: number = 5;\r\n  readonly doubleTapThresholdMs: number = 500;\r\n\r\n  private _first: boolean = true;\r\n  private _pos: Coordinate = null;\r\n  private _lastTapTime: number = null;\r\n\r\n  constructor(sender: Component) {\r\n    super(\"pointer\", sender);\r\n  }\r\n\r\n  enter(pos: Coordinate) {}\r\n\r\n  move(pos: Coordinate) {}\r\n\r\n  down(pos: Coordinate) {}\r\n\r\n  up(pos: Coordinate) {}\r\n\r\n  tap(pos: Coordinate) {}\r\n\r\n  doubleTap(pos: Coordinate) {}\r\n\r\n  leave(pos: Coordinate) {}\r\n\r\n  _pointermove(pos: Coordinate): EventHandler {\r\n    if (!hitTest(pos, this.sender)) {\r\n      return this._pointerout(pos);\r\n    }\r\n    if (this._first) {\r\n      this._first = false;\r\n      this.enter(pos);\r\n    } else {\r\n      this.move(pos);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  _pointerout(pos: Coordinate): EventHandler {\r\n    this.leave(pos);\r\n    return null;\r\n  }\r\n\r\n  _pointerdown(pos: Coordinate): EventHandler {\r\n    if (!hitTest(pos, this.sender)) {\r\n      return this._pointerout(pos);\r\n    }\r\n    this.down(pos);\r\n    if (this._pos == null) {\r\n      this._pos = { x: pos.x, y: pos.y };\r\n    }\r\n    return this;\r\n  }\r\n\r\n  _pointerup(pos: Coordinate): EventHandler {\r\n    if (!hitTest(pos, this.sender)) {\r\n      return this._pointerout(pos);\r\n    }\r\n    this.up(pos);\r\n    if (this._pos != null) {\r\n      const d = Math.sqrt(\r\n        (pos.x - this._pos.x) ** 2 + (pos.y - this._pos.y) ** 2\r\n      );\r\n      this._pos = null;\r\n      if (d < this.triggerThresholdPx) {\r\n        this.tap(pos);\r\n        const time = performance.now();\r\n        if (\r\n          this._lastTapTime != null &&\r\n          time - this._lastTapTime < this.doubleTapThresholdMs\r\n        ) {\r\n          this.doubleTap(pos);\r\n          this._lastTapTime = null;\r\n        } else {\r\n          this._lastTapTime = time;\r\n        }\r\n      }\r\n    }\r\n    // if (Platform.isMobile) {\r\n    //   return this._pointerout(pos);\r\n    // }\r\n    return this;\r\n  }\r\n}\r\n","import { EaseFunc } from \"./Ease\";\r\n\r\nexport class TargetAnimation<T> {\r\n  private mUpdateFunc: (v: T) => void = () => {};\r\n  private mTargetFunc: (v: T) => void = () => {};\r\n  private mEaseSec = 0;\r\n  private mEaseFunc: EaseFunc = EaseFunc.LINEAR;\r\n  private mEaseState = { cancel: false };\r\n  private mTargetValue: T;\r\n\r\n  private constructor(private v: T) {\r\n    this.mTargetValue = v;\r\n  }\r\n\r\n  get value() {\r\n    return this.v;\r\n  }\r\n\r\n  get targetValue() {\r\n    return this.mTargetValue;\r\n  }\r\n\r\n  onUpdate(func: (v: T) => void): this {\r\n    this.mUpdateFunc = func;\r\n    return this;\r\n  }\r\n\r\n  onTarget(func: (v: T) => void): this {\r\n    this.mTargetFunc = func;\r\n    return this;\r\n  }\r\n\r\n  onEase(sec: number, func: EaseFunc = EaseFunc.LINEAR): this {\r\n    this.mEaseSec = sec;\r\n    this.mEaseFunc = func;\r\n    return this;\r\n  }\r\n\r\n  update(v1: T, sec?: number): Promise<void> {\r\n    this.mTargetValue = v1;\r\n    this.mTargetFunc(v1);\r\n\r\n    this.mEaseState.cancel = true;\r\n    this.mEaseState = { cancel: false };\r\n\r\n    let resolve: () => void;\r\n    const p = new Promise<void>((_resolve) => {\r\n      resolve = _resolve;\r\n    });\r\n\r\n    let t0: number = null;\r\n    if (sec == null) {\r\n      sec = this.mEaseSec;\r\n    }\r\n\r\n    const { mEaseFunc, mUpdateFunc, mEaseState, v: v0 } = this;\r\n    const fn = (t: number) => {\r\n      let nextFn: any = () => resolve();\r\n      if (!mEaseState.cancel) {\r\n        if (t0 == null) {\r\n          t0 = t;\r\n        }\r\n        t = (t - t0) / (1000 * sec);\r\n        if (isNaN(t) || t >= 1) {\r\n          this.v = v1;\r\n        } else {\r\n          this.v = mEaseFunc.interpolate(v0, v1, t);\r\n          nextFn = fn;\r\n        }\r\n      }\r\n      mUpdateFunc(this.v);\r\n      window.requestAnimationFrame(nextFn);\r\n    };\r\n    fn(window.performance.now());\r\n\r\n    return p;\r\n  }\r\n\r\n  static of<U>(value: U): TargetAnimation<U> {\r\n    return new TargetAnimation(value);\r\n  }\r\n}\r\n","import { Color } from \"./pixi/Color\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\nimport { PointerHandler } from \"./pixi/events/PointerHandler\";\r\nimport { TargetAnimation } from \"./pixi/animations/TargetAnimation\";\r\n\r\ninterface IButtonComponentOptions {\r\n  width?: number;\r\n  height?: number;\r\n  radius?: number;\r\n}\r\n\r\ninterface IButtonComponentProps {\r\n  color: Color;\r\n  text: string;\r\n}\r\n\r\nexport class ButtonComponent extends Component<IButtonComponentProps> {\r\n  constructor(options?: IButtonComponentOptions) {\r\n    super({\r\n      color: Color.BLACK,\r\n      text: \"btn\",\r\n    });\r\n\r\n    const { width = 300, height = 100, radius = 0 } = options || {};\r\n    this.layout = { width, height };\r\n\r\n    const bg = this.addGraphics()\r\n      .beginFill(Color.WHITE.i32)\r\n      .drawRoundedRect(0, 0, width, height, radius);\r\n\r\n    const dx = 2,\r\n      dy = 2;\r\n    const text1 = this.addText({\r\n      anchor: 0.5,\r\n      x: width / 2 + dx,\r\n      y: height / 2 + dy,\r\n      style: {\r\n        fontSize: height / 3,\r\n        fontFamily: \"Splatoon\",\r\n        fill: Color.BLACK.i32,\r\n      },\r\n    });\r\n    const text = this.addText({\r\n      anchor: 0.5,\r\n      x: width / 2,\r\n      y: height / 2,\r\n      style: {\r\n        fontSize: height / 3,\r\n        fontFamily: \"Splatoon\",\r\n        fill: Color.WHITE.i32,\r\n      },\r\n    });\r\n\r\n    const overlay = this.addGraphics()\r\n      .beginFill(Color.WHITE.i32)\r\n      .drawRoundedRect(0, 0, width, height, radius);\r\n    overlay.alpha = 0;\r\n\r\n    this.anchor.set(0.5);\r\n\r\n    const scale = TargetAnimation.of(1)\r\n      .onEase(0.1, EaseFunc.EASE_IN_OUT_CUBIC)\r\n      .onUpdate((v) => this.scale.set(v));\r\n\r\n    const alpha = TargetAnimation.of(0)\r\n      .onEase(0.1, EaseFunc.EASE_IN_OUT_CUBIC)\r\n      .onUpdate((v) => (overlay.alpha = v));\r\n\r\n    this.handle(\r\n      class extends PointerHandler {\r\n        enter(pos: Coordinate): void {\r\n          scale.update(1.03);\r\n          alpha.update(0.2);\r\n        }\r\n\r\n        leave(pos: Coordinate): void {\r\n          scale.update(1);\r\n          alpha.update(0);\r\n        }\r\n      }\r\n    );\r\n\r\n    this.props.color.onUpdate((v) => (bg.tint = v.i32));\r\n    this.props.text.onUpdate((v) => (text1.text = text.text = v));\r\n  }\r\n}\r\n","import { Color } from \"./pixi/Color\";\r\n\r\ninterface PlayerColorPalette {\r\n  primary: Color;\r\n  secondary: Color;\r\n  fire: {\r\n    center: Color;\r\n    primary: Color;\r\n    secondary: Color;\r\n  };\r\n  spCutIn: {\r\n    fg: {\r\n      primary: Color;\r\n      secondary: Color;\r\n    };\r\n    bg: Color;\r\n    ink: Color;\r\n    img: Color;\r\n  };\r\n  szMeter: {\r\n    fg: Color;\r\n    bg: Color;\r\n  };\r\n}\r\n\r\nexport class ColorPalette {\r\n  static readonly Space = {\r\n    overlay: {\r\n      normal: Color.fromRgb01([0.81, 0.89, 0.15]),\r\n      special: Color.fromRgb01([0.86, 0.59, 0.15]),\r\n      invalid: Color.fromRgb01([0.78, 0.78, 0.78]),\r\n    },\r\n    flash: {\r\n      primary: Color.WHITE,\r\n      secondary: Color.fromRgb01([1, 1, 0.6]),\r\n    },\r\n  };\r\n\r\n  static readonly Main = {\r\n    bg: {\r\n      primary: Color.fromHex(0x4838a3),\r\n      // primary: Color.fromRgb255([74, 43, 207]),\r\n      // secondary: Color.fromRgb255([69, 72, 58]),\r\n    },\r\n    activeBtn: Color.fromHex(0xd2e332),\r\n    inactiveBtn: Color.fromHex(0x8f8e96),\r\n    btn: Color.fromHex(0x5651e1),\r\n  };\r\n\r\n  static readonly Player1: PlayerColorPalette = {\r\n    primary: Color.fromHex(0xeef900),\r\n    secondary: Color.fromHex(0xffa904),\r\n    fire: {\r\n      center: Color.fromHex(0xfefe05),\r\n      primary: Color.fromRgb01([1.0, 0.9, 0.0]),\r\n      secondary: Color.fromRgb01([0.97, 0.72, 0.02]),\r\n    },\r\n    spCutIn: {\r\n      fg: {\r\n        primary: Color.fromHex(0xb5ee2f),\r\n        secondary: Color.fromHex(0xeaff3a),\r\n      },\r\n      bg: Color.fromHex(0x97d84c),\r\n      ink: Color.fromHex(0xe8ffca),\r\n      img: Color.fromHex(0xe9ff32),\r\n    },\r\n    szMeter: {\r\n      bg: Color.fromHex(0x969f48),\r\n      fg: Color.fromHex(0xe6fe6a),\r\n    },\r\n  };\r\n\r\n  static readonly Player2: PlayerColorPalette = {\r\n    primary: Color.fromHex(0x485aff),\r\n    secondary: Color.fromHex(0x09ecff),\r\n    fire: {\r\n      center: Color.fromHex(0xfcfcfc),\r\n      primary: Color.fromRgb255([240, 255, 252]),\r\n      secondary: Color.fromRgb255([170, 251, 255]),\r\n    },\r\n    spCutIn: {\r\n      fg: {\r\n        primary: Color.fromHex(0x4732c6),\r\n        secondary: Color.fromHex(0x5f3aff),\r\n      },\r\n      bg: Color.fromHex(0x5827a3),\r\n      ink: Color.fromHex(0xb588fd),\r\n      img: Color.fromHex(0x5011ff),\r\n    },\r\n    szMeter: {\r\n      bg: Color.fromHex(0x2d1883),\r\n      fg: Color.fromHex(0x8255fd),\r\n    },\r\n  };\r\n}\r\n","import { Sprite, Texture } from \"pixi.js\";\r\nimport { Color } from \"./Color\";\r\nimport { Component } from \"./Component\";\r\n\r\nexport interface SceneRoot {\r\n  canvas: Component;\r\n  parent: HTMLElement;\r\n}\r\n\r\nexport interface Scene {\r\n  mount(root: SceneRoot): void;\r\n\r\n  toggleVisibility(ok: boolean): void;\r\n\r\n  run(): Promise<any>;\r\n}\r\n\r\nexport interface LoadingAnimation extends Scene {\r\n  play<T>(payload: () => Promise<T>): Promise<T>;\r\n}\r\n\r\ninterface IPixiSceneProps {\r\n  bgTint: Color;\r\n  bgAlpha: number;\r\n}\r\n\r\nexport class PixiScene extends Component<IPixiSceneProps> implements Scene {\r\n  protected readonly bg: Sprite;\r\n\r\n  constructor(props: Partial<IPixiSceneProps> = {}) {\r\n    super(\r\n      Object.assign(\r\n        {},\r\n        {\r\n          bgTint: Color.fromHex(0xffffff),\r\n          bgAlpha: 1,\r\n        },\r\n        props\r\n      )\r\n    );\r\n\r\n    this.bg = this.addSprite({\r\n      texture: Texture.WHITE,\r\n      zIndex: -1e5,\r\n    });\r\n    setTimeout(() => {\r\n      this.bg.width = this.layout.width;\r\n      this.bg.height = this.layout.height;\r\n    }, 0);\r\n\r\n    this.props.bgTint.onUpdate((v) => (this.bg.tint = v.i32));\r\n    this.props.bgAlpha.onUpdate((v) => (this.bg.alpha = v));\r\n  }\r\n\r\n  mount(root: SceneRoot) {\r\n    const { canvas } = root;\r\n    this.position.set(0);\r\n    this.scaleToFit(canvas.layout.width, canvas.layout.height);\r\n    canvas.addChild(this);\r\n  }\r\n\r\n  toggleVisibility(ok: boolean) {\r\n    this.ui.visible = ok;\r\n  }\r\n\r\n  async run() {}\r\n}\r\n\r\nexport class HtmlScene implements Scene {\r\n  protected readonly root: HTMLElement;\r\n\r\n  constructor() {\r\n    this.root = document.createElement(\"div\");\r\n    this.root.classList.add(\"fill-parent\");\r\n  }\r\n\r\n  mount(root: SceneRoot) {\r\n    const { parent } = root;\r\n    parent.appendChild(this.root);\r\n  }\r\n\r\n  toggleVisibility(ok: boolean) {\r\n    if (ok) {\r\n      this.root.classList.add(\"hidden\");\r\n    } else {\r\n      this.root.classList.remove(\"hidden\");\r\n    }\r\n  }\r\n\r\n  async run() {}\r\n}\r\n","import { ButtonComponent } from \"../2d/ButtonComponent\";\r\nimport { ColorPalette } from \"../2d/ColorPalette\";\r\nimport { PointerHandler } from \"../2d/pixi/events/PointerHandler\";\r\nimport { PixiScene } from \"../2d/pixi/Scene\";\r\n\r\nexport class EntryScene extends PixiScene {\r\n  layout = {\r\n    width: 1920,\r\n    height: 1080,\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      bgTint: ColorPalette.Main.bg.primary,\r\n    });\r\n\r\n    const self = this;\r\n\r\n    const gamePlayBtn = this.addComponent(new ButtonComponent({}), {\r\n      x: 400,\r\n      y: 480,\r\n    }).update({\r\n      text: \"gamePlayBtn\",\r\n    });\r\n    gamePlayBtn.handle(\r\n      class extends PointerHandler {\r\n        tap(pos: Coordinate): void {\r\n          self.send(\"action\", \"gamePlay\");\r\n        }\r\n      }\r\n    );\r\n\r\n    const deckEditBtn = this.addComponent(new ButtonComponent({}), {\r\n      x: 800,\r\n      y: 480,\r\n    }).update({\r\n      text: \"deckEditBtn\",\r\n    });\r\n    deckEditBtn.handle(\r\n      class extends PointerHandler {\r\n        tap(pos: Coordinate): void {\r\n          self.send(\"action\", \"deckEdit\");\r\n        }\r\n      }\r\n    );\r\n  }\r\n}\r\n","import { Spaces } from \"./Common\";\r\n\r\nexport class MatrixUtil {\r\n  static parse(str: string): Matrix<number> {\r\n    let len = 0;\r\n    let width = -1;\r\n    let height = 0;\r\n    const spaces = [];\r\n    for (let i = 0; i < str.length; ++i) {\r\n      switch (str.charAt(i)) {\r\n        case \"@\":\r\n          spaces.push(Spaces.INVALID);\r\n          break;\r\n        case \".\":\r\n          spaces.push(Spaces.EMPTY);\r\n          break;\r\n        case \"#\":\r\n          spaces.push(Spaces.NEUTRAL);\r\n          break;\r\n        case \"a\":\r\n          spaces.push(Spaces.TRIVIAL * 1);\r\n          break;\r\n        case \"A\":\r\n          spaces.push(Spaces.SPECIAL * 1);\r\n          break;\r\n        case \"b\":\r\n          spaces.push(Spaces.TRIVIAL * -1);\r\n          break;\r\n        case \"B\":\r\n          spaces.push(Spaces.SPECIAL * -1);\r\n          break;\r\n        case \"\\n\":\r\n          const dx = spaces.length - len;\r\n          len = spaces.length;\r\n          if (dx > 0) {\r\n            height += 1;\r\n            if (width < 0) {\r\n              width = dx;\r\n            } else {\r\n              console.assert(width == dx, width + \"=\" + dx);\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    return {\r\n      width,\r\n      height,\r\n      spaces,\r\n    };\r\n  }\r\n\r\n  static print(m: Matrix<number>): string {\r\n    const { width, height, spaces } = m;\r\n    let str = \"\";\r\n    for (let y = 0; y < height; ++y) {\r\n      for (let x = 0; x < width; ++x) {\r\n        switch (spaces[x + y * width]) {\r\n          case Spaces.EMPTY:\r\n            str += \".\";\r\n            break;\r\n          case Spaces.INVALID:\r\n            str += \"@\";\r\n            break;\r\n          case Spaces.NEUTRAL:\r\n            str += \"#\";\r\n            break;\r\n          case Spaces.TRIVIAL * 1:\r\n            str += \"a\";\r\n            break;\r\n          case Spaces.SPECIAL * 1:\r\n            str += \"A\";\r\n            break;\r\n          case Spaces.TRIVIAL * -1:\r\n            str += \"b\";\r\n            break;\r\n          case Spaces.SPECIAL * -1:\r\n            str += \"B\";\r\n            break;\r\n        }\r\n      }\r\n      str += \"\\n\";\r\n    }\r\n    return str;\r\n  }\r\n}\r\n","export const Spaces = {\r\n  EMPTY: 0,\r\n  TRIVIAL: 1,\r\n  SPECIAL: 2,\r\n  NEUTRAL: 3,\r\n  INVALID: 99,\r\n};\r\n","export default [\r\n  {\r\n    id: 0,\r\n    name: \"BoxSeats\",\r\n    spaces: `\r\n    ..........\r\n    ..........\r\n    .......B..\r\n    ..........\r\n    ..........\r\n    ..........\r\n    ..........\r\n    ..A.......\r\n    ..........\r\n    ..........\r\n    `,\r\n  },\r\n  {\r\n    id: 1,\r\n    name: \"DoubleGemini\",\r\n    spaces: `\r\n    @@@@@@@@.@@@@@@@@\r\n    @@@@@@@...@@@@@@@\r\n    @@@@@@.....@@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@.........@@@@\r\n    @@@.....B.....@@@\r\n    @@.............@@\r\n    @...............@\r\n    .................\r\n    @...............@\r\n    @@.............@@\r\n    @@@...........@@@\r\n    @@@@.........@@@@\r\n    @@@...........@@@\r\n    @@.............@@\r\n    @...............@\r\n    .................\r\n    @...............@\r\n    @@.............@@\r\n    @@@.....A.....@@@\r\n    @@@@.........@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@@.....@@@@@@\r\n    @@@@@@@...@@@@@@@\r\n    @@@@@@@@.@@@@@@@@\r\n    `,\r\n  },\r\n  {\r\n    id: 2,\r\n    name: \"LakefrontProperty\",\r\n    spaces: `\r\n    ................\r\n    ................\r\n    ................\r\n    ............B...\r\n    ................\r\n    ................\r\n    ......@@@@......\r\n    ......@@@@......\r\n    ......@@@@......\r\n    ......@@@@......\r\n    ................\r\n    ................\r\n    ...A............\r\n    ................\r\n    ................\r\n    ................\r\n    `,\r\n  },\r\n  {\r\n    id: 3,\r\n    name: \"MainStreet\",\r\n    spaces: `\r\n    .........\r\n    .........\r\n    .........\r\n    ....B....\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    .........\r\n    ....A....\r\n    .........\r\n    .........\r\n    .........\r\n    `,\r\n  },\r\n  {\r\n    id: 4,\r\n    name: \"RiverDrift\",\r\n    spaces: `\r\n    @@@@@............\r\n    @@@@@............\r\n    @@@@@............\r\n    @@@@@........B...\r\n    @@@@@............\r\n    @@@@@............\r\n    @@@@@............\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    @@@@@.......@@@@@\r\n    ............@@@@@\r\n    ............@@@@@\r\n    ............@@@@@\r\n    ...A........@@@@@\r\n    ............@@@@@\r\n    ............@@@@@\r\n    ............@@@@@\r\n    `,\r\n  },\r\n  {\r\n    id: 5,\r\n    name: \"SquareSquared\",\r\n    spaces: `\r\n    ...............\r\n    ...............\r\n    ...............\r\n    ...........B...\r\n    ...............\r\n    ...............\r\n    ...............\r\n    ...............\r\n    ...............\r\n    ...............\r\n    ...............\r\n    ...A...........\r\n    ...............\r\n    ...............\r\n    ...............\r\n    `,\r\n  },\r\n  {\r\n    id: 6,\r\n    name: \"ThunderPoint\",\r\n    spaces: `\r\n    @@@@@@@@........\r\n    @@@@@@@@........\r\n    @@@@@@@@........\r\n    @@@@@@@@....B...\r\n    @@@@@@@@........\r\n    @@@@@@@@........\r\n    @@@@@@@@........\r\n    ................\r\n    ................\r\n    ................\r\n    ................\r\n    ................\r\n    ................\r\n    ................\r\n    ................\r\n    ........@@@@@@@@\r\n    ........@@@@@@@@\r\n    ........@@@@@@@@\r\n    ...A....@@@@@@@@\r\n    ........@@@@@@@@\r\n    ........@@@@@@@@\r\n    ........@@@@@@@@\r\n    `,\r\n  },\r\n  {\r\n    id: 7,\r\n    name: \"XMarksTheGarden\",\r\n    spaces: `\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@...B...@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    ...................\r\n    ...................\r\n    ...................\r\n    ...................\r\n    ...................\r\n    ...................\r\n    ...................\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@...A...@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    @@@@@@.......@@@@@@\r\n    `,\r\n  },\r\n];\r\n","import { Card } from \"./Card\";\r\nimport { Spaces } from \"./Common\";\r\nimport { MatrixUtil } from \"./MatrixUtil\";\r\nimport MiniGameBoardInfo from \"./MiniGameBoardInfo\";\r\n\r\nexport interface CardPlacement {\r\n  turn: Turn;\r\n  card: Card;\r\n  rotation: Rotation;\r\n  position: Coordinate;\r\n}\r\n\r\ninterface BoardMeta {\r\n  id: number;\r\n  name: string;\r\n  spaceCount: number;\r\n}\r\n\r\nexport class Board {\r\n  public readonly specialPoints1: number = 0;\r\n  public readonly specialPoints2: number = 0;\r\n  public readonly spaceCount1: number = 0;\r\n  public readonly spaceCount2: number = 0;\r\n\r\n  constructor(\r\n    public readonly width: number,\r\n    public readonly height: number,\r\n    public readonly spaces: number[],\r\n    public readonly meta?: BoardMeta\r\n  ) {\r\n    console.assert(width * height == spaces.length);\r\n    for (let y = 0; y < height; ++y) {\r\n      for (let x = 0; x < width; ++x) {\r\n        const v = this.get({ x, y });\r\n        const absv = Math.abs(v);\r\n        if (absv == Spaces.TRIVIAL || absv == Spaces.SPECIAL) {\r\n          if (v > 0) {\r\n            this.spaceCount1 += 1;\r\n          } else {\r\n            this.spaceCount2 += 1;\r\n          }\r\n        }\r\n        if (absv == Spaces.SPECIAL) {\r\n          if (this.isCharged({ x, y })) {\r\n            if (v > 0) {\r\n              this.specialPoints1 += 1;\r\n            } else {\r\n              this.specialPoints2 += 1;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  move(ms: CardPlacement[]): Board {\r\n    console.assert(ms.length <= 2);\r\n    if (ms.length == 2) {\r\n      console.assert(ms[0].turn == -ms[1].turn);\r\n    }\r\n    const li = new Set();\r\n    const board = new Board(this.width, this.height, this.spaces.slice());\r\n    const move = (m: CardPlacement) => {\r\n      m.card.rotate(m.rotation).forEach((x, y, v) => {\r\n        const pos = { x: x + m.position.x, y: y + m.position.y };\r\n        const key = pos.x.toString() + \":\" + pos.y.toString();\r\n        let v1 = m.turn * v;\r\n        if (li.has(key)) {\r\n          if (v == Math.abs(board.get(pos))) {\r\n            v1 = Spaces.NEUTRAL;\r\n          }\r\n        } else {\r\n          li.add(key);\r\n        }\r\n        board.update(pos, v1);\r\n      });\r\n    };\r\n    ms.forEach(move);\r\n    return new Board(board.width, board.height, board.spaces, this.meta);\r\n  }\r\n\r\n  isCharged(pos: Coordinate): boolean {\r\n    const v = this.get(pos);\r\n    if (Math.abs(v) != Spaces.SPECIAL) {\r\n      return false;\r\n    }\r\n    for (let [dx, dy] of Board.EIGHT_NEIGHBOURS) {\r\n      const p1 = { x: pos.x + dx, y: pos.y + dy };\r\n      if (this.isValidPosition(p1)) {\r\n        const v1 = this.get(p1);\r\n        if (Math.abs(v1) == Spaces.EMPTY) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  isValidPosition(pos: Coordinate): boolean {\r\n    if (pos.x < 0 || pos.x >= this.width) {\r\n      return false;\r\n    }\r\n    if (pos.y < 0 || pos.y >= this.height) {\r\n      return false;\r\n    }\r\n    return this.get(pos) != Spaces.INVALID;\r\n  }\r\n\r\n  isValidMovement(isSpecialAttack: boolean, move: CardPlacement): boolean {\r\n    const card = move.card.rotate(move.rotation);\r\n    let ok = true;\r\n    let neighbour = false;\r\n    card.forEach((x, y, _) => {\r\n      if (!ok) {\r\n        return;\r\n      }\r\n      const pos = { x: x + move.position.x, y: y + move.position.y };\r\n      if (!this.isValidPosition(pos)) {\r\n        ok = false;\r\n        return;\r\n      }\r\n      if (!isSpecialAttack) {\r\n        ok = this.get(pos) == Spaces.EMPTY;\r\n      } else {\r\n        ok = Math.abs(this.get(pos)) <= Spaces.TRIVIAL;\r\n      }\r\n      if (!neighbour) {\r\n        for (let [dx, dy] of Board.EIGHT_NEIGHBOURS) {\r\n          const pos1 = { x: pos.x + dx, y: pos.y + dy };\r\n          if (this.isValidPosition(pos1)) {\r\n            const v = this.get(pos1) * move.turn;\r\n            if (\r\n              v == Spaces.SPECIAL ||\r\n              (!isSpecialAttack && v == Spaces.TRIVIAL)\r\n            ) {\r\n              neighbour = true;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n    return ok && neighbour;\r\n  }\r\n\r\n  get(pos: Coordinate): number {\r\n    return this.spaces[pos.x + pos.y * this.width];\r\n  }\r\n\r\n  forEach(func: (x: number, y: number, v: number) => void) {\r\n    for (let y = 0; y < this.height; ++y) {\r\n      for (let x = 0; x < this.width; ++x) {\r\n        const v = this.get({ x, y });\r\n        if (v != Spaces.INVALID) {\r\n          func(x, y, v);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  toString(): string {\r\n    return MatrixUtil.print({\r\n      width: this.width,\r\n      height: this.height,\r\n      spaces: this.spaces,\r\n    });\r\n  }\r\n\r\n  private update(pos: Coordinate, space: number) {\r\n    if (!this.isValidPosition(pos)) {\r\n      return;\r\n    }\r\n    const i = pos.x + pos.y * this.width;\r\n    if (Math.abs(space) >= Math.abs(this.spaces[i])) {\r\n      this.spaces[i] = space;\r\n    }\r\n  }\r\n\r\n  static fromId(id: number): Board {\r\n    return Board.ID_LOOKUP.get(id);\r\n  }\r\n\r\n  static fromName(name: string): Board {\r\n    return Board.NAME_LOOKUP.get(name);\r\n  }\r\n\r\n  private static readonly EIGHT_NEIGHBOURS = [\r\n    [-1, -1],\r\n    [0, -1],\r\n    [1, -1],\r\n    [1, 0],\r\n    [1, 1],\r\n    [0, 1],\r\n    [-1, 1],\r\n    [-1, 0],\r\n  ];\r\n\r\n  private static readonly ID_LOOKUP = new Map();\r\n  private static readonly NAME_LOOKUP = new Map();\r\n\r\n  static {\r\n    for (const info of MiniGameBoardInfo) {\r\n      const { id, name, spaces: str } = info;\r\n      const { width, height, spaces } = MatrixUtil.parse(str);\r\n      const spaceCount = spaces.filter((x) => x != Spaces.INVALID).length;\r\n      const board = new Board(width, height, spaces, {\r\n        id,\r\n        name,\r\n        spaceCount,\r\n      });\r\n      Board.ID_LOOKUP.set(id, board);\r\n      Board.NAME_LOOKUP.set(name, board);\r\n    }\r\n  }\r\n}\r\n","import { Spaces } from \"./Common\";\r\nimport MiniGameCardInfo from \"./MiniGameCardInfo.json\";\r\n\r\ninterface CardMeta {\r\n  id: number;\r\n  name: string;\r\n  rarity: \"Common\" | \"Rare\" | \"Fresh\";\r\n  specialCost: number;\r\n  spaceCount: number;\r\n}\r\n\r\nexport class Card {\r\n  constructor(\r\n    public readonly spaces: number[],\r\n    public readonly meta?: CardMeta\r\n  ) {\r\n    // basic data verifications\r\n    console.assert(spaces.length == 8 * 8);\r\n    console.assert(spaces.filter((x) => x < 0).length == 0);\r\n    if (meta != null) {\r\n      console.assert(spaces.filter((x) => x > 0).length == meta.spaceCount);\r\n    }\r\n  }\r\n\r\n  get(pos: Coordinate): number {\r\n    return this.spaces[pos.x + pos.y * 8];\r\n  }\r\n\r\n  rotate(rotation: Rotation): Card {\r\n    const [a, b, c, d, e, f] = Card.ROTATION_MATRICES[rotation];\r\n    const spaces = [];\r\n    for (let y = 0; y < 8; ++y) {\r\n      for (let x = 0; x < 8; ++x) {\r\n        const pos = { x: a * x + b * y + c, y: d * x + e * y + f };\r\n        spaces.push(this.get(pos));\r\n      }\r\n    }\r\n    return new Card(spaces);\r\n  }\r\n\r\n  forEach(func: (x: number, y: number, v: number) => void) {\r\n    for (let y = 0; y < 8; ++y) {\r\n      for (let x = 0; x < 8; ++x) {\r\n        const v = this.get({ x, y });\r\n        if (v > 0) {\r\n          func(x, y, v);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  static fromId(id: number): Card {\r\n    return Card.ID_LOOKUP.get(id);\r\n  }\r\n\r\n  static fromName(name: string): Card {\r\n    return Card.NAME_LOOKUP.get(name);\r\n  }\r\n\r\n  private static readonly ID_LOOKUP = new Map();\r\n  private static readonly NAME_LOOKUP = new Map();\r\n  private static readonly ROTATION_MATRICES = [\r\n    [1, 0, 0, 0, 1, 0],\r\n    [0, 1, 0, -1, 0, 7],\r\n    [-1, 0, 7, 0, -1, 7],\r\n    [0, -1, 7, 1, 0, 0],\r\n  ];\r\n\r\n  static {\r\n    for (let info of MiniGameCardInfo) {\r\n      const id = info[\"Number\"];\r\n      const name = info[\"Name\"];\r\n      const spaces = [];\r\n      for (let y = 0; y < 8; ++y) {\r\n        for (let x = 0; x < 8; ++x) {\r\n          const v0 = info[\"Square\"][x + (7 - y) * 8];\r\n          let v = Spaces.EMPTY;\r\n          if (v0 == \"Fill\") {\r\n            v = Spaces.TRIVIAL;\r\n          } else if (v0 == \"Special\") {\r\n            v = Spaces.SPECIAL;\r\n          }\r\n          spaces.push(v);\r\n        }\r\n      }\r\n      const card = new Card(spaces, {\r\n        id,\r\n        name,\r\n        rarity: <any>info[\"Rarity\"],\r\n        specialCost: info[\"SpecialCost\"],\r\n        spaceCount: spaces.filter((x) => x > 0).length,\r\n      });\r\n      Card.ID_LOOKUP.set(id, card);\r\n      Card.NAME_LOOKUP.set(name, card);\r\n    }\r\n  }\r\n}\r\n","export function shuffle<T>(li: T[]) {\r\n  li = li.slice();\r\n  for (let i = li.length - 1; i > 0; i--) {\r\n    const j = Math.floor(Math.random() * (i + 1));\r\n    const temp = li[i];\r\n    li[i] = li[j];\r\n    li[j] = temp;\r\n  }\r\n  return li;\r\n}\r\n","import { Card } from \"./Card\";\r\nimport MiniGamePresetDeck from \"./MiniGamePresetDeck.json\";\r\nimport { shuffle } from \"./Utils\";\r\n\r\nexport class Deck {\r\n  constructor(public readonly cards: Card[]) {\r\n    console.assert(cards.length == 15);\r\n    cards.forEach((card) => {\r\n      console.assert(card != null);\r\n    });\r\n  }\r\n\r\n  shuffle(): Deck {\r\n    return new Deck(shuffle(this.cards));\r\n  }\r\n\r\n  static fromCardIds(cardIds: number[]): Deck {\r\n    return new Deck(cardIds.map((id) => Card.fromId(id)));\r\n  }\r\n\r\n  static fromPreset(name: string): Deck {\r\n    return Deck.NAME_LOOKUP.get(name);\r\n  }\r\n\r\n  private static readonly NAME_LOOKUP = new Map();\r\n\r\n  static {\r\n    for (const deck of MiniGamePresetDeck) {\r\n      const cards = [];\r\n      for (const card of deck[\"Card\"]) {\r\n        const name = card.match(/MiniGame_(\\w+)\\.spl/)[1];\r\n        cards.push(Card.fromName(name));\r\n      }\r\n      const deckName = deck[\"__RowId\"].match(/MiniGame_(\\w+)/)[1];\r\n      Deck.NAME_LOOKUP.set(deckName, new Deck(cards));\r\n    }\r\n  }\r\n}\r\n","import { Board, CardPlacement } from \"./Board\";\r\nimport { Card } from \"./Card\";\r\nimport { Deck } from \"./Deck\";\r\n\r\nclass PlayerState {\r\n  constructor(\r\n    public readonly deck: Card[],\r\n    public readonly hand: Card[],\r\n    public readonly specialPoints: number = 0,\r\n    public readonly card?: Card,\r\n    public readonly movement?: PlayerMovement\r\n  ) {\r\n    if (card != null) {\r\n      console.assert(card.meta != null);\r\n    }\r\n  }\r\n\r\n  move(m: PlayerMovement): PlayerState {\r\n    const deck = this.deck.slice();\r\n    const hand = this.hand.slice();\r\n    console.assert(0 <= m.handId && m.handId < 4);\r\n    let card = hand[m.handId];\r\n    if (card == null) {\r\n      console.assert(m.cardId != null);\r\n      card = Card.fromId(m.cardId);\r\n    }\r\n    hand[m.handId] = deck.pop();\r\n    let specialPoints = this.specialPoints;\r\n    if (m.type == \"special\") {\r\n      specialPoints -= card.meta.specialCost;\r\n    }\r\n    return new PlayerState(deck, hand, specialPoints, card, m);\r\n  }\r\n\r\n  static from(deck: Deck): PlayerState {\r\n    const cards = deck.cards.slice().reverse();\r\n    const hand = [];\r\n    for (let i = 0; i < 4; ++i) {\r\n      hand.push(cards.pop());\r\n    }\r\n    return new PlayerState(cards, hand);\r\n  }\r\n}\r\n\r\nexport class GameState {\r\n  constructor(\r\n    public readonly id: number,\r\n    public readonly board: Board,\r\n    public readonly player1: PlayerState,\r\n    public readonly player2: PlayerState,\r\n    public readonly cardPlacements?: CardPlacement[][]\r\n  ) {\r\n    console.assert(id >= 0);\r\n  }\r\n\r\n  move(m1: PlayerMovement, m2: PlayerMovement): GameState {\r\n    if (!this.isValidMovement(1, m1) || !this.isValidMovement(-1, m2)) {\r\n      throw `invalid movement: ${JSON.stringify([m1, m2])}`;\r\n    }\r\n    const { specialPoints1, specialPoints2 } = this.board;\r\n    let earnSpecialPoints1 = 0;\r\n    let earnSpecialPoints2 = 0;\r\n    let board = this.board;\r\n    let player1 = this.player1.move(m1);\r\n    let player2 = this.player2.move(m2);\r\n    let p1: CardPlacement;\r\n    let p2: CardPlacement;\r\n    let cardPlacements: CardPlacement[][] = [];\r\n    if (m1.type != \"discard\") {\r\n      p1 = {\r\n        turn: 1,\r\n        card: player1.card,\r\n        rotation: m1.params.rotation,\r\n        position: m1.params.position,\r\n      };\r\n    } else {\r\n      earnSpecialPoints1 += 1;\r\n    }\r\n    if (m2.type != \"discard\") {\r\n      p2 = {\r\n        turn: -1,\r\n        card: player2.card,\r\n        rotation: m2.params.rotation,\r\n        position: m2.params.position,\r\n      };\r\n    } else {\r\n      earnSpecialPoints2 += 1;\r\n    }\r\n    if (p1 && p2) {\r\n      let overlap = false;\r\n      const li = new Set();\r\n      const fn = (m: CardPlacement) => {\r\n        m.card.rotate(m.rotation).forEach((x, y) => {\r\n          const pos = { x: x + m.position.x, y: y + m.position.y };\r\n          const key = pos.x.toString() + \":\" + pos.y.toString();\r\n          if (li.has(key)) {\r\n            overlap = true;\r\n          }\r\n          li.add(key);\r\n        });\r\n      };\r\n      [p1, p2].forEach(fn);\r\n\r\n      const dn = player1.card.meta.spaceCount - player2.card.meta.spaceCount;\r\n      if (!overlap || dn == 0) {\r\n        cardPlacements = [[p1, p2]];\r\n      } else if (dn < 0) {\r\n        cardPlacements = [[p2], [p1]];\r\n      } else {\r\n        cardPlacements = [[p1], [p2]];\r\n      }\r\n    } else {\r\n      if (p1) {\r\n        cardPlacements = [[p1]];\r\n      }\r\n      if (p2) {\r\n        cardPlacements = [[p2]];\r\n      }\r\n    }\r\n    for (const li of cardPlacements) {\r\n      board = board.move(li);\r\n    }\r\n    earnSpecialPoints1 += board.specialPoints1 - specialPoints1;\r\n    earnSpecialPoints2 += board.specialPoints2 - specialPoints2;\r\n    player1 = new PlayerState(\r\n      player1.deck,\r\n      player1.hand,\r\n      player1.specialPoints + earnSpecialPoints1,\r\n      player1.card,\r\n      player1.movement\r\n    );\r\n    player2 = new PlayerState(\r\n      player2.deck,\r\n      player2.hand,\r\n      player2.specialPoints + earnSpecialPoints2,\r\n      player2.card,\r\n      player2.movement\r\n    );\r\n    return new GameState(this.id + 1, board, player1, player2, cardPlacements);\r\n  }\r\n\r\n  isValidMovement(turn: Turn, m: PlayerMovement): boolean {\r\n    if (m.handId < 0 || m.handId >= 4) {\r\n      return false;\r\n    }\r\n    if (m.type == \"discard\") {\r\n      return true;\r\n    }\r\n    const player = (turn > 0 ? this.player1 : this.player2).move(m);\r\n    if (player.specialPoints < 0) {\r\n      return false;\r\n    }\r\n    return this.board.isValidMovement(m.type == \"special\", {\r\n      turn,\r\n      card: player.card,\r\n      rotation: m.params.rotation,\r\n      position: m.params.position,\r\n    });\r\n  }\r\n\r\n  static initial(board: Board, deck1: Deck, deck2: Deck): GameState {\r\n    return new GameState(\r\n      0,\r\n      board,\r\n      PlayerState.from(deck1),\r\n      PlayerState.from(deck2)\r\n    );\r\n  }\r\n}\r\n","import { Board } from \"./Board\";\r\nimport { Deck } from \"./Deck\";\r\nimport { GameState } from \"./GameState\";\r\n\r\ntype OnNewStateCallback = (from: GameState, to: GameState) => void;\r\n\r\nexport class GameController {\r\n  private onNewStateCallback: OnNewStateCallback;\r\n\r\n  constructor(\r\n    public readonly states: GameState[],\r\n    private stateId: number = 0\r\n  ) {\r\n    console.assert(stateId < states.length);\r\n    this.onNewState();\r\n  }\r\n\r\n  forward(): GameState {\r\n    console.assert(this.stateId < this.states.length);\r\n    const from = this.states[this.stateId];\r\n    const to = this.states[++this.stateId];\r\n    this.onNewStateCallback(from, to);\r\n    return this.state;\r\n  }\r\n\r\n  backward(): GameState {\r\n    console.assert(this.stateId > 0);\r\n    const from = this.states[this.stateId];\r\n    const to = this.states[--this.stateId];\r\n    this.onNewStateCallback(from, to);\r\n    return this.state;\r\n  }\r\n\r\n  move(m1: PlayerMovement, m2: PlayerMovement): GameState {\r\n    const from = this.states[this.stateId];\r\n    const to = from.move(m1, m2);\r\n    this.states.splice(++this.stateId);\r\n    this.states.push(to);\r\n    this.onNewStateCallback(from, to);\r\n    return this.state;\r\n  }\r\n\r\n  onNewState(callback?: OnNewStateCallback) {\r\n    this.onNewStateCallback = callback || (() => {});\r\n  }\r\n\r\n  get state(): GameState {\r\n    return this.states[this.stateId];\r\n  }\r\n\r\n  static fromGameRecord(record: GameRecord): GameController {\r\n    const board = Board.fromId(record.board);\r\n    const [deck1, deck2] = record.decks.map(Deck.fromCardIds);\r\n    let state = GameState.initial(board, deck1, deck2);\r\n    const states = [state];\r\n    for (const [m1, m2] of record.moves || []) {\r\n      console.assert(state.isValidMovement(1, m1));\r\n      console.assert(state.isValidMovement(-1, m2));\r\n      state = state.move(m1, m2);\r\n      states.push(state);\r\n    }\r\n    return new GameController(states);\r\n  }\r\n}\r\n","import { Component } from \"./pixi/Component\";\r\nimport { CompositeTilemap } from \"@pixi/tilemap\";\r\nimport { Texture } from \"pixi.js\";\r\nimport { App } from \"./pixi/App\";\r\n\r\ntype TextureSpec = Texture | string;\r\ntype TileSpec =\r\n  | TextureSpec\r\n  | {\r\n      texture: TextureSpec;\r\n      alpha: number;\r\n    };\r\n\r\ninterface IGridComponentProps<T> {\r\n  tileset: Map<T, TileSpec>;\r\n  matrix: Matrix<T>;\r\n  transform: {\r\n    dx?: number;\r\n    dy?: number;\r\n    anchor?: number | Coordinate;\r\n    scale?: number | Coordinate;\r\n    alpha?: number;\r\n  };\r\n}\r\n\r\nexport class GridComponent<T> extends Component<IGridComponentProps<T>> {\r\n  layout = {\r\n    width: 0,\r\n    height: 0,\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      tileset: new Map(),\r\n      matrix: {\r\n        width: 0,\r\n        height: 0,\r\n        spaces: [],\r\n      },\r\n      transform: {},\r\n    });\r\n\r\n    const root = this.addContainer();\r\n    const tilemap = new CompositeTilemap();\r\n    root.addChild(tilemap);\r\n\r\n    const fn = () => {\r\n      const matrix = this.props.matrix.value;\r\n      const transform = this.props.transform.value;\r\n      const tileset = this.props.tileset.value;\r\n\r\n      tilemap.clear();\r\n      if (matrix == null) {\r\n        return;\r\n      }\r\n      if (tileset.size == 0) {\r\n        return;\r\n      }\r\n\r\n      let texture = tileset.values().next().value;\r\n      if (typeof texture == \"object\" && !(texture instanceof Texture)) {\r\n        texture = texture.texture;\r\n      }\r\n      if (typeof texture == \"string\") {\r\n        texture = App.texture(texture);\r\n      }\r\n      const { width, height } = texture;\r\n\r\n      const { spaces: li, width: w, height: h } = matrix;\r\n      let {\r\n        dx = width,\r\n        dy = height,\r\n        anchor = 0,\r\n        scale = 1,\r\n        alpha = 1,\r\n      } = transform;\r\n\r\n      let [sx, sy] =\r\n        typeof scale == \"number\" ? [scale, scale] : [scale.x, scale.y];\r\n      root.scale.set(sx, sy);\r\n\r\n      let [ax, ay] =\r\n        typeof anchor == \"number\" ? [anchor, anchor] : [anchor.x, anchor.y];\r\n      [ax, ay] = [width * ax, height * ay];\r\n\r\n      [dx, dy] = [dx / sx, dy / sy];\r\n\r\n      for (let y = 0; y < h; ++y) {\r\n        for (let x = 0; x < w; ++x) {\r\n          const key = li[x + y * w];\r\n          let spec = tileset.get(key);\r\n          if (spec == null) {\r\n            continue;\r\n          }\r\n          if (spec instanceof Texture || typeof spec == \"string\") {\r\n            spec = {\r\n              texture: spec,\r\n              alpha: 1,\r\n            };\r\n          }\r\n          tilemap.tile(spec.texture, x * dx - ax, y * dy - ay, {\r\n            tileWidth: width,\r\n            tileHeight: height,\r\n            alpha: spec.alpha * alpha,\r\n          });\r\n        }\r\n      }\r\n    };\r\n    this.props.matrix.onUpdate(fn);\r\n    this.props.transform.onUpdate(fn);\r\n    this.props.tileset.onUpdate(fn);\r\n  }\r\n}\r\n","import { RenderTexture, Texture } from \"pixi.js\";\r\nimport { App } from \"./App\";\r\nimport { Component } from \"./Component\";\r\n\r\n// TODO: make this always valid\r\nexport class RenderBuffer<T = {}> extends Component<T> {\r\n  private mTexture: Texture;\r\n\r\n  constructor(props: T, private readonly animate: boolean = true) {\r\n    super(props);\r\n  }\r\n\r\n  get texture(): Texture {\r\n    if (this.mTexture != null) {\r\n      return this.mTexture;\r\n    }\r\n\r\n    const renderTexture = RenderTexture.create({\r\n      width: this.layout.width,\r\n      height: this.layout.height,\r\n    });\r\n    const fn = () => {\r\n      App.renderer.render(this.ui, { renderTexture });\r\n      if (this.animate) {\r\n        window.requestAnimationFrame(fn);\r\n      }\r\n    };\r\n    window.requestAnimationFrame(fn);\r\n\r\n    this.mTexture = renderTexture;\r\n    return this.mTexture;\r\n  }\r\n}\r\n","import { RenderBuffer } from \"./pixi/RenderBuffer\";\r\n\r\nexport class EmptySpaceTexture extends RenderBuffer {\r\n  layout = {\r\n    width: 40,\r\n    height: 40,\r\n    border: 1.5,\r\n  };\r\n\r\n  constructor() {\r\n    super({}, false);\r\n\r\n    const { width, height, border } = this.layout;\r\n    const w = width - 2 * border;\r\n    this.addGraphics()\r\n      .beginFill(0x4b485b)\r\n      .drawRect(0, 0, width, height)\r\n      .beginFill(0x0a0a0a)\r\n      .drawRect(border, border, w, w);\r\n  }\r\n\r\n  static readonly V = new EmptySpaceTexture().texture;\r\n\r\n  static readonly V50 = (() => {\r\n    const s = new EmptySpaceTexture();\r\n    s.ui.alpha = 0.7;\r\n    return s.texture;\r\n  })();\r\n}\r\n","import { Color } from \"./pixi/Color\";\r\nimport { RenderBuffer } from \"./pixi/RenderBuffer\";\r\nimport { Texture } from \"pixi.js\";\r\nimport { ColorPalette } from \"./ColorPalette\";\r\nimport SpFireGlsl from \"../shaders/SpFire.glsl\";\r\nimport { App } from \"./pixi/App\";\r\n\r\ninterface ISpFireTextureProps {\r\n  primary: Color;\r\n  secondary: Color;\r\n  center: Color;\r\n}\r\n\r\nexport class SpFireTexture extends RenderBuffer<ISpFireTextureProps> {\r\n  layout = {\r\n    width: 104,\r\n    height: 104,\r\n    center: {\r\n      x: 52,\r\n      y: 68,\r\n      r: 15,\r\n    },\r\n  };\r\n\r\n  constructor(props: ISpFireTextureProps) {\r\n    super(props);\r\n\r\n    const shader = this.addShader(SpFireGlsl, {\r\n      uColorPrimary: Color.BLACK.rgb01,\r\n      uColorSecondary: Color.BLACK.rgb01,\r\n      uAlphaSampler: App.texture(\"SpFire_00.png\"),\r\n      uFlameSampler: App.texture(\"SpFire_01.png\"),\r\n      uDistortionSampler: App.texture(\"SpFire_02.png\"),\r\n    });\r\n\r\n    const {\r\n      width,\r\n      height,\r\n      center: { x, y, r },\r\n    } = this.layout;\r\n\r\n    this.addSprite({\r\n      width,\r\n      height,\r\n      filters: [shader],\r\n    });\r\n\r\n    const circle = this.addSprite({\r\n      anchor: 0.5,\r\n      x,\r\n      y,\r\n      width: r * 2,\r\n      height: r * 2,\r\n      texture: \"circle.png\",\r\n    });\r\n\r\n    this.props.primary.onUpdate(\r\n      (v) => (shader.uniforms.uColorPrimary = v.rgb01)\r\n    );\r\n    this.props.secondary.onUpdate(\r\n      (v) => (shader.uniforms.uColorSecondary = v.rgb01)\r\n    );\r\n    this.props.center.onUpdate((v) => (circle.tint = v.i32));\r\n  }\r\n\r\n  static readonly P1: Texture = new SpFireTexture(ColorPalette.Player1.fire)\r\n    .texture;\r\n\r\n  static readonly P2: Texture = new SpFireTexture(ColorPalette.Player2.fire)\r\n    .texture;\r\n}\r\n","export default \"uniform sampler2D uAlphaSampler;\\r\\nuniform sampler2D uFlameSampler;\\r\\nuniform sampler2D uDistortionSampler;\\r\\n\\r\\nuniform vec3 uColorPrimary;\\r\\nuniform vec3 uColorSecondary;\\r\\n\\r\\nfloat clamp01(float x) {\\r\\n    return clamp(x, 0.0, 1.0);\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n  const float b1 = 0.1;\\r\\n  const float b2 = 0.5;\\r\\n\\r\\n  const float speed = 0.1;\\r\\n\\r\\n  vec2 t2 = vVertexPosition + iTime * speed * vec2(0.07, 1.0);\\r\\n  vec2 t1 = vVertexPosition;\\r\\n  vec2 t0 = vVertexPosition + 7.0 * iTime * speed * vec2(0.0, 1.0);\\r\\n\\r\\n  vec4 v2 = texture2D(uDistortionSampler, t2);\\r\\n  vec2 pos = v2.xy * 0.1;\\r\\n  vec4 v1 = texture2D(uFlameSampler, pos + t1);\\r\\n  vec4 v0 = texture2D(uAlphaSampler, pos + t0);\\r\\n\\r\\n  float e1 = clamp01(v0.w + v1.w - 1.0);\\r\\n  float e2 = clamp01(v1.x + e1);\\r\\n  float e3 = clamp01(e2 - 0.4);\\r\\n  float a = clamp01(b1 * 10.0 * e3);\\r\\n\\r\\n  vec3 color = mix(uColorSecondary, uColorPrimary, a);\\r\\n  float alpha = clamp01(6.0 * e3 * b2);\\r\\n\\r\\n  gl_FragColor = vec4(color * alpha, alpha);\\r\\n}\"","import { Color } from \"./pixi/Color\";\r\nimport { RenderBuffer } from \"./pixi/RenderBuffer\";\r\nimport { Texture } from \"pixi.js\";\r\nimport { ColorPalette } from \"./ColorPalette\";\r\nimport SpaceOverlayGlsl from \"../shaders/SpaceOverlay.glsl\";\r\nimport { App } from \"./pixi/App\";\r\n\r\ninterface IOverlayComponentProps {\r\n  value: number;\r\n  scale: number;\r\n  angle: number;\r\n  angleV: number;\r\n  primary: Color;\r\n  secondary: Color;\r\n  file: string;\r\n}\r\n\r\nexport class OverlayTexture extends RenderBuffer<IOverlayComponentProps> {\r\n  layout = {\r\n    width: 40,\r\n    height: 40,\r\n  };\r\n\r\n  constructor(props: IOverlayComponentProps) {\r\n    super(props);\r\n\r\n    const shader = this.addShader(SpaceOverlayGlsl, {\r\n      uValue: 0,\r\n      uScale: 0,\r\n      uAngle: 0,\r\n      uAngleV: 0,\r\n      uColorPrimary: Color.BLACK.rgb01,\r\n      uColorSecondary: Color.BLACK.rgb01,\r\n      uPatternSampler: Texture.WHITE,\r\n    });\r\n\r\n    const { width, height } = this.layout;\r\n    this.addSprite({\r\n      width,\r\n      height,\r\n      filters: [shader],\r\n    });\r\n\r\n    this.props.value.onUpdate((v) => (shader.uniforms.uValue = v));\r\n    this.props.scale.onUpdate((v) => (shader.uniforms.uScale = v));\r\n    this.props.angle.onUpdate((v) => (shader.uniforms.uAngle = v));\r\n    this.props.angleV.onUpdate((v) => (shader.uniforms.uAngleV = v));\r\n    this.props.primary.onUpdate(\r\n      (v) => (shader.uniforms.uColorPrimary = v.rgb01)\r\n    );\r\n    this.props.secondary.onUpdate(\r\n      (v) => (shader.uniforms.uColorSecondary = v.rgb01)\r\n    );\r\n    this.props.file.onUpdate(\r\n      (file) => (shader.uniforms.uPatternSampler = App.texture(file))\r\n    );\r\n  }\r\n\r\n  static normal(): OverlayTexture {\r\n    return new OverlayTexture({\r\n      value: 1,\r\n      scale: 0.8,\r\n      angle: 45,\r\n      angleV: -90,\r\n      primary: ColorPalette.Space.overlay.normal,\r\n      secondary: ColorPalette.Space.overlay.invalid,\r\n      file: \"guide_stride.png\",\r\n    });\r\n  }\r\n\r\n  static special(): OverlayTexture {\r\n    return new OverlayTexture({\r\n      value: 1,\r\n      scale: 5,\r\n      angle: -75,\r\n      angleV: -150,\r\n      primary: ColorPalette.Space.overlay.special,\r\n      secondary: ColorPalette.Space.overlay.invalid,\r\n      file: \"guide_dot.png\",\r\n    });\r\n  }\r\n}\r\n","export default \"uniform sampler2D uPatternSampler;\\r\\n\\r\\nuniform vec3 uColorPrimary;\\r\\nuniform vec3 uColorSecondary;\\r\\n\\r\\nuniform float uValue;\\r\\nuniform float uScale;\\r\\nuniform float uAngle;\\r\\nuniform float uAngleV;\\r\\n\\r\\nvoid main() {\\r\\n  float speed = 0.2;\\r\\n  vec2 dir = vec2(1.0, 0) * rotate2D(uAngleV);\\r\\n  vec2 xy = (vVertexPosition.xy + dir * iTime * speed) * \\r\\n            rotate2D(uAngle) * \\r\\n            inversesqrt(2.0) * uScale;\\r\\n  vec4 guide = texture2D(uPatternSampler, xy);\\r\\n  vec3 color = mix(uColorSecondary, uColorPrimary, uValue);\\r\\n  gl_FragColor = vec4(color * guide.x, guide.a);\\r\\n}\"","import { Component } from \"../Component\";\r\nimport { Logger } from \"../Logger\";\r\nimport { EventHandler } from \"./EventHandler\";\r\n\r\nexport class DragHandler extends EventHandler {\r\n  readonly triggerThresholdPx: number = 5;\r\n\r\n  constructor(sender: Component) {\r\n    super(\"drag\", sender);\r\n  }\r\n\r\n  drag(pos: Coordinate) {}\r\n\r\n  move(pos: Coordinate) {}\r\n\r\n  drop(pos: Coordinate) {}\r\n\r\n  _bootstrap(): EventHandler {\r\n    const self = this;\r\n    Logger.log(\"bootstrap\", this);\r\n    return Object.setPrototypeOf(\r\n      {\r\n        _pointerdown({ x, y }: Coordinate): EventHandler {\r\n          if (this._pos != null) {\r\n            return null;\r\n          }\r\n          this._pos = { x, y };\r\n          return this;\r\n        },\r\n        _pointermove(pos: Coordinate): EventHandler {\r\n          const d = Math.sqrt(\r\n            (pos.x - this._pos.x) ** 2 + (pos.y - this._pos.y) ** 2\r\n          );\r\n          if (d >= self.triggerThresholdPx) {\r\n            const evt: DragHandler = Object.setPrototypeOf({}, self);\r\n            evt.drag(pos);\r\n            return evt;\r\n          }\r\n          return this;\r\n        },\r\n        _pointerup(pos: Coordinate): EventHandler {\r\n          return null;\r\n        },\r\n      },\r\n      self\r\n    );\r\n  }\r\n\r\n  _pointerdown(pos: Coordinate): EventHandler {\r\n    this.drop(pos);\r\n    return null;\r\n  }\r\n\r\n  _pointermove(pos: Coordinate): EventHandler {\r\n    this.move(pos);\r\n    return this;\r\n  }\r\n\r\n  _pointerup(pos: Coordinate): EventHandler {\r\n    this.drop(pos);\r\n    return null;\r\n  }\r\n}\r\n","import { Board, CardPlacement } from \"../../core/Board\";\r\nimport { Card } from \"../../core/Card\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { GridComponent } from \"./GridComponent\";\r\nimport { Container, InteractionEvent, Sprite, Texture } from \"pixi.js\";\r\nimport { Spaces } from \"../../core/Common\";\r\nimport { EmptySpaceTexture } from \"./EmptySpaceTexture\";\r\nimport { SpFireTexture } from \"./SpFireTexture\";\r\nimport { OverlayTexture } from \"./OverlayTexture\";\r\nimport { Animation } from \"./pixi/animations/Animation\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\nimport { PointerHandler } from \"./pixi/events/PointerHandler\";\r\nimport { TargetAnimation } from \"./pixi/animations/TargetAnimation\";\r\nimport { getLocalPos, getWorldPos } from \"./pixi/events/Utils\";\r\nimport { Platform } from \"./pixi/Platform\";\r\nimport { DragHandler } from \"./pixi/events/DragHandler\";\r\n\r\ninterface IPlayerInput {\r\n  card: Card;\r\n  rotation: Rotation;\r\n  pointer: Coordinate;\r\n  isSpecialAttack: boolean;\r\n}\r\n\r\ninterface IBoardComponentProps {\r\n  input: IPlayerInput;\r\n  acceptInput: boolean;\r\n}\r\n\r\ntype OnPlayerInputFn = (e: CardPlacement, ok: boolean) => void;\r\n\r\nexport class BoardComponent extends Component<IBoardComponentProps> {\r\n  private readonly root: Container;\r\n  private readonly hitbox: Sprite;\r\n  private readonly bg: GridComponent<number>;\r\n  private readonly spaces: GridComponent<number>;\r\n  private readonly spFire: GridComponent<number>;\r\n  private readonly flash: GridComponent<boolean>;\r\n  private readonly overlay: GridComponent<number>;\r\n\r\n  private readonly nrmOverlay = OverlayTexture.normal();\r\n  private readonly spOverlay = OverlayTexture.special();\r\n\r\n  private readonly flashAnimation: Animation;\r\n\r\n  private board: Board;\r\n  private lk: boolean = false;\r\n  private selection: number[];\r\n\r\n  private onPlayerInputFn: OnPlayerInputFn = () => {};\r\n\r\n  layout = {\r\n    width: 20,\r\n    height: 27,\r\n    w1: 40,\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      input: {\r\n        card: null,\r\n        rotation: 0,\r\n        pointer: null,\r\n        isSpecialAttack: false,\r\n      },\r\n      acceptInput: true,\r\n    });\r\n\r\n    const self = this;\r\n    const { w1 } = this.layout;\r\n\r\n    this.root = this.addContainer();\r\n    this.root.scale.set(1 / w1);\r\n\r\n    this.hitbox = this.addSprite({ parent: this.root });\r\n\r\n    this.bg = this.addComponent(new GridComponent(), {\r\n      parent: this.root,\r\n    });\r\n    this.bg.update({\r\n      tileset: new Map<any, any>([\r\n        [Spaces.EMPTY, EmptySpaceTexture.V],\r\n        [Spaces.TRIVIAL, \"pure_black.png\"],\r\n        [-Spaces.TRIVIAL, \"pure_black.png\"],\r\n        [-Spaces.TRIVIAL, \"pure_black.png\"],\r\n        [Spaces.NEUTRAL, \"pure_black.png\"],\r\n      ]),\r\n      transform: {\r\n        anchor: 0.5,\r\n      },\r\n    });\r\n\r\n    const e1 = { texture: \"player1_trivial_space.png\", alpha: 1 };\r\n    const e2 = { texture: \"player2_trivial_space.png\", alpha: 1 };\r\n    const tileset = new Map<any, any>([\r\n      [Spaces.TRIVIAL, e1],\r\n      [Spaces.SPECIAL, \"player1_special_space.png\"],\r\n      [-Spaces.TRIVIAL, e2],\r\n      [-Spaces.SPECIAL, \"player2_special_space.png\"],\r\n      [Spaces.NEUTRAL, \"neutral_space.png\"],\r\n    ]);\r\n\r\n    const tileAlpha = TargetAnimation.of(1)\r\n      .onEase(0.2, EaseFunc.EASE_IN_OUT_EXPO)\r\n      .onUpdate((v) => {\r\n        this.spaces.update({ matrix: this.spaces.props.matrix.value });\r\n        e1.alpha = e2.alpha = v;\r\n      });\r\n\r\n    this.spaces = this.addComponent(new GridComponent(), {\r\n      parent: this.root,\r\n    });\r\n    this.spaces.update({\r\n      tileset,\r\n      transform: {\r\n        anchor: 0.5,\r\n      },\r\n    });\r\n\r\n    this.spFire = this.addComponent(new GridComponent(), {\r\n      parent: this.root,\r\n      y: -16,\r\n    });\r\n    this.spFire.update({\r\n      tileset: new Map([\r\n        [Spaces.SPECIAL, SpFireTexture.P1],\r\n        [-Spaces.SPECIAL, SpFireTexture.P2],\r\n      ]),\r\n      transform: {\r\n        anchor: 0.5,\r\n        dx: w1,\r\n        dy: w1,\r\n      },\r\n    });\r\n\r\n    this.overlay = this.addComponent(new GridComponent(), {\r\n      parent: this.root,\r\n    });\r\n    this.overlay.update({\r\n      tileset: new Map([\r\n        [Spaces.TRIVIAL, this.nrmOverlay.texture],\r\n        [Spaces.SPECIAL, this.spOverlay.texture],\r\n      ]),\r\n      transform: {\r\n        anchor: 0.5,\r\n      },\r\n    });\r\n\r\n    this.flash = this.addComponent(new GridComponent(), {\r\n      parent: this.root,\r\n    });\r\n    this.flash.update({\r\n      tileset: new Map([[true, \"Decide.png\"]]),\r\n      transform: {\r\n        anchor: 0.5,\r\n        dx: w1,\r\n        dy: w1,\r\n      },\r\n    });\r\n\r\n    this.flashAnimation = this.addAnimation({\r\n      time: 0.2,\r\n      keyframe: (t) => {\r\n        // TODO: support grid tint\r\n        // this.flash.tint = e.interpolate(\r\n        //   ColorPalette.Space.flash.secondary,\r\n        //   ColorPalette.Space.flash.primary,\r\n        //   t\r\n        //   ).i32;\r\n        const scale = EaseFunc.LINEAR.interpolate(1, 1.5, t);\r\n        const alpha =\r\n          0.5 * EaseFunc.EASE_IN_OUT_SINE.apply(1 - Math.abs(2 * t - 1));\r\n        this.flash.update({\r\n          transform: Object.assign({}, this.flash.props.transform.value, {\r\n            scale,\r\n            alpha,\r\n          }),\r\n        });\r\n      },\r\n    });\r\n\r\n    const getGridPos = (pos: Coordinate) => {\r\n      const { x, y } = getLocalPos(pos, self.hitbox);\r\n      const { width: w, height: h } = self.board;\r\n      return { x: Math.floor(x * w), y: Math.floor(y * h) };\r\n    };\r\n\r\n    const sendPlayerInput = async (move: CardPlacement) => {\r\n      if (move == null) {\r\n        return;\r\n      }\r\n      self.send(\"player.input\", move);\r\n      self.lk = true;\r\n      self.flash.update({\r\n        matrix: {\r\n          spaces: self.selection.map((x) => x != Spaces.EMPTY),\r\n          width: self.board.width,\r\n          height: self.board.height,\r\n        },\r\n      });\r\n      await self.flashAnimation.play();\r\n      self.lk = false;\r\n      self.send(\"player.input\", move);\r\n    };\r\n\r\n    if (!Platform.isMobile) {\r\n      this.handle(\r\n        class extends PointerHandler {\r\n          move(pos: Coordinate): void {\r\n            if (self.lk) {\r\n              return;\r\n            }\r\n            if (!self.props.acceptInput.value) {\r\n              return;\r\n            }\r\n            pos = getGridPos(pos);\r\n            self.update({\r\n              input: Object.assign({}, self.props.input.value, {\r\n                pointer: pos,\r\n              }),\r\n            });\r\n          }\r\n\r\n          async tap(pos: Coordinate) {\r\n            if (!self.props.acceptInput.value) {\r\n              return;\r\n            }\r\n            pos = getGridPos(pos);\r\n            if (pos == null) {\r\n              return;\r\n            }\r\n            const move = self.uiUpdateInput(\r\n              Object.assign({}, self.props.input.value, { pointer: pos })\r\n            );\r\n            await sendPlayerInput(move);\r\n          }\r\n        }\r\n      );\r\n    } else {\r\n      this.handle(\r\n        class extends DragHandler {\r\n          triggerThresholdPx = 8;\r\n          dp: Coordinate;\r\n          drag(pos: Coordinate): void {\r\n            if (!self.props.acceptInput.value) {\r\n              return;\r\n            }\r\n            const { x, y } = self.props.input.value.pointer ||\r\n              getGridPos(pos) || { x: 0, y: 0 };\r\n            const { width, height } = self.board;\r\n            const wp = getWorldPos(\r\n              { x: (x + 0.5) / width, y: (y + 0.5) / height },\r\n              self.hitbox\r\n            );\r\n            this.dp = {\r\n              x: wp.x - pos.x,\r\n              y: wp.y - pos.y,\r\n            };\r\n            self.update({\r\n              input: Object.assign({}, self.props.input.value, {\r\n                pointer: { x, y },\r\n              }),\r\n            });\r\n          }\r\n          move(pos: Coordinate): void {\r\n            if (!self.props.acceptInput.value) {\r\n              return;\r\n            }\r\n            const { x, y } = getGridPos({\r\n              x: this.dp.x + pos.x,\r\n              y: this.dp.y + pos.y,\r\n            });\r\n            self.update({\r\n              input: Object.assign({}, self.props.input.value, {\r\n                pointer: { x, y },\r\n              }),\r\n            });\r\n          }\r\n          drop(pos: Coordinate): void {\r\n            if (!self.props.acceptInput.value) {\r\n              return;\r\n            }\r\n            const { x, y } = getGridPos({\r\n              x: this.dp.x + pos.x,\r\n              y: this.dp.y + pos.y,\r\n            });\r\n            // const move = self.uiUpdateInput(\r\n            //   Object.assign({}, self.props.input.value, {\r\n            //     pointer: { x, y },\r\n            //   })\r\n            // );\r\n            self.update({\r\n              input: Object.assign({}, self.props.input.value, {\r\n                // pointer: move.position,\r\n                pointer: { x, y },\r\n              }),\r\n            });\r\n          }\r\n        }\r\n      );\r\n      this.handle(\r\n        class extends PointerHandler {\r\n          triggerThresholdPx = 5;\r\n          doubleTapThresholdMs = 200;\r\n          async doubleTap(pos: Coordinate) {\r\n            if (!self.props.acceptInput.value) {\r\n              return;\r\n            }\r\n            const move = self.uiUpdateInput(self.props.input.value);\r\n            await sendPlayerInput(move);\r\n          }\r\n        }\r\n      );\r\n    }\r\n\r\n    const fn = () => {\r\n      const input = this.props.input.value;\r\n      const accept = this.props.acceptInput.value;\r\n      if (accept && input) {\r\n        tileAlpha.update(input.isSpecialAttack ? 0.4 : 1);\r\n        this.uiUpdateInput(input);\r\n      } else {\r\n        tileAlpha.update(1);\r\n        this.uiUpdateInput(null);\r\n      }\r\n    };\r\n    this.props.input.onUpdate(fn);\r\n    this.props.acceptInput.onUpdate(fn);\r\n  }\r\n\r\n  uiReset(board: Board) {\r\n    this.board = board;\r\n    const { width, height } = this.board;\r\n    const x = (this.layout.width - width) / 2;\r\n    const y = (this.layout.height - height) / 2;\r\n    this.root.position.set(x + 0.5, y + 0.5);\r\n    const { w1 } = this.layout;\r\n    this.hitbox.width = w1 * width;\r\n    this.hitbox.height = w1 * height;\r\n    this.spaces.update({ matrix: board });\r\n    this.bg.update({ matrix: board });\r\n    this.bg.lock();\r\n    this.uiUpdateFire();\r\n  }\r\n\r\n  uiUpdateFire() {\r\n    const spaces: number[] = [];\r\n    const { width, height } = this.board;\r\n    for (let y = 0; y < height; ++y) {\r\n      for (let x = 0; x < width; ++x) {\r\n        const pos = { x, y };\r\n        spaces.push(this.board.isCharged(pos) ? this.board.get(pos) : 0);\r\n      }\r\n    }\r\n    this.spFire.update({\r\n      matrix: { spaces, width, height },\r\n    });\r\n  }\r\n\r\n  async uiPlaceCards(ms: CardPlacement[]) {\r\n    console.assert(ms.length <= 2);\r\n    if (ms.length == 2) {\r\n      console.assert(ms[0].turn == -ms[1].turn);\r\n    }\r\n    this.board = this.board.move(ms);\r\n    this.spaces.update({ matrix: this.board });\r\n    this.bg.update({ matrix: this.board });\r\n    this.bg.lock();\r\n    const { width, height } = this.board;\r\n    const spaces: boolean[] = [];\r\n    for (const m of ms) {\r\n      m.card.rotate(m.rotation).forEach((x, y) => {\r\n        x += m.position.x;\r\n        y += m.position.y;\r\n        spaces[x + y * width] = true;\r\n      });\r\n    }\r\n    this.flash.update({ matrix: { spaces, width, height } });\r\n    await this.flashAnimation.play();\r\n  }\r\n\r\n  onPlayerInput(fn: OnPlayerInputFn) {\r\n    this.onPlayerInputFn = fn;\r\n  }\r\n\r\n  private uiUpdateInput(input?: IPlayerInput): CardPlacement {\r\n    this.selection = [];\r\n    if (this.board == null) {\r\n      return null;\r\n    }\r\n\r\n    const { width, height } = this.board;\r\n    this.overlay.update({\r\n      matrix: { spaces: this.selection.slice(), width, height },\r\n    });\r\n    this.overlay.lock();\r\n    if (input == null) {\r\n      return null;\r\n    }\r\n\r\n    const { card, rotation, pointer, isSpecialAttack } = input;\r\n    if (\r\n      card == null ||\r\n      rotation == null ||\r\n      pointer == null ||\r\n      isSpecialAttack == null\r\n    ) {\r\n      return null;\r\n    }\r\n\r\n    const position = this.getAdjustedCardPosition(card, rotation, pointer);\r\n    const move: CardPlacement = {\r\n      turn: 1,\r\n      card,\r\n      rotation,\r\n      position,\r\n    };\r\n\r\n    const ok = this.board.isValidMovement(isSpecialAttack, move);\r\n    const value = ok ? 1 : 0;\r\n    this.nrmOverlay.update({ value });\r\n    this.spOverlay.update({ value });\r\n    card.rotate(rotation).forEach((x, y, v) => {\r\n      x += position.x;\r\n      y += position.y;\r\n      this.selection[x + width * y] = v;\r\n    });\r\n    this.overlay.update({\r\n      matrix: { spaces: this.selection.slice(), width, height },\r\n    });\r\n    this.overlay.lock();\r\n\r\n    this.onPlayerInputFn(move, ok);\r\n\r\n    return move;\r\n  }\r\n\r\n  private getAdjustedCardPosition(\r\n    card: Card,\r\n    rotation: Rotation,\r\n    pointer: Coordinate\r\n  ): Coordinate {\r\n    let x = pointer.x - 3;\r\n    let y = pointer.y - 3;\r\n\r\n    if (rotation == 1 || rotation == 2) {\r\n      x -= 1;\r\n    }\r\n    if (rotation == 2 || rotation == 3) {\r\n      y -= 1;\r\n    }\r\n\r\n    const rotatedCard = card.rotate(rotation);\r\n    const xs: number[] = [];\r\n    const ys: number[] = [];\r\n    rotatedCard.forEach((dx, dy, _) => {\r\n      xs.push(x + dx);\r\n      ys.push(y + dy);\r\n    });\r\n\r\n    const minX = Math.min(...xs);\r\n    const maxX = Math.max(...xs);\r\n    const minY = Math.min(...ys);\r\n    const maxY = Math.max(...ys);\r\n    if (minX < 0) {\r\n      x += -minX;\r\n    }\r\n    if (minY < 0) {\r\n      y += -minY;\r\n    }\r\n    if (maxX >= this.board.width) {\r\n      x -= maxX - this.board.width + 1;\r\n    }\r\n    if (maxY >= this.board.height) {\r\n      y -= maxY - this.board.height + 1;\r\n    }\r\n\r\n    return { x, y };\r\n  }\r\n}\r\n","import { Card } from \"../../core/Card\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { Spaces } from \"../../core/Common\";\r\nimport { GridComponent } from \"./GridComponent\";\r\nimport { EmptySpaceTexture } from \"./EmptySpaceTexture\";\r\nimport { Texture } from \"pixi.js\";\r\n\r\ninterface ICardGridComponentProps {\r\n  card: Card;\r\n  turn: Turn;\r\n  flat: boolean;\r\n}\r\n\r\nexport class CardGridComponent extends Component<ICardGridComponentProps> {\r\n  layout = {\r\n    width: 8,\r\n    height: 8,\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      card: Card.fromId(1),\r\n      turn: 1,\r\n      flat: false,\r\n    });\r\n\r\n    const root = this.addContainer();\r\n    root.scale.set(1 / 40);\r\n\r\n    const nrmTiles = new Map<any, any>([\r\n      [Spaces.EMPTY, EmptySpaceTexture.V50],\r\n      [Spaces.TRIVIAL, \"player1_trivial_space.png\"],\r\n      [Spaces.SPECIAL, \"player1_special_space.png\"],\r\n      [-Spaces.TRIVIAL, \"player2_trivial_space.png\"],\r\n      [-Spaces.SPECIAL, \"player2_special_space.png\"],\r\n    ]);\r\n\r\n    const flatTiles = new Map<any, any>([\r\n      [Spaces.EMPTY, EmptySpaceTexture.V50],\r\n      [Spaces.TRIVIAL, \"pure_yellow.png\"],\r\n      [Spaces.SPECIAL, \"pure_orange.png\"],\r\n    ]);\r\n\r\n    const bg = this.addComponent(new GridComponent(), {\r\n      parent: root,\r\n    });\r\n\r\n    const fn = () => {\r\n      const card = this.props.card.value;\r\n      const turn = this.props.turn.value;\r\n\r\n      const spaces = card.spaces.map((x) => x * turn);\r\n      bg.update({ matrix: { spaces, width: 8, height: 8 } });\r\n    };\r\n    this.props.card.onUpdate(fn);\r\n    this.props.turn.onUpdate(fn);\r\n\r\n    this.props.flat.onUpdate((flat) =>\r\n      bg.update({ tileset: flat ? flatTiles : nrmTiles })\r\n    );\r\n  }\r\n}\r\n","import { EaseFunc } from \"./Ease\";\r\n\r\ninterface IPulseAnimationOptions {\r\n  from?: number;\r\n  to: number;\r\n  time?: number;\r\n  ease?: EaseFunc;\r\n  update: (t: number) => void;\r\n}\r\n\r\nexport class PulseAnimation {\r\n  private readonly opts: IPulseAnimationOptions;\r\n  private v: number;\r\n\r\n  private mEaseState = { cancel: false };\r\n\r\n  constructor(options: IPulseAnimationOptions) {\r\n    this.opts = Object.assign(\r\n      {},\r\n      {\r\n        from: 0,\r\n        time: 0.2,\r\n        ease: EaseFunc.EASE_OUT_CUBIC,\r\n      },\r\n      options\r\n    );\r\n    this.v = this.opts.from;\r\n\r\n    setTimeout(() => this.opts.update(this.v), 0);\r\n  }\r\n\r\n  send(): Promise<void> {\r\n    this.mEaseState.cancel = true;\r\n    this.mEaseState = { cancel: false };\r\n\r\n    let resolve: () => void;\r\n    const p = new Promise<void>((_resolve) => {\r\n      resolve = _resolve;\r\n    });\r\n\r\n    const {\r\n      mEaseState,\r\n      opts: { update: keyframe, ease },\r\n    } = this;\r\n\r\n    const v0 = this.v;\r\n    const v1 = this.opts.to;\r\n    const v2 = this.opts.from;\r\n    const dt2 = this.opts.time / 2;\r\n    const dt1 = (Math.abs(v1 - v0) / Math.abs(v2 - v1)) * dt2;\r\n    const dt = dt1 + dt2;\r\n\r\n    let t0 = window.performance.now();\r\n    const fn = (t: number) => {\r\n      if (mEaseState.cancel) {\r\n        resolve();\r\n        return;\r\n      }\r\n      const dts = (t - t0) / 1000;\r\n      if (dts >= dt) {\r\n        this.v = v2;\r\n        resolve();\r\n        return;\r\n      }\r\n      if (dts < dt1) {\r\n        this.v = ease.interpolate(v0, v1, dts / dt1);\r\n      } else {\r\n        this.v = ease.interpolate(v2, v1, 1 - (dts - dt1) / dt2);\r\n      }\r\n      keyframe(this.v);\r\n      window.requestAnimationFrame(fn);\r\n    };\r\n    fn(t0);\r\n\r\n    return p;\r\n  }\r\n}\r\n","import { Filter } from \"pixi.js\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { Component, Shader } from \"./pixi/Component\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\nimport { PointerHandler } from \"./pixi/events/PointerHandler\";\r\nimport { PulseAnimation } from \"./pixi/animations/PulseAnimation\";\r\nimport { RenderBuffer } from \"./pixi/RenderBuffer\";\r\nimport { TargetAnimation } from \"./pixi/animations/TargetAnimation\";\r\nimport HoverGlowGlsl from \"../shaders/HoverGlow.glsl\";\r\nimport { App } from \"./pixi/App\";\r\nimport { Cell } from \"./pixi/Cell\";\r\n\r\nclass HoverGlowTexture extends RenderBuffer {\r\n  layout = {\r\n    width: 128,\r\n    height: 128,\r\n  };\r\n\r\n  private shader: Filter;\r\n\r\n  constructor() {\r\n    super({});\r\n\r\n    this.shader = this.addShader(HoverGlowGlsl, {\r\n      uTime0: 0,\r\n      uLightDsSampler: App.texture(\"LightDS_00.png\"),\r\n      uGlowSampler: App.texture(\"GrdFresh_00.png\"),\r\n    });\r\n\r\n    const { width, height } = this.layout;\r\n\r\n    this.addSprite({\r\n      width,\r\n      height,\r\n      filters: [this.shader],\r\n    });\r\n  }\r\n\r\n  reset() {\r\n    this.shader.uniforms.uTime0 = Shader.time();\r\n  }\r\n\r\n  static readonly V = new HoverGlowTexture();\r\n}\r\n\r\ntype CardInteractionsInternalState = \"disabled\" | \"normal\" | \"hover\";\r\n\r\ninterface ICardInteractionsOptions {\r\n  radius: number;\r\n}\r\n\r\nexport class CardInteractions {\r\n  readonly on = Cell.of(true);\r\n  readonly disabled = Cell.of(false);\r\n  readonly selected = Cell.of(false);\r\n\r\n  private onTapFn: () => void = () => {};\r\n\r\n  onTap(onTapFn?: () => void) {\r\n    this.onTapFn = onTapFn || (() => {});\r\n  }\r\n\r\n  private constructor(\r\n    public readonly obj: Component,\r\n    options?: ICardInteractionsOptions\r\n  ) {\r\n    const self = this;\r\n    const { radius = 0 } = options || {};\r\n\r\n    obj.anchor.set(0.5);\r\n\r\n    const { width, height } = obj.layout;\r\n\r\n    const overlay = obj\r\n      .addGraphics()\r\n      .beginFill(Color.WHITE.i32)\r\n      .drawRoundedRect(0, 0, width, height, radius);\r\n    overlay.alpha = 0;\r\n\r\n    const overlay1 = obj\r\n      .addGraphics()\r\n      .beginFill(Color.BLACK.i32)\r\n      .drawRoundedRect(0, 0, width, height, radius);\r\n    overlay1.alpha = 0;\r\n\r\n    const glow = obj.addSprite({\r\n      width,\r\n      height,\r\n      texture: HoverGlowTexture.V.texture,\r\n    });\r\n    glow.mask = obj\r\n      .addGraphics()\r\n      .beginFill(Color.WHITE.i32)\r\n      .drawRoundedRect(0, 0, width, height, radius);\r\n    glow.visible = false;\r\n\r\n    const cardTilt = TargetAnimation.of(0)\r\n      .onEase(0.1, EaseFunc.EASE_IN_OUT_EXPO)\r\n      .onUpdate((v) => (obj.angle = v));\r\n\r\n    const overlayAlpha = TargetAnimation.of(0)\r\n      .onEase(0.2, EaseFunc.EASE_IN_OUT_EXPO)\r\n      .onUpdate((v) => (overlay.alpha = v));\r\n\r\n    const overlayAlpha1 = TargetAnimation.of(0)\r\n      .onEase(0.2, EaseFunc.EASE_IN_OUT_EXPO)\r\n      .onUpdate((v) => (overlay1.alpha = v));\r\n\r\n    const cardClickAnim = new PulseAnimation({\r\n      from: 1,\r\n      to: 1.04,\r\n      time: 0.15,\r\n      update: (v) => obj.scale.set(v),\r\n    });\r\n\r\n    const state = Cell.of<CardInteractionsInternalState>(\"normal\").onUpdate(\r\n      (s, s0) => {\r\n        if (s0 == s) {\r\n          return;\r\n        }\r\n        switch (s) {\r\n          case \"normal\":\r\n            {\r\n              cardTilt.update(0);\r\n              overlayAlpha.update(0);\r\n              overlayAlpha1.update(0);\r\n              glow.visible = false;\r\n            }\r\n            break;\r\n          case \"hover\":\r\n            {\r\n              cardTilt.update(-2);\r\n              overlayAlpha.update(0.2);\r\n              overlayAlpha1.update(0);\r\n              HoverGlowTexture.V.reset();\r\n              glow.visible = true;\r\n            }\r\n            break;\r\n          case \"disabled\":\r\n            {\r\n              cardTilt.update(0);\r\n              overlayAlpha.update(0);\r\n              overlayAlpha1.update(0.5);\r\n              glow.visible = false;\r\n            }\r\n            break;\r\n        }\r\n      }\r\n    );\r\n\r\n    let hover = false;\r\n    const interaction = obj.handle(\r\n      class extends PointerHandler {\r\n        stops: EventType[] = [\"pointer\"];\r\n\r\n        enter(pos: Coordinate): void {\r\n          hover = true;\r\n          if (!self.disabled.value) {\r\n            state.update(\"hover\");\r\n          }\r\n        }\r\n\r\n        move(pos: Coordinate): void {\r\n          if (!self.disabled.value) {\r\n            state.update(\"hover\");\r\n          }\r\n        }\r\n\r\n        leave(pos: Coordinate): void {\r\n          hover = false;\r\n          if (!self.selected.value && !self.disabled.value) {\r\n            state.update(\"normal\");\r\n          }\r\n        }\r\n\r\n        tap(pos: Coordinate): void {\r\n          if (!self.disabled.value) {\r\n            cardClickAnim.send();\r\n            self.onTapFn();\r\n          }\r\n        }\r\n      }\r\n    );\r\n\r\n    this.on.onUpdate((ok, ok0) => {\r\n      if (ok != ok0) {\r\n        interaction.toggle(ok);\r\n        state.update(\r\n          this.disabled.value ? \"disabled\" : hover ? \"hover\" : \"normal\"\r\n        );\r\n      }\r\n    });\r\n    this.disabled.onUpdate((ok, ok0) => {\r\n      if (ok != ok0) {\r\n        state.update(ok ? \"disabled\" : hover ? \"hover\" : \"normal\");\r\n      }\r\n    });\r\n    this.selected.onUpdate((ok, ok0) => {\r\n      if (ok != ok0) {\r\n        state.update(\r\n          this.disabled.value ? \"disabled\" : ok || hover ? \"hover\" : \"normal\"\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  static install(\r\n    self: Component,\r\n    options?: ICardInteractionsOptions\r\n  ): CardInteractions {\r\n    return new CardInteractions(self, options);\r\n  }\r\n}\r\n","export default \"uniform float uTime0;\\r\\nuniform sampler2D uGlowSampler;\\r\\nuniform sampler2D uLightDsSampler;\\r\\n\\r\\nvoid main() {\\r\\n  float angle = -60.0;\\r\\n  float speed = 5.5;\\r\\n  float scale = 3.0;\\r\\n  float offset = 4.0;\\r\\n  float interval = 6.0;\\r\\n  float alpha = 0.35;\\r\\n  float time = iTime - uTime0;\\r\\n  vec2 dp = time * vec2(-1.0, 0.0) * speed;\\r\\n  vec2 pos = (vVertexPosition + dp) * rotate2D(angle);\\r\\n  float x = clamp(mod(pos.x + offset, interval) * scale, 0.0, 1.0);\\r\\n  vec4 blend = texture2D(uLightDsSampler, vec2(x, 0.5));\\r\\n  vec4 color = texture2D(uGlowSampler, vVertexPosition);\\r\\n  gl_FragColor = vec4(color.rgb * blend.r, blend.a) * alpha;\\r\\n}\\r\\n\"","import { Card } from \"../../core/Card\";\r\nimport { CardGridComponent } from \"./CardGridComponent\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { GridComponent } from \"./GridComponent\";\r\nimport { App } from \"./pixi/App\";\r\nimport { CardInteractions } from \"./CardInteractions\";\r\nimport { SpFireTexture } from \"./SpFireTexture\";\r\n\r\ninterface ISmallCardComponentProps {\r\n  card: Card;\r\n  spFire: boolean;\r\n}\r\n\r\nexport class SmallCardComponent extends Component<ISmallCardComponentProps> {\r\n  readonly interactions: CardInteractions;\r\n\r\n  layout = {\r\n    width: 153 * 2,\r\n    height: 196 * 2,\r\n    radius: 7 * 2,\r\n    padding: 9 * 2,\r\n    boardScale: 0.934,\r\n    bgColor: 0x4f5055,\r\n    szMeter: {\r\n      margin: 6 * 2,\r\n      radius: 11 * 2,\r\n      width: 48 * 2,\r\n      height: 44 * 2,\r\n    },\r\n    spMeter: {\r\n      x: 58 * 2,\r\n      y: 153 * 2,\r\n      width: 13 * 2,\r\n      padding: 1.5 * 2,\r\n    },\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      card: Card.fromId(1),\r\n      spFire: false,\r\n    });\r\n\r\n    const {\r\n      width,\r\n      height,\r\n      radius,\r\n      padding,\r\n      boardScale,\r\n      bgColor,\r\n      spMeter: spMeterLayout,\r\n      szMeter: szMeterLayout,\r\n    } = this.layout;\r\n\r\n    const root = this.addContainer();\r\n\r\n    const cardRoot = this.addContainer({ parent: root });\r\n\r\n    const bg = this.addGraphics({ parent: cardRoot })\r\n      .beginFill(bgColor)\r\n      .drawRoundedRect(0, 0, width, height, radius);\r\n\r\n    const img = this.addSprite({\r\n      parent: cardRoot,\r\n      x: 0,\r\n      y: padding,\r\n      width,\r\n      height,\r\n      tint: Color.fromHex(0xafafaf),\r\n    });\r\n\r\n    const grid = this.addComponent(new CardGridComponent(), {\r\n      parent: cardRoot,\r\n      x: padding,\r\n      y: padding,\r\n      scale: { width: width - 2 * padding, height: width - 2 * padding },\r\n    });\r\n    grid.update({ flat: true });\r\n    grid.scale.y = boardScale;\r\n\r\n    this.addGraphics({ parent: cardRoot })\r\n      .beginFill(Color.BLACK.i32)\r\n      .drawRoundedRect(\r\n        szMeterLayout.margin,\r\n        height - szMeterLayout.margin - szMeterLayout.height,\r\n        szMeterLayout.width,\r\n        szMeterLayout.height,\r\n        szMeterLayout.radius\r\n      );\r\n\r\n    const szMeter = this.addText({\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      x: szMeterLayout.margin + szMeterLayout.width / 2,\r\n      y: height - szMeterLayout.margin - szMeterLayout.height / 2,\r\n      style: {\r\n        fill: 0xeeeeee,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: szMeterLayout.height * 0.7,\r\n      },\r\n    });\r\n\r\n    const spMeterRoot = this.addContainer({\r\n      parent: root,\r\n      x: spMeterLayout.x + 20,\r\n      y: spMeterLayout.y + 20,\r\n    });\r\n    const sxy = spMeterLayout.width / 40;\r\n    spMeterRoot.scale.set(sxy);\r\n    const dx = 40 + spMeterLayout.padding / sxy;\r\n    const spMeter = this.addComponent(new GridComponent(), {\r\n      parent: spMeterRoot,\r\n    });\r\n    spMeter.update({\r\n      tileset: new Map([[true, \"pure_orange.png\"]]),\r\n      transform: {\r\n        anchor: 0.5,\r\n        dx,\r\n        dy: dx,\r\n      },\r\n    });\r\n\r\n    const tiles1 = new Map();\r\n    const tiles2 = new Map([[true, SpFireTexture.P1]]);\r\n    const spFireGrid = this.addComponent(new GridComponent(), {\r\n      parent: spMeterRoot,\r\n      y: -16,\r\n    }).update({\r\n      tileset: tiles1,\r\n      transform: {\r\n        anchor: 0.5,\r\n        dx,\r\n        dy: dx,\r\n      },\r\n    });\r\n\r\n    this.props.card.onUpdate((card) => {\r\n      if (card == null) {\r\n        return;\r\n      }\r\n      img.texture = App.texture(`cards/${card.meta.name}.png`);\r\n      grid.update({ card });\r\n      szMeter.text = `${card.meta.spaceCount}`;\r\n      const matrix = {\r\n        spaces: Array(card.meta.specialCost).fill(true),\r\n        width: 5,\r\n        height: 2,\r\n      };\r\n      spMeter.update({ matrix });\r\n      spFireGrid.update({ matrix });\r\n\r\n      this.lock(cardRoot);\r\n      spMeter.lock();\r\n    });\r\n    this.props.spFire.onUpdate((ok) => {\r\n      spFireGrid.update({ tileset: ok ? tiles2 : tiles1 });\r\n    });\r\n\r\n    this.interactions = CardInteractions.install(this, { radius });\r\n  }\r\n}\r\n","import { Card } from \"../../core/Card\";\r\nimport { SmallCardComponent } from \"./SmallCardComponent\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\n\r\ninterface IHandComponentProps {\r\n  cards: Card[];\r\n}\r\n\r\nexport class HandComponent extends Component<IHandComponentProps> {\r\n  private selectCardId: number = -1;\r\n  private selectCardCallBack: any;\r\n  private readonly cards: SmallCardComponent[];\r\n\r\n  layout = {\r\n    width: 358,\r\n    height: 436,\r\n    radius: 10,\r\n    card: {\r\n      width: 153,\r\n      height: 196,\r\n    },\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      cards: Array(4).fill(Card.fromId(1)),\r\n    });\r\n\r\n    const rect = this.addGraphics()\r\n      .beginFill(Color.BLACK.i32)\r\n      .drawRoundedRect(\r\n        0,\r\n        0,\r\n        this.layout.width,\r\n        this.layout.height,\r\n        this.layout.radius\r\n      );\r\n    rect.alpha = 0.18;\r\n\r\n    const paddingX = (this.layout.width - 2 * this.layout.card.width) / 3;\r\n    const paddingY = (this.layout.height - 2 * this.layout.card.height) / 3;\r\n    this.cards = [];\r\n    for (let y = 0; y < 2; ++y) {\r\n      for (let x = 0; x < 2; ++x) {\r\n        const idx = x + y * 2;\r\n        const cardRoot = this.addContainer({\r\n          x: (x + 0.5) * this.layout.card.width + (x + 1) * paddingX,\r\n          y: (y + 0.5) * this.layout.card.height + (y + 1) * paddingY,\r\n        });\r\n        const card = this.addComponent(new SmallCardComponent(), {\r\n          parent: cardRoot,\r\n          anchor: 0.5,\r\n          scale: {\r\n            width: this.layout.card.width,\r\n            height: this.layout.card.height,\r\n          },\r\n        });\r\n        card.interactions.onTap(() => this.uiSelectCard(idx));\r\n        this.cards.push(card);\r\n      }\r\n    }\r\n\r\n    this.onSelectCard();\r\n\r\n    this.props.cards.onUpdate((v) => {\r\n      console.assert(v.length == 4);\r\n      v.forEach((card, i) => this.cards[i].update({ card }));\r\n    });\r\n  }\r\n\r\n  async uiDrawCard(v: Card, i: number) {\r\n    console.assert(0 <= i && i < 4);\r\n\r\n    const li = this.props.cards.value.slice();\r\n    li[i] = v;\r\n\r\n    const card = this.cards[i];\r\n    const a1 = this.addAnimation((t) => {\r\n      const e = EaseFunc.EASE_IN_CUBIC.apply(t);\r\n      card.ui.alpha = 1 - e;\r\n      card.ui.scale.set(EaseFunc.LINEAR.interpolate(1, 0.9, e));\r\n      card.position.y = 0;\r\n    });\r\n\r\n    const a2 = this.addAnimation((t) => {\r\n      const e = EaseFunc.EASE_OUT_CUBIC.apply(t);\r\n      card.ui.alpha = e;\r\n      card.ui.scale.set(1);\r\n      card.position.y = EaseFunc.LINEAR.interpolate(10, 0, e);\r\n    });\r\n\r\n    const dt = 0.3;\r\n    await a1.play(dt);\r\n    this.update({ cards: li });\r\n    await a2.play(dt);\r\n  }\r\n\r\n  uiSelectCard(idx: number = -1) {\r\n    this.selectCardId = idx;\r\n    this.cards.forEach((card, i) => {\r\n      if (i != idx) {\r\n        card.interactions.selected.update(false);\r\n      } else {\r\n        card.interactions.selected.update(true);\r\n      }\r\n    });\r\n    this.selectCardCallBack(idx);\r\n  }\r\n\r\n  uiUpdateFilter(ok?: boolean[]) {\r\n    ok = ok || Array(4).fill(true);\r\n    ok.forEach((ok, i) => {\r\n      this.cards[i].interactions.disabled.update(!ok);\r\n      if (!ok && i == this.selectCardId) {\r\n        this.uiSelectCard();\r\n      }\r\n    });\r\n  }\r\n\r\n  uiUpdateSpFire(ok?: boolean[]) {\r\n    ok = ok || Array(4).fill(false);\r\n    ok.forEach((ok, i) => {\r\n      this.cards[i].update({ spFire: ok });\r\n    });\r\n  }\r\n\r\n  get selectId() {\r\n    return this.selectCardId;\r\n  }\r\n\r\n  onSelectCard(callback?: (cardId: number) => void) {\r\n    this.selectCardCallBack = callback || (() => {});\r\n  }\r\n}\r\n","import { Component } from \"./pixi/Component\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\nimport { ColorPalette } from \"./ColorPalette\";\r\nimport { Card } from \"../../core/Card\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport SpCutInBgGlsl from \"../shaders/SpCutInBg.glsl\";\r\nimport SpCutInImgGlsl from \"../shaders/SpCutInImg.glsl\";\r\nimport { App } from \"./pixi/App\";\r\n\r\ninterface ISpCutInAnimationProps {\r\n  card1: Card | null;\r\n  card2: Card | null;\r\n}\r\n\r\nexport class SpCutInAnimation extends Component<ISpCutInAnimationProps> {\r\n  layout = {\r\n    width: 1920,\r\n    height: 1080,\r\n    cutin: {\r\n      width: 400,\r\n      height: 700,\r\n      dx: 28,\r\n      dy: 20,\r\n      img: {\r\n        width: 365,\r\n        height: 512,\r\n        dx: 10,\r\n        dy: 8,\r\n      },\r\n      p1: {\r\n        x: 880,\r\n        y: 700,\r\n        ink1: {\r\n          x: -4,\r\n          y: -210,\r\n          width: 400,\r\n          height: 400,\r\n          angle: 60,\r\n          img: \"Ink_02.png\",\r\n        },\r\n        ink2: {\r\n          x: 110,\r\n          y: 194,\r\n          width: 200,\r\n          height: 200,\r\n          angle: 0,\r\n          img: \"InkNormal_00.png\",\r\n        },\r\n        img: {\r\n          y0: 100,\r\n          y1: -50,\r\n        },\r\n      },\r\n      p2: {\r\n        x: 1320,\r\n        y: 260,\r\n        ink1: {\r\n          x: 53,\r\n          y: -211,\r\n          width: 200,\r\n          height: 200,\r\n          angle: -120,\r\n          img: \"InkNormal_00.png\",\r\n        },\r\n        ink2: {\r\n          x: 17,\r\n          y: 228,\r\n          width: 400,\r\n          height: 400,\r\n          angle: -120,\r\n          img: \"Ink_02.png\",\r\n        },\r\n        img: {\r\n          y0: -100,\r\n          y1: 50,\r\n        },\r\n      },\r\n    },\r\n  };\r\n\r\n  private anims: (() => Promise<any>)[] = [];\r\n\r\n  constructor() {\r\n    super({\r\n      card1: null,\r\n      card2: null,\r\n    });\r\n\r\n    const { width, height, dx, dy, p1, p2 } = this.layout.cutin;\r\n\r\n    const parent = this.addContainer({\r\n      y: 18,\r\n    });\r\n\r\n    for (const { p, c, card } of [\r\n      { p: p1, c: ColorPalette.Player1.spCutIn, card: this.props.card1 },\r\n      { p: p2, c: ColorPalette.Player2.spCutIn, card: this.props.card2 },\r\n    ]) {\r\n      const bgShader = this.addShader(SpCutInBgGlsl, {\r\n        uColorFgPrimary: c.fg.primary.rgb01,\r\n        uColorFgSecondary: c.fg.secondary.rgb01,\r\n        uColorBg: c.bg.rgb01,\r\n        uPatternSampler: App.texture(\"thunder_pattern.png\"),\r\n      });\r\n\r\n      const imgShader = this.addShader(SpCutInImgGlsl, {\r\n        uColor: c.img.rgb01,\r\n      });\r\n\r\n      const ciRoot = this.addContainer({\r\n        parent,\r\n        x: p.x,\r\n        y: p.y,\r\n      });\r\n      const ci1 = this.addSprite({\r\n        parent: ciRoot,\r\n        x: -width / 2 + dx,\r\n        y: -height / 2 + dy,\r\n        width,\r\n        height,\r\n        texture: \"CutIn.png\",\r\n      });\r\n      ci1.tint = 0x1f1f1f;\r\n      ci1.alpha = 0.7;\r\n      const ci = this.addSprite({\r\n        parent: ciRoot,\r\n        x: -width / 2,\r\n        y: -height / 2,\r\n        width,\r\n        height,\r\n        texture: \"CutIn.png\",\r\n        filters: [bgShader],\r\n      });\r\n\r\n      const fn = (layout: any) => {\r\n        const inkRoot = this.addContainer({\r\n          parent: ciRoot,\r\n          x: layout.x,\r\n          y: layout.y,\r\n        });\r\n        const inkRoot1 = this.addContainer({\r\n          parent: inkRoot,\r\n          angle: layout.angle,\r\n        });\r\n        const ink = this.addSprite({\r\n          parent: inkRoot1,\r\n          x: -layout.width / 2,\r\n          y: -layout.height / 2,\r\n          width: layout.width,\r\n          height: layout.height,\r\n          texture: layout.img,\r\n        });\r\n        ink.tint = c.ink.i32;\r\n        return inkRoot;\r\n      };\r\n\r\n      const ink1 = fn(p.ink1);\r\n      const ink2 = fn(p.ink2);\r\n\r\n      const imgLayout = this.layout.cutin.img;\r\n      const imgRoot = this.addContainer({\r\n        parent: ciRoot,\r\n      });\r\n      const imgRoot1 = this.addContainer({\r\n        parent: imgRoot,\r\n      });\r\n      imgRoot1.scale.set(1.2);\r\n      const img1 = this.addSprite({\r\n        parent: imgRoot1,\r\n        x: -imgLayout.width / 2 + imgLayout.dx,\r\n        y: -imgLayout.height / 2 + imgLayout.dy,\r\n        width: imgLayout.width,\r\n        height: imgLayout.height,\r\n        filters: [imgShader],\r\n      });\r\n      const img = this.addSprite({\r\n        parent: imgRoot1,\r\n        x: -imgLayout.width / 2,\r\n        y: -imgLayout.height / 2,\r\n        width: imgLayout.width,\r\n        height: imgLayout.height,\r\n      });\r\n\r\n      card.onUpdate((v) => {\r\n        if (v != null) {\r\n          ciRoot.visible = true;\r\n          img1.texture = img.texture = App.texture(`cards/${v.meta.name}.png`);\r\n        } else {\r\n          ciRoot.visible = false;\r\n        }\r\n      });\r\n\r\n      const a1 = this.addAnimation((t) => {\r\n        let e = EaseFunc.EASE_OUT_BACK.apply(t);\r\n        ciRoot.scale.x = e;\r\n\r\n        e = EaseFunc.LINEAR.apply(t);\r\n        imgRoot.alpha = e;\r\n        imgRoot.y = EaseFunc.LINEAR.interpolate(p.img.y0, 0, e);\r\n        img.tint = EaseFunc.LINEAR.interpolate(c.img, Color.WHITE, e).i32;\r\n      });\r\n\r\n      const a2 = this.addAnimation((t) => {\r\n        ink1.scale.set(EaseFunc.EASE_OUT_BACK.apply(t));\r\n      });\r\n\r\n      const a3 = this.addAnimation((t) => {\r\n        ink2.scale.set(EaseFunc.EASE_OUT_BACK.apply(t));\r\n      });\r\n\r\n      const a4 = this.addAnimation((t) => {\r\n        let e = EaseFunc.EASE_IN_CUBIC.apply(t);\r\n        ciRoot.scale.x = 1 - e;\r\n        ciRoot.alpha = 1 - e;\r\n        e = EaseFunc.LINEAR.apply(t);\r\n        imgRoot.alpha = 1 - e;\r\n        imgRoot.y = EaseFunc.LINEAR.interpolate(0, p.img.y1, e);\r\n        img.tint = EaseFunc.LINEAR.interpolate(Color.WHITE, c.img, e).i32;\r\n      });\r\n\r\n      const sleep = (t: number) =>\r\n        this.addAnimation({\r\n          time: t,\r\n        }).play();\r\n\r\n      const anim = async () => {\r\n        ciRoot.scale.x = 0;\r\n        ciRoot.alpha = 1;\r\n        ink1.scale.set(0);\r\n        ink2.scale.set(0);\r\n        imgRoot.alpha = 0;\r\n        await Promise.all([\r\n          a1.play(0.2),\r\n          sleep(0.1).then(() => {\r\n            return Promise.all([\r\n              a2.play(0.1),\r\n              sleep(0.05).then(() => {\r\n                return a3.play(0.1);\r\n              }),\r\n            ]);\r\n          }),\r\n        ]);\r\n        await sleep(1.5);\r\n        await a4.play(0.2);\r\n      };\r\n\r\n      this.anims.push(anim);\r\n    }\r\n  }\r\n\r\n  uiPlay(card1?: Card, card2?: Card): Promise<any> {\r\n    this.update({ card1, card2 });\r\n    return Promise.all(this.anims.map((f) => f()));\r\n  }\r\n}\r\n","export default \"uniform vec3 uColorFgPrimary;\\r\\nuniform vec3 uColorFgSecondary;\\r\\nuniform vec3 uColorBg;\\r\\n\\r\\nuniform sampler2D uPatternSampler;\\r\\n\\r\\nvoid main() {\\r\\n  float speed = 1.5;\\r\\n  vec2 du = normalize(vec2(-1.0, 0.3));\\r\\n\\r\\n  vec2 p1 = vVertexPosition * vec2(outputFrame.z / outputFrame.w, 1.0);\\r\\n  vec2 pos = (p1 + iTime * du * speed) * rotate2D(-20.0);\\r\\n  float a1 = sin(iTime * 8.0) * 0.5 + 0.5;\\r\\n  float a2 = texture2D(uPatternSampler, pos).x * 0.3;\\r\\n  vec3 fg = mix(uColorFgPrimary, uColorFgSecondary, a1);\\r\\n  vec3 color = mix(fg, uColorBg, a2);\\r\\n\\r\\n  float alpha = texture2D(uSampler, vTextureCoord).a;\\r\\n  gl_FragColor = vec4(color * alpha, alpha);\\r\\n}\"","export default \"uniform vec3 uColor;\\r\\n\\r\\nvoid main() {\\r\\n  float alpha = texture2D(uSampler, vTextureCoord).a;\\r\\n  gl_FragColor = vec4(vec3(uColor * alpha), alpha);\\r\\n}\\r\\n\"","import { Texture } from \"pixi.js\";\r\nimport { ColorPalette } from \"./ColorPalette\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\n\r\ninterface IInkBeatComponentProps {\r\n  color: Color;\r\n  angle: number;\r\n  value: number;\r\n}\r\n\r\nclass InkBeatComponent extends Component<IInkBeatComponentProps> {\r\n  layout = {\r\n    width: 0,\r\n    height: 0,\r\n    inkbeat: {\r\n      width: 140,\r\n      height: 140,\r\n    },\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      color: Color.WHITE,\r\n      angle: 0,\r\n      value: 0,\r\n    });\r\n\r\n    const { width, height } = this.layout.inkbeat;\r\n\r\n    const root = this.addContainer();\r\n\r\n    const bgRoot = this.addContainer({ parent: root });\r\n    this.addSprite({\r\n      parent: bgRoot,\r\n      anchor: 0.5,\r\n      width,\r\n      height,\r\n      x: 2,\r\n      y: 2,\r\n      tint: Color.BLACK,\r\n      alpha: 0.5,\r\n      texture: \"InkBeatS_00.png\",\r\n    });\r\n    const bg = this.addSprite({\r\n      parent: bgRoot,\r\n      anchor: 0.5,\r\n      width,\r\n      height,\r\n      texture: \"InkBeatS_00.png\",\r\n    });\r\n\r\n    const text1 = this.addText({\r\n      anchor: 0.5,\r\n      x: 2,\r\n      y: 2,\r\n      alpha: 0.7,\r\n      style: {\r\n        fill: Color.BLACK.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 36,\r\n      },\r\n    });\r\n    const text = this.addText({\r\n      anchor: 0.5,\r\n      style: {\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 36,\r\n      },\r\n    });\r\n\r\n    const fn = () => {\r\n      const color = this.props.color.value;\r\n      const value = this.props.value.value;\r\n      if (value >= 0) {\r\n        bg.tint = color.i32;\r\n        text.style.fill = Color.WHITE.i32;\r\n        text1.text = text.text = `+${value}`;\r\n      } else {\r\n        bg.tint = Color.fromHex(0xc8c8c8).i32;\r\n        text.style.fill = Color.fromHex(0x4c4c4c).i32;\r\n        text1.text = text.text = `${value}`;\r\n      }\r\n      this.lock(bgRoot);\r\n    };\r\n    this.props.value.onUpdate(fn);\r\n    this.props.color.onUpdate(fn);\r\n    this.props.angle.onUpdate((v) => (bgRoot.angle = v));\r\n\r\n    this.ui.alpha = 0;\r\n  }\r\n}\r\n\r\ninterface ISzMeterComponentProps {\r\n  value1: number;\r\n  value2: number;\r\n  preview: boolean;\r\n  preview1: number;\r\n  preview2: number;\r\n}\r\n\r\nexport class SzMeterComponent extends Component<ISzMeterComponentProps> {\r\n  layout = {\r\n    width: 0,\r\n    height: 0,\r\n    p1: {\r\n      text: {\r\n        x: 10,\r\n        y: 94,\r\n      },\r\n      inkbeat: {\r\n        x: 10 + 54,\r\n        y: 94 - 57,\r\n        angle: -45,\r\n      },\r\n      ink: {\r\n        x: -18,\r\n        y: 80,\r\n        width: 360,\r\n        scale: 1,\r\n        angle: -25,\r\n        alpha: 0.8,\r\n        img: \"Ink_04.png\",\r\n      },\r\n    },\r\n    p2: {\r\n      text: {\r\n        x: 34,\r\n        y: -94,\r\n      },\r\n      inkbeat: {\r\n        x: 34 + 54,\r\n        y: -94 - 57,\r\n        angle: 0,\r\n      },\r\n      ink: {\r\n        x: 42,\r\n        y: -120,\r\n        width: 360,\r\n        scale: -1,\r\n        angle: 0,\r\n        alpha: 0.8,\r\n        img: \"Ink_02.png\",\r\n      },\r\n    },\r\n  };\r\n\r\n  private readonly playFn: (v1: number, v2: number) => Promise<any>;\r\n\r\n  constructor() {\r\n    super({\r\n      value1: 0,\r\n      value2: 0,\r\n      preview: false,\r\n      preview1: 0,\r\n      preview2: 0,\r\n    });\r\n\r\n    const skew = (Math.PI * -15) / 180;\r\n\r\n    const [text1, text2] = [\r\n      { p: this.layout.p1, c: ColorPalette.Player1 },\r\n      { p: this.layout.p2, c: ColorPalette.Player2 },\r\n    ].map(({ p, c }) => {\r\n      const { x, y, img, width, scale, angle, alpha } = p.ink;\r\n      this.addSprite({\r\n        anchor: 0.5,\r\n        x,\r\n        y,\r\n        width,\r\n        height: width,\r\n        angle,\r\n        scale: {\r\n          x: scale,\r\n          y: 1,\r\n        },\r\n        tint: c.szMeter.bg,\r\n        alpha: alpha,\r\n        texture: img,\r\n      });\r\n\r\n      const root = this.addContainer({\r\n        x: p.text.x,\r\n        y: p.text.y,\r\n      });\r\n      const text1 = this.addText({\r\n        parent: root,\r\n        anchor: 0.5,\r\n        x: 5,\r\n        y: 4,\r\n        alpha: 0.5,\r\n        style: {\r\n          fill: Color.BLACK.i32,\r\n          fontFamily: \"Splatoon\",\r\n          fontSize: 120,\r\n        },\r\n      });\r\n      text1.skew.set(skew, 0);\r\n\r\n      const text = this.addText({\r\n        parent: root,\r\n        anchor: 0.5,\r\n        style: {\r\n          fill: c.szMeter.fg.i32,\r\n          fontFamily: \"Splatoon\",\r\n          fontSize: 120,\r\n        },\r\n      });\r\n      text.skew.set(skew, 0);\r\n\r\n      return { root, text, text1 };\r\n    });\r\n\r\n    const previewRoot = this.addContainer();\r\n    const [preview1, preview2] = [\r\n      { p: this.layout.p1, c: ColorPalette.Player1 },\r\n      { p: this.layout.p2, c: ColorPalette.Player2 },\r\n    ].map(({ p, c }) => {\r\n      const parent = this.addContainer({\r\n        parent: previewRoot,\r\n        x: p.text.x - 25,\r\n        y: p.text.y + 85,\r\n      });\r\n\r\n      this.addSprite({\r\n        parent,\r\n        anchor: 0.5,\r\n        x: 3,\r\n        y: 2,\r\n        width: 50,\r\n        height: 50,\r\n        angle: 180,\r\n        alpha: 0.5,\r\n        tint: Color.BLACK,\r\n        texture: \"MngArrow.png\",\r\n      });\r\n      this.addSprite({\r\n        parent,\r\n        anchor: 0.5,\r\n        x: 0,\r\n        y: 0,\r\n        width: 50,\r\n        height: 50,\r\n        angle: 180,\r\n        tint: c.szMeter.fg,\r\n        texture: \"MngArrow.png\",\r\n      });\r\n\r\n      const text1 = this.addText({\r\n        parent,\r\n        anchor: { x: 0, y: 0.5 },\r\n        x: 53,\r\n        y: 2,\r\n        alpha: 0.5,\r\n        style: {\r\n          fill: Color.BLACK.i32,\r\n          fontFamily: \"Splatoon\",\r\n          fontSize: 50,\r\n        },\r\n      });\r\n      text1.skew.set(skew, 0);\r\n\r\n      const text = this.addText({\r\n        parent,\r\n        anchor: { x: 0, y: 0.5 },\r\n        x: 50,\r\n        style: {\r\n          fill: c.szMeter.fg.i32,\r\n          fontFamily: \"Splatoon\",\r\n          fontSize: 50,\r\n        },\r\n      });\r\n      text.skew.set(skew, 0);\r\n\r\n      return { text, text1 };\r\n    });\r\n\r\n    const [inkbeat1, inkbeat2] = [\r\n      { p: this.layout.p1, c: ColorPalette.Player1 },\r\n      { p: this.layout.p2, c: ColorPalette.Player2 },\r\n    ].map(({ p, c }) => {\r\n      const { x, y, angle } = p.inkbeat;\r\n      const ib = this.addComponent(new InkBeatComponent(), {\r\n        x,\r\n        y,\r\n      });\r\n      ib.update({ color: c.primary, angle });\r\n      return ib;\r\n    });\r\n\r\n    this.props.value1.onUpdate(\r\n      (v) => (text1.text1.text = text1.text.text = `${v}`)\r\n    );\r\n    this.props.value2.onUpdate(\r\n      (v) => (text2.text1.text = text2.text.text = `${v}`)\r\n    );\r\n    this.props.preview.onUpdate((v) => (previewRoot.visible = v));\r\n    this.props.preview1.onUpdate(\r\n      (v) => (preview1.text.text = preview1.text1.text = `${v}`)\r\n    );\r\n    this.props.preview2.onUpdate(\r\n      (v) => (preview2.text.text = preview2.text1.text = `${v}`)\r\n    );\r\n\r\n    this.playFn = async (v1: number, v2: number) => {\r\n      v1 = v1 != null ? v1 : this.props.value1.value;\r\n      v2 = v2 != null ? v2 : this.props.value2.value;\r\n\r\n      const dv1 = v1 - this.props.value1.value;\r\n      const dv2 = v2 - this.props.value2.value;\r\n\r\n      inkbeat1.update({ value: dv1 });\r\n      inkbeat2.update({ value: dv2 });\r\n\r\n      await Promise.all(\r\n        [inkbeat1, inkbeat2]\r\n          .map((ib) =>\r\n            this.addAnimation((t) => {\r\n              const e = EaseFunc.EASE_OUT_BACK.apply(t);\r\n              ib.scale.set(e);\r\n              ib.ui.alpha = 1;\r\n            })\r\n          )\r\n          .map((a) => a.play(0.2))\r\n      );\r\n\r\n      await this.addAnimation().play(0.5);\r\n\r\n      await Promise.all(\r\n        [inkbeat1, inkbeat2]\r\n          .map((ib) =>\r\n            this.addAnimation((t) => {\r\n              const e = 1 - EaseFunc.EASE_IN_CUBIC.apply(t);\r\n              ib.scale.set(e);\r\n              ib.ui.alpha = e;\r\n            })\r\n          )\r\n          .map((a) => a.play(0.2))\r\n      );\r\n\r\n      this.update({ value1: v1, value2: v2 });\r\n\r\n      await Promise.all(\r\n        [text1, text2]\r\n          .map((text) =>\r\n            this.addAnimation((t) => {\r\n              const e = EaseFunc.EASE_OUT_BACK.apply(t);\r\n              text.root.scale.set(e);\r\n            })\r\n          )\r\n          .map((a) => a.play(0.2))\r\n      );\r\n    };\r\n  }\r\n\r\n  async uiUpdate(v1: number, v2: number) {\r\n    await this.playFn(v1, v2);\r\n  }\r\n}\r\n","import { Card } from \"../../core/Card\";\r\nimport { CardGridComponent } from \"./CardGridComponent\";\r\nimport { GridComponent } from \"./GridComponent\";\r\nimport { CardInteractions } from \"./CardInteractions\";\r\nimport { App } from \"./pixi/App\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { Component } from \"./pixi/Component\";\r\n\r\ninterface ICardComponentProps {\r\n  card: Card;\r\n  turn: Turn;\r\n}\r\n\r\nexport class CardComponent extends Component<ICardComponentProps> {\r\n  readonly interactions: CardInteractions;\r\n\r\n  layout = {\r\n    width: 344,\r\n    height: 480,\r\n    bg: {\r\n      width: 330,\r\n      height: 462,\r\n    },\r\n    frame: {\r\n      width: 308,\r\n      height: 445,\r\n      radius: 15,\r\n      dxy: 10,\r\n    },\r\n    ink: {\r\n      width: 344,\r\n      height: 480,\r\n    },\r\n    cardName: {\r\n      x: 0,\r\n      y: -166,\r\n    },\r\n    szMeter: {\r\n      x: -124,\r\n      y: 192,\r\n    },\r\n    spMeter: {\r\n      x: -71,\r\n      y: 205,\r\n      dx: 48,\r\n      dy: -55,\r\n      width: 42,\r\n    },\r\n    grid: {\r\n      x: 88,\r\n      y: 155,\r\n      width: 320,\r\n      height: 320,\r\n    },\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      card: Card.fromId(1),\r\n      turn: 1,\r\n    });\r\n\r\n    const { width, height } = this.layout;\r\n\r\n    const root = this.addContainer({\r\n      x: width / 2,\r\n      y: height / 2,\r\n    });\r\n\r\n    const cardRoot = this.addContainer({ parent: root });\r\n\r\n    const bg = this.addSprite({\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      width: this.layout.bg.width,\r\n      height: this.layout.bg.height,\r\n    });\r\n\r\n    this.addSprite({\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      width: this.layout.ink.width,\r\n      height: this.layout.ink.height,\r\n      tint: Color.fromHex(0xd8d8d8),\r\n      texture: \"Ink_03.png\",\r\n    });\r\n\r\n    // TODO: until pixi-projection support graphics\r\n    // const w = this.layout.frame.width;\r\n    // const h = this.layout.frame.height;\r\n    // const r = this.layout.frame.radius;\r\n    // const w1 = w + this.layout.frame.dxy * 2;\r\n    // const h1 = h + this.layout.frame.dxy * 2;\r\n    // const r1 = r + this.layout.frame.dxy;\r\n    // const frame = this.addGraphics({\r\n    //   parent: cardRoot,\r\n    // })\r\n    //   .beginFill(Color.BLACK.i32)\r\n    //   .drawRoundedRect(-w1 / 2, -h1 / 2, w1, h1, r1)\r\n    //   .beginHole()\r\n    //   .drawRoundedRect(-w / 2, -h / 2, w, h, r);\r\n\r\n    const img = this.addSprite({\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      width,\r\n      height,\r\n    });\r\n\r\n    const cardName1 = this.addText({\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      x: this.layout.cardName.x,\r\n      y: this.layout.cardName.y,\r\n      style: {\r\n        fill: Color.BLACK.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 32,\r\n        strokeThickness: 8,\r\n      },\r\n    });\r\n    const cardName = this.addText({\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      x: this.layout.cardName.x,\r\n      y: this.layout.cardName.y,\r\n      style: {\r\n        fill: Color.WHITE.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 32,\r\n      },\r\n    });\r\n\r\n    const base = this.addSprite({\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      y: 192,\r\n      width: 324,\r\n      height: 86,\r\n      texture: \"CardFrame_01.png\",\r\n    });\r\n\r\n    const frame = this.addSprite({\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      width,\r\n      height,\r\n      texture: \"CardFrame_00.png\",\r\n    });\r\n\r\n    const szMeterRoot = this.addContainer({\r\n      parent: cardRoot,\r\n      x: this.layout.szMeter.x,\r\n      y: this.layout.szMeter.y,\r\n    });\r\n    const szMeterBg = this.addSprite({\r\n      parent: szMeterRoot,\r\n      anchor: 0.5,\r\n      width: 64,\r\n      height: 64,\r\n      angle: 45,\r\n    });\r\n    const szMeter1 = this.addText({\r\n      parent: szMeterRoot,\r\n      anchor: 0.5,\r\n      x: 1,\r\n      y: -2,\r\n      style: {\r\n        fill: Color.BLACK.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 28,\r\n        strokeThickness: 5,\r\n      },\r\n    });\r\n    const szMeter = this.addText({\r\n      parent: szMeterRoot,\r\n      anchor: 0.5,\r\n      x: 1,\r\n      y: -2,\r\n      style: {\r\n        fill: Color.WHITE.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 28,\r\n      },\r\n    });\r\n\r\n    const spMeterRoot = this.addContainer({\r\n      parent: cardRoot,\r\n      x: this.layout.spMeter.x,\r\n      y: this.layout.spMeter.y,\r\n    });\r\n    spMeterRoot.scale.set(0.4);\r\n    const spMeter = this.addComponent(new GridComponent(), {\r\n      parent: spMeterRoot,\r\n    });\r\n    spMeter.update({\r\n      tileset: new Map([\r\n        [1, \"player1_special_space.png\"],\r\n        [-1, \"player2_special_space.png\"],\r\n      ]),\r\n      transform: {\r\n        anchor: 0.5,\r\n        dx: this.layout.spMeter.dx,\r\n        dy: this.layout.spMeter.dy,\r\n      },\r\n    });\r\n\r\n    const grid = this.addComponent(new CardGridComponent(), {\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n      x: this.layout.grid.x,\r\n      y: this.layout.grid.y,\r\n      scale: {\r\n        width: this.layout.grid.width * 0.38,\r\n        height: this.layout.grid.width * 0.38,\r\n      },\r\n    });\r\n    grid.angle = 7;\r\n    grid.update({ flat: false });\r\n\r\n    const fn = () => {\r\n      const turn = this.props.turn.value;\r\n      const card = this.props.card.value;\r\n\r\n      if (card == null) {\r\n        return;\r\n      }\r\n\r\n      const { name, rarity, spaceCount, specialCost } = card.meta;\r\n\r\n      cardName1.text = cardName.text = name;\r\n\r\n      img.texture = App.texture(`cards/${name}.png`);\r\n\r\n      grid.update({ card, turn });\r\n\r\n      const l0 = { Common: \"Cmn\", Rare: \"Rre\", Fresh: \"Frh\" }[rarity];\r\n      bg.texture = App.texture(`MngCardBG_${l0}_00.png`);\r\n\r\n      const l1 = [\"Common\", \"Rare\", \"Fresh\"].indexOf(rarity);\r\n      szMeterBg.texture = App.texture(`CardCost_0${l1}.png`);\r\n      spMeter.update({\r\n        matrix: {\r\n          width: 5,\r\n          height: 2,\r\n          spaces: Array(specialCost).fill(turn),\r\n        },\r\n      });\r\n\r\n      szMeter1.text = szMeter.text = `${spaceCount}`;\r\n\r\n      this.lock(cardRoot);\r\n    };\r\n\r\n    this.props.card.onUpdate(fn);\r\n    this.props.turn.onUpdate(fn);\r\n\r\n    this.interactions = CardInteractions.install(this, { radius: 30 });\r\n  }\r\n}\r\n","import { Card } from \"../../core/Card\";\r\nimport { CardComponent } from \"./CardComponent\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\nimport { Camera3d, Container3d } from \"pixi-projection\";\r\nimport { Container, Texture } from \"pixi.js\";\r\n\r\ninterface ICardAnimationProps {\r\n  card: Card | null;\r\n  turn: Turn;\r\n}\r\n\r\nexport class GamePlayCardComponent extends Component<ICardAnimationProps> {\r\n  layout = {\r\n    width: 344,\r\n    height: 480,\r\n    radius: 32,\r\n    dxy: 3,\r\n  };\r\n\r\n  private readonly cardRoot: Container3d;\r\n\r\n  private readonly toggleSleeve: (ok: boolean) => void;\r\n  private readonly overlayRoot: Container;\r\n\r\n  constructor() {\r\n    super({\r\n      card: null,\r\n      turn: 1,\r\n    });\r\n\r\n    const { width: w, height: h, radius: r, dxy } = this.layout;\r\n    const root = this.addContainer({ x: w / 2, y: h / 2 });\r\n\r\n    const bgRoot = this.addContainer({ parent: root });\r\n    const w1 = w - 2 * dxy;\r\n    const h1 = h - 2 * dxy;\r\n    const r1 = r - dxy;\r\n    this.addGraphics({ parent: bgRoot })\r\n      .beginFill(0x888888)\r\n      .drawRoundedRect(-w / 2, -h / 2, w, h, r)\r\n      .beginHole()\r\n      .drawRoundedRect(-w1 / 2, -h1 / 2, w1, h1, r1);\r\n\r\n    const e = this.addGraphics({ parent: bgRoot })\r\n      .beginFill(Color.BLACK.i32)\r\n      .drawRoundedRect(-w1 / 2, -h1 / 2, w1, h1, r1);\r\n    e.alpha = 0.7;\r\n    this.lock(bgRoot);\r\n\r\n    const arrow = this.addSprite({\r\n      parent: root,\r\n      anchor: 0.5,\r\n      tint: Color.fromHex(0x333355),\r\n      texture: \"IconUp_00.png\",\r\n    });\r\n\r\n    const camera = new Camera3d();\r\n    camera.setPlanes(1000, 10, 10000);\r\n    root.addChild(camera);\r\n\r\n    this.cardRoot = new Container3d();\r\n    camera.addChild(this.cardRoot);\r\n\r\n    const sleeve = this.addSprite({\r\n      parent: this.cardRoot,\r\n      anchor: 0.5,\r\n      width: w,\r\n      height: h,\r\n      scale: 0,\r\n      texture: \"MngCardSleeve_Default.png\",\r\n    });\r\n    sleeve.convertSubtreeTo3d();\r\n\r\n    const cardRoot = this.addContainer({ parent: this.cardRoot });\r\n\r\n    const card = this.addComponent(new CardComponent(), {\r\n      parent: cardRoot,\r\n      anchor: 0.5,\r\n    });\r\n    card.interactions.on.update(false);\r\n\r\n    this.overlayRoot = this.addContainer({ parent: cardRoot });\r\n    this.overlayRoot.visible = false;\r\n\r\n    const overlay = this.addGraphics({ parent: this.overlayRoot })\r\n      .beginFill(Color.fromHex(0x5f5f5f).i32)\r\n      .drawRoundedRect(-w / 2, -h / 2, w, h, r);\r\n    overlay.alpha = 0.6;\r\n\r\n    this.addText({\r\n      parent: this.overlayRoot,\r\n      anchor: 0.5,\r\n      text: \"Pass\",\r\n      style: {\r\n        fill: Color.WHITE.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 60,\r\n      },\r\n    });\r\n\r\n    cardRoot.convertSubtreeTo3d();\r\n\r\n    this.toggleSleeve = (ok: boolean) => {\r\n      cardRoot.scale.set(ok ? 0 : 1);\r\n      sleeve.scale.set(ok ? 1 : 0);\r\n    };\r\n\r\n    const fn = () => {\r\n      const v = this.props.card.value;\r\n      const turn = this.props.turn.value;\r\n      if (v == null) {\r\n        cardRoot.visible = false;\r\n        return;\r\n      }\r\n      cardRoot.visible = true;\r\n      card.update({ card: v, turn });\r\n    };\r\n    this.props.card.onUpdate(fn);\r\n    this.props.turn.onUpdate(fn);\r\n\r\n    let t0: number = 0;\r\n    const fn1 = (t: number) => {\r\n      const dt = t - t0;\r\n      t0 = t;\r\n      arrow.angle += (180 * dt) / 1000;\r\n      window.requestAnimationFrame(fn1);\r\n    };\r\n    window.requestAnimationFrame(fn1);\r\n  }\r\n\r\n  async uiSelectCard(card: Card) {\r\n    this.toggleSleeve(true);\r\n    this.update({ card });\r\n    const a = this.addAnimation((t) => {\r\n      const e = EaseFunc.EASE_OUT_BACK.apply(t);\r\n      this.cardRoot.x = 0;\r\n      this.cardRoot.y = EaseFunc.LINEAR.interpolate(100, 0, e);\r\n      this.cardRoot.alpha = EaseFunc.LINEAR.interpolate(0, 1, t);\r\n    });\r\n    await a.play(0.25);\r\n  }\r\n\r\n  async uiShowCard(card: Card, discard: boolean) {\r\n    this.update({ card });\r\n\r\n    const a1 = this.addAnimation((t) => {\r\n      this.cardRoot.euler.y = (Math.PI / 2) * t;\r\n    });\r\n    const a2 = this.addAnimation((t) => {\r\n      this.cardRoot.euler.y = (-Math.PI / 2) * (1 - t);\r\n    });\r\n\r\n    const dt = 0.06;\r\n    this.cardRoot.position.set(0);\r\n    this.cardRoot.alpha = 1;\r\n    this.toggleSleeve(true);\r\n    await a1.play(dt);\r\n    this.overlayRoot.visible = discard;\r\n    this.toggleSleeve(false);\r\n    await a2.play(dt);\r\n  }\r\n\r\n  async uiHideCard() {\r\n    this.toggleSleeve(false);\r\n    const a = this.addAnimation((t) => {\r\n      const e = t;\r\n      this.cardRoot.x = EaseFunc.LINEAR.interpolate(0, 50, e);\r\n      this.cardRoot.y = 0;\r\n      this.cardRoot.alpha = EaseFunc.LINEAR.interpolate(1, 0, t);\r\n    });\r\n    await a.play(0.25);\r\n    this.overlayRoot.visible = false;\r\n    this.cardRoot.position.set(0);\r\n    this.cardRoot.alpha = 1;\r\n    this.update({ card: null });\r\n  }\r\n}\r\n","import { Texture } from \"pixi.js\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport BlendGlsl from \"../shaders/Blend.glsl\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\n\r\ninterface ITimerComponentProps {\r\n  value: number;\r\n}\r\n\r\nexport class TurnMeterComponent extends Component<ITimerComponentProps> {\r\n  layout = {\r\n    width: 0,\r\n    height: 0,\r\n  };\r\n\r\n  private readonly updateFn: (v: number) => Promise<void>;\r\n\r\n  constructor() {\r\n    super({\r\n      value: 0,\r\n    });\r\n\r\n    const bgShader = this.addShader(BlendGlsl, {\r\n      uColorPrimary: Color.fromHex(0x838286).rgb01,\r\n      uColorSecondary: Color.fromHex(0x737173).rgb01,\r\n    });\r\n\r\n    const root = this.addContainer();\r\n\r\n    const bgRoot = this.addContainer({ parent: root });\r\n\r\n    const shadow = this.addGraphics({ parent: bgRoot, x: 4, y: 4 })\r\n      .beginFill(Color.BLACK.i32)\r\n      .drawCircle(0, 0, 90);\r\n    shadow.alpha = 0.4;\r\n\r\n    const panelRoot = this.addContainer({\r\n      parent: bgRoot,\r\n      filters: [bgShader],\r\n    });\r\n\r\n    this.addGraphics({ parent: panelRoot })\r\n      .beginFill(Color.WHITE.i32)\r\n      .drawCircle(0, 0, 90);\r\n\r\n    this.addSprite({\r\n      parent: panelRoot,\r\n      anchor: 0.5,\r\n      x: -5.8,\r\n      y: 20,\r\n      width: 340 * 0.5,\r\n      height: 114 * 0.5,\r\n      angle: -6,\r\n      texture: \"GftImage_44.png\",\r\n    });\r\n\r\n    this.addSprite({\r\n      parent: panelRoot,\r\n      anchor: 0.5,\r\n      x: -18,\r\n      y: 41.6,\r\n      width: 400 * 0.3,\r\n      height: 288 * 0.3,\r\n      tint: Color.fromHex(0x080808),\r\n      texture: \"GftVsResult_02.png\",\r\n    });\r\n\r\n    this.addSprite({\r\n      parent: panelRoot,\r\n      anchor: 0.5,\r\n      x: 19,\r\n      y: -34,\r\n      angle: -165.5,\r\n      width: 202 * 0.9,\r\n      height: 64 * 0.9,\r\n      texture: \"GftImage_32.png\",\r\n    });\r\n\r\n    this.addText({\r\n      parent: bgRoot,\r\n      anchor: 0.5,\r\n      x: 2,\r\n      y: -52,\r\n      text: \"Turns Left\",\r\n      alpha: 0.4,\r\n      style: {\r\n        fill: Color.BLACK.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 28,\r\n      },\r\n    });\r\n    this.addText({\r\n      parent: bgRoot,\r\n      anchor: 0.5,\r\n      x: 0,\r\n      y: -54,\r\n      text: \"Turns Left\",\r\n      style: {\r\n        fill: Color.fromHex(0xd0d0d0).i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 28,\r\n      },\r\n    });\r\n\r\n    this.lock(bgRoot);\r\n\r\n    const counterRoot = this.addContainer({ parent: root });\r\n    const counter1 = this.addText({\r\n      parent: counterRoot,\r\n      anchor: 0.5,\r\n      x: 5,\r\n      y: 4,\r\n      text: \"0\",\r\n      alpha: 0.4,\r\n      style: {\r\n        fill: Color.BLACK.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 76,\r\n      },\r\n    });\r\n    const counter = this.addText({\r\n      parent: counterRoot,\r\n      anchor: 0.5,\r\n      x: 0,\r\n      y: 0,\r\n      text: \"0\",\r\n      style: {\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: 76,\r\n      },\r\n    });\r\n\r\n    this.props.value.onUpdate((v) => {\r\n      counter.style.fill =\r\n        v <= 3 ? Color.fromHex(0xf04833).i32 : Color.WHITE.i32;\r\n      counter1.text = counter.text = `${v}`;\r\n    });\r\n\r\n    this.updateFn = async (v) => {\r\n      const h = 20;\r\n      const dt = 0.05;\r\n      const dt1 = 0.2;\r\n      const dt2 = 0.4;\r\n      const scale = 1.2;\r\n\r\n      const a1 = this.addAnimation((t) => {\r\n        counterRoot.y = 0;\r\n        root.scale.set(EaseFunc.LINEAR.interpolate(1, scale, t));\r\n      });\r\n\r\n      const a2 = this.addAnimation((t) => {\r\n        const e = EaseFunc.EASE_OUT_CUBIC.apply(t);\r\n        counterRoot.y = EaseFunc.LINEAR.interpolate(0, -h, e);\r\n      });\r\n\r\n      const a3 = this.addAnimation((t) => {\r\n        const e = EaseFunc.EASE_IN_CUBIC.apply(t);\r\n        counterRoot.y = EaseFunc.LINEAR.interpolate(-h, 0, e);\r\n      });\r\n\r\n      const a4 = this.addAnimation((t) => {\r\n        counterRoot.y = 0;\r\n        root.scale.set(EaseFunc.LINEAR.interpolate(scale, 1, t));\r\n      });\r\n\r\n      const sleep = async (t: number) => await this.addAnimation().play(t);\r\n\r\n      await a1.play(dt1);\r\n      await sleep(dt2);\r\n\r\n      await a2.play(dt);\r\n      this.update({ value: v });\r\n      await a3.play(dt);\r\n\r\n      await sleep(dt2);\r\n      await a4.play(dt1);\r\n    };\r\n  }\r\n\r\n  async uiUpdate(value: number) {\r\n    await this.updateFn(value);\r\n  }\r\n}\r\n","export default \"uniform vec3 uColorPrimary;\\r\\nuniform vec3 uColorSecondary;\\r\\n\\r\\nvoid main() {\\r\\n  vec4 v = texture2D(uSampler, vTextureCoord);\\r\\n  vec3 color = mix(uColorSecondary, uColorPrimary, v.x);\\r\\n  gl_FragColor = vec4(color, 1.0) * v.a;\\r\\n}\"","import { Component } from \"../Component\";\r\nimport { EventHandler } from \"./EventHandler\";\r\n\r\nexport class WheelHandler extends EventHandler {\r\n  constructor(sender: Component) {\r\n    super(\"wheel\", sender);\r\n  }\r\n\r\n  wheel(pos: Coordinate, dy: number) {}\r\n\r\n  _wheel(evt: WheelEvent): EventHandler {\r\n    this.wheel(evt, evt.deltaY);\r\n    return null;\r\n  }\r\n}\r\n","import { Texture } from \"pixi.js\";\r\nimport { ColorPalette } from \"./ColorPalette\";\r\nimport { GridComponent } from \"./GridComponent\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { SpFireTexture } from \"./SpFireTexture\";\r\n\r\ninterface ISpMeterComponentProps {\r\n  turn: Turn;\r\n  value: number;\r\n  name: string;\r\n  spAttack: number;\r\n}\r\n\r\nexport class SpMeterComponent extends Component<ISpMeterComponentProps> {\r\n  layout = {\r\n    width: 30,\r\n    height: 30,\r\n    padding: 4.5,\r\n    gutter: {\r\n      width: 8,\r\n      height: 68,\r\n      x: -20,\r\n    },\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      turn: 1,\r\n      value: 0,\r\n      name: \"Player\",\r\n      spAttack: 0,\r\n    });\r\n\r\n    const { width, height, padding, gutter: gutterLayout } = this.layout;\r\n\r\n    const y1 = 0,\r\n      y2 = height + padding;\r\n\r\n    const root1 = this.addContainer();\r\n\r\n    this.addComponent(new GridComponent(), {\r\n      parent: root1,\r\n      y: y1,\r\n    })\r\n      .update({\r\n        tileset: new Map([\r\n          [0, { texture: \"pure_black.png\", alpha: 0.7 }],\r\n          [1, { texture: \"pure_black.png\", alpha: 0.6 }],\r\n          [2, { texture: \"pure_black.png\", alpha: 0.4 }],\r\n          [3, { texture: \"pure_black.png\", alpha: 0.2 }],\r\n        ]),\r\n        matrix: {\r\n          spaces: [0, 1, 2, 3],\r\n          width: 4,\r\n          height: 1,\r\n        },\r\n        transform: {\r\n          dx: width + padding,\r\n          scale: width / 40,\r\n        },\r\n      })\r\n      .lock();\r\n\r\n    const grid = this.addComponent(new GridComponent(), {\r\n      parent: root1,\r\n      y: y1,\r\n    }).update({\r\n      tileset: new Map([\r\n        [1, \"player1_special_space.png\"],\r\n        [-1, \"player2_special_space.png\"],\r\n      ]),\r\n      transform: {\r\n        dx: width + padding,\r\n        scale: width / 40,\r\n      },\r\n    });\r\n\r\n    const spGrid = this.addComponent(new GridComponent(), {\r\n      parent: root1,\r\n      x: width / 2,\r\n      y: y1 + 3,\r\n    }).update({\r\n      tileset: new Map([\r\n        [1, SpFireTexture.P1],\r\n        [-1, SpFireTexture.P2],\r\n      ]),\r\n      transform: {\r\n        anchor: 0.5,\r\n        dx: width + padding,\r\n        scale: width / 40,\r\n      },\r\n    });\r\n\r\n    const root2 = this.addContainer({ y: y2 });\r\n    const dxy = 3;\r\n    const text1 = this.addText({\r\n      parent: root2,\r\n      x: dxy,\r\n      y: dxy,\r\n      alpha: 0.7,\r\n      style: {\r\n        fill: Color.BLACK.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: width,\r\n      },\r\n    });\r\n    const text = this.addText({\r\n      parent: root2,\r\n      style: {\r\n        fill: Color.WHITE.i32,\r\n        fontFamily: \"Splatoon\",\r\n        fontSize: width,\r\n      },\r\n    });\r\n\r\n    const gutter = this.addSprite({\r\n      x: gutterLayout.x,\r\n      width: gutterLayout.width,\r\n      height: gutterLayout.height,\r\n      texture: Texture.WHITE,\r\n    });\r\n\r\n    const fn = () => {\r\n      const turn = this.props.turn.value;\r\n      const value = this.props.value.value;\r\n      const spAttack = this.props.spAttack.value;\r\n      grid.update({\r\n        matrix: { spaces: Array(value).fill(turn), width: 100, height: 1 },\r\n      });\r\n      spGrid.update({\r\n        matrix: { spaces: Array(spAttack).fill(turn), width: 100, height: 1 },\r\n      });\r\n      if (turn > 0) {\r\n        gutter.tint = ColorPalette.Player1.primary.i32;\r\n        root1.y = y1;\r\n        root2.y = y2;\r\n      } else {\r\n        gutter.tint = ColorPalette.Player2.primary.i32;\r\n        root1.y = y2 + 3;\r\n        root2.y = y1 - 7;\r\n      }\r\n    };\r\n    this.props.turn.onUpdate(fn);\r\n    this.props.value.onUpdate(fn);\r\n    this.props.spAttack.onUpdate(fn);\r\n    this.props.name.onUpdate((v) => (text1.text = text.text = v));\r\n  }\r\n\r\n  async uiUpdate(value: number): Promise<any> {\r\n    this.update({ value });\r\n    // for (let i = 0; i < count; ++i) {\r\n    //   this.spaces[i].update({ value: this.turn * Spaces.SPECIAL });\r\n    //   // .uiUpdate(this.turn * Spaces.SPECIAL);\r\n    // }\r\n  }\r\n}\r\n","import { Sprite, Texture } from \"pixi.js\";\r\nimport { CardPlacement } from \"../../core/Board\";\r\nimport { GameController } from \"../../core/GameController\";\r\nimport { BoardComponent } from \"../2d/BoardComponent\";\r\nimport { HandComponent } from \"../2d/HandComponent\";\r\nimport { SpCutInAnimation } from \"../2d/SpCutInAnimation\";\r\nimport { PixiScene } from \"../2d/pixi/Scene\";\r\nimport { ColorPalette } from \"../2d/ColorPalette\";\r\nimport { Color } from \"../2d/pixi/Color\";\r\nimport { SzMeterComponent } from \"../2d/SzMeterComponent\";\r\nimport { GamePlayCardComponent } from \"../2d/GamePlayCardComponent\";\r\nimport { TurnMeterComponent } from \"../2d/TurnMeterComponent\";\r\nimport { EaseFunc } from \"../2d/pixi/animations/Ease\";\r\nimport { ButtonComponent } from \"../2d/ButtonComponent\";\r\nimport { PointerHandler } from \"../2d/pixi/events/PointerHandler\";\r\nimport { TargetAnimation } from \"../2d/pixi/animations/TargetAnimation\";\r\nimport { WheelHandler } from \"../2d/pixi/events/WheelHandler\";\r\nimport { SpMeterComponent } from \"../2d/SpMeterComponent\";\r\nimport { Card } from \"../../core/Card\";\r\nimport { Platform } from \"../2d/pixi/Platform\";\r\n\r\nexport class GamePlayScene extends PixiScene {\r\n  private readonly board: BoardComponent;\r\n  private readonly hand: HandComponent;\r\n  private readonly szMeter: SzMeterComponent;\r\n  private readonly turnMeter: TurnMeterComponent;\r\n  private readonly overlay: Sprite;\r\n  private readonly spCutInAnim: SpCutInAnimation;\r\n  private readonly card1: GamePlayCardComponent;\r\n  private readonly card2: GamePlayCardComponent;\r\n  private readonly spMeter1: SpMeterComponent;\r\n  private readonly spMeter2: SpMeterComponent;\r\n  private readonly skipBtn: ButtonComponent;\r\n  private readonly spAttackBtn: ButtonComponent;\r\n\r\n  private handId: number = -1;\r\n  private spAttack: TargetAnimation<number>;\r\n\r\n  layout = {\r\n    width: 1920,\r\n    height: 1080,\r\n    board: {\r\n      x: 194,\r\n      y: -16,\r\n      width: 768,\r\n      height: 1040,\r\n    },\r\n    szMeter: {\r\n      x: -320,\r\n      y: -5,\r\n      inks: [\r\n        {\r\n          x: -18,\r\n          y: 80,\r\n          width: 360,\r\n          scale: 1,\r\n          angle: -25,\r\n          alpha: 0.8,\r\n          tint: ColorPalette.Player1.primary,\r\n          img: \"Ink_04.png\",\r\n        },\r\n        {\r\n          x: 42,\r\n          y: -120,\r\n          width: 360,\r\n          scale: -1,\r\n          alpha: 0.8,\r\n          tint: ColorPalette.Player2.primary,\r\n          img: \"Ink_02.png\",\r\n        },\r\n      ],\r\n    },\r\n    turnMeter: {\r\n      x: -300,\r\n      y: -350,\r\n    },\r\n    hand: {\r\n      x: -683,\r\n      y: -52,\r\n      width: 600,\r\n      height: 660,\r\n    },\r\n    card: {\r\n      x: 772,\r\n      y: -27,\r\n      p: [\r\n        {\r\n          x: 0,\r\n          y: 300,\r\n        },\r\n        {\r\n          x: 0,\r\n          y: -300,\r\n        },\r\n      ],\r\n    },\r\n    spMeter: {\r\n      p: [\r\n        {\r\n          x: -910,\r\n          y: 442,\r\n        },\r\n        {\r\n          x: -910,\r\n          y: -514,\r\n        },\r\n      ],\r\n    },\r\n  };\r\n\r\n  private controller: GameController;\r\n\r\n  constructor() {\r\n    super({\r\n      bgTint: ColorPalette.Main.bg.primary,\r\n    });\r\n\r\n    // const bgShader = this.addShader(BlendGlsl, {\r\n    //   uColorPrimary: ColorPalette.GamePlay.bg.primary.rgb01,\r\n    //   uColorSecondary: ColorPalette.GamePlay.bg.secondary.rgb01,\r\n    // });\r\n\r\n    // this.bg.texture = Texture.from(\"IngameBG.png\");\r\n    // this.bg.filters = [bgShader];\r\n\r\n    // const { state } = this.game;\r\n    const self = this;\r\n\r\n    const root = this.addContainer({\r\n      x: this.layout.width / 2,\r\n      y: this.layout.height / 2,\r\n    });\r\n\r\n    this.board = this.addComponent(new BoardComponent(), {\r\n      parent: root,\r\n      anchor: 0.5,\r\n      x: this.layout.board.x,\r\n      y: this.layout.board.y,\r\n      scale: {\r\n        width: this.layout.board.width,\r\n        height: this.layout.board.height,\r\n      },\r\n    });\r\n    this.board.onPlayerInput((e, ok) => {\r\n      if (!ok) {\r\n        this.szMeter.update({\r\n          preview: false,\r\n        });\r\n      } else {\r\n        const { board } = this.controller.state;\r\n        const { spaceCount1, spaceCount2 } = board.move([e]);\r\n        this.szMeter.update({\r\n          preview: true,\r\n          preview1: spaceCount1,\r\n          preview2: spaceCount2,\r\n        });\r\n      }\r\n    });\r\n    const updateCardRotation = (n: number) => {\r\n      const input = self.board.props.input.value;\r\n      const x = input.rotation + n;\r\n      const rotation = <Rotation>(((x % 4) + 4) % 4);\r\n      self.board.update({\r\n        input: Object.assign({}, input, { rotation }),\r\n      });\r\n    };\r\n    if (!Platform.isMobile) {\r\n      this.board.handle(\r\n        class extends WheelHandler {\r\n          wheel(pos: Coordinate, dy: number): void {\r\n            updateCardRotation(dy / 100);\r\n          }\r\n        }\r\n      );\r\n    }\r\n\r\n    this.szMeter = this.addComponent(new SzMeterComponent(), {\r\n      parent: root,\r\n      x: this.layout.szMeter.x,\r\n      y: this.layout.szMeter.y,\r\n    });\r\n\r\n    this.hand = this.addComponent(new HandComponent(), {\r\n      parent: root,\r\n      anchor: 0.5,\r\n      x: this.layout.hand.x,\r\n      y: this.layout.hand.y,\r\n      scale: {\r\n        width: this.layout.hand.width,\r\n        height: this.layout.hand.height,\r\n      },\r\n    });\r\n    this.hand.onSelectCard((handId) => {\r\n      if (handId != -1 && this.handId == handId) {\r\n        updateCardRotation(1);\r\n        return;\r\n      }\r\n      // may be null\r\n      const card = this.controller.state.player1.hand[handId];\r\n      this.handId = handId;\r\n      if (this.spAttack.targetValue) {\r\n        this.spMeter1.update({ spAttack: card ? card.meta.specialCost : 0 });\r\n      }\r\n      const input: any = { handId, card };\r\n      if (Platform.isMobile) {\r\n        if (this.board.props.input.value.pointer == null) {\r\n          const { width: w, height: h } = this.controller.state.board;\r\n          input.pointer = { x: Math.floor(w / 2), y: Math.floor(h / 2) };\r\n        }\r\n      }\r\n      this.board.update({\r\n        input: Object.assign({}, this.board.props.input.value, input),\r\n      });\r\n      this.card1.update({ card });\r\n    });\r\n\r\n    const cardRoot = this.addContainer({\r\n      parent: root,\r\n      x: this.layout.card.x,\r\n      y: this.layout.card.y,\r\n    });\r\n    cardRoot.scale.set(0.85);\r\n    [this.card1, this.card2] = this.layout.card.p.map((p) =>\r\n      this.addComponent(new GamePlayCardComponent(), {\r\n        parent: cardRoot,\r\n        anchor: 0.5,\r\n        x: p.x,\r\n        y: p.y,\r\n      })\r\n    );\r\n    this.card2.update({ turn: -1 });\r\n\r\n    [this.spMeter1, this.spMeter2] = this.layout.spMeter.p.map((p) =>\r\n      this.addComponent(new SpMeterComponent(), {\r\n        parent: root,\r\n        x: p.x,\r\n        y: p.y,\r\n      })\r\n    );\r\n    this.spMeter2.update({ turn: -1 });\r\n\r\n    this.overlay = this.addSprite({\r\n      parent: root,\r\n      anchor: 0.5,\r\n      width: this.layout.width,\r\n      height: this.layout.height,\r\n      tint: Color.BLACK,\r\n      texture: Texture.WHITE,\r\n      alpha: 0,\r\n    });\r\n    this.overlay.visible = false;\r\n\r\n    this.turnMeter = this.addComponent(new TurnMeterComponent(), {\r\n      parent: root,\r\n      anchor: 0.5,\r\n      x: this.layout.turnMeter.x,\r\n      y: this.layout.turnMeter.y,\r\n    });\r\n\r\n    const btnRoot = this.addContainer({\r\n      parent: root,\r\n      x: -682,\r\n      y: 342,\r\n    });\r\n\r\n    this.skipBtn = this.addComponent(\r\n      new ButtonComponent({ width: 220, height: 90 }),\r\n      {\r\n        parent: btnRoot,\r\n        x: -125,\r\n      }\r\n    ).update({\r\n      text: \"skipBtn\",\r\n    });\r\n    this.skipBtn.handle(\r\n      class extends PointerHandler {\r\n        tap(pos: Coordinate): void {\r\n          if (self.handId < 0) {\r\n            return;\r\n          }\r\n          const move: PlayerMovement = {\r\n            type: \"discard\",\r\n            handId: self.handId,\r\n          };\r\n          self.skipBtn.send(\"skip\", move);\r\n        }\r\n      }\r\n    );\r\n\r\n    this.spAttackBtn = this.addComponent(\r\n      new ButtonComponent({ width: 220, height: 90 }),\r\n      {\r\n        parent: btnRoot,\r\n        x: 125,\r\n      }\r\n    ).update({\r\n      text: \"spAttackBtn\",\r\n    });\r\n    this.spAttack = TargetAnimation.of(0)\r\n      .onEase(0.2, EaseFunc.EASE_IN_OUT_CUBIC)\r\n      .onTarget((t) => {\r\n        if (t > 0) {\r\n          const { state } = this.controller;\r\n          const mask = state.player1.hand.map(\r\n            (card) => card.meta.specialCost <= state.player1.specialPoints\r\n          );\r\n          this.hand.uiUpdateFilter(mask);\r\n          this.hand.uiUpdateSpFire(mask);\r\n          if (this.handId >= 0) {\r\n            this.spMeter1.update({\r\n              spAttack: state.player1.hand[this.handId].meta.specialCost,\r\n            });\r\n          }\r\n        } else {\r\n          this.hand.uiUpdateFilter();\r\n          this.hand.uiUpdateSpFire();\r\n          this.spMeter1.update({ spAttack: 0 });\r\n        }\r\n        this.board.update({\r\n          input: Object.assign({}, this.board.props.input.value, {\r\n            isSpecialAttack: Boolean(t),\r\n          }),\r\n        });\r\n      })\r\n      .onUpdate((t) => {\r\n        const color = EaseFunc.LINEAR.interpolate(\r\n          Color.BLACK,\r\n          ColorPalette.Main.activeBtn,\r\n          t\r\n        );\r\n        this.spAttackBtn.update({ color });\r\n      });\r\n    this.spAttackBtn.handle(\r\n      class extends PointerHandler {\r\n        tap(pos: Coordinate): void {\r\n          const v = 1 - self.spAttack.targetValue;\r\n          self.spAttack.update(v);\r\n        }\r\n      }\r\n    );\r\n\r\n    // const spMeter = new SpMeterComponent(1);\r\n    // spMeter.scaleToFit(20);\r\n    // spMeter.position.set(38, 654);\r\n    // spMeter.uiUpdate(2);\r\n    // this.addChild(spMeter);\r\n\r\n    this.spCutInAnim = new SpCutInAnimation();\r\n    this.spCutInAnim.scaleToFit(this.layout.width, this.layout.height);\r\n    this.addChild(this.spCutInAnim);\r\n  }\r\n\r\n  reset(record: GameRecord) {\r\n    this.controller = GameController.fromGameRecord(record);\r\n    const { state } = this.controller;\r\n    this.board.uiReset(state.board);\r\n    this.szMeter.update({\r\n      value1: state.board.spaceCount1,\r\n      value2: state.board.spaceCount2,\r\n    });\r\n    this.spMeter1.update({\r\n      value: state.player1.specialPoints,\r\n    });\r\n    this.spMeter2.update({\r\n      value: state.player2.specialPoints,\r\n    });\r\n  }\r\n\r\n  async run() {\r\n    const { state } = this.controller;\r\n    this.hand.update({ cards: state.player1.hand.slice() });\r\n    this.turnMeter.update({ value: 12 });\r\n\r\n    for (let i = 12; i > 0; --i) {\r\n      const [m1, m2] = await this.getInputs();\r\n\r\n      const { state: prevState } = this.controller;\r\n      const state = this.controller.move(m1, m2);\r\n\r\n      this.hand.uiSelectCard();\r\n      this.szMeter.update({ preview: false });\r\n\r\n      const sleep = async (t: number) => this.addAnimation().play(t);\r\n      const dt = 0.75;\r\n\r\n      let card1: Card, card2: Card;\r\n      let sp1 = prevState.player1.specialPoints;\r\n      let sp2 = prevState.player2.specialPoints;\r\n      if (m1.type == \"special\") {\r\n        card1 = state.player1.card;\r\n        sp1 -= card1.meta.specialCost;\r\n      }\r\n      if (m2.type == \"special\") {\r\n        card2 = state.player2.card;\r\n        sp2 -= card1.meta.specialCost;\r\n      }\r\n      if (card1 || card2) {\r\n        await this.spCutInAnim.uiPlay(card1, card2);\r\n        this.spMeter1.uiUpdate(sp1);\r\n        this.spMeter2.uiUpdate(sp2);\r\n      }\r\n\r\n      await Promise.all([\r\n        this.card1.uiShowCard(state.player1.card, m1.type == \"discard\"),\r\n        this.card2.uiShowCard(state.player2.card, m2.type == \"discard\"),\r\n      ]);\r\n\r\n      for (const li of state.cardPlacements) {\r\n        await sleep(dt);\r\n        await this.board.uiPlaceCards(li);\r\n      }\r\n\r\n      if (\r\n        state.board.specialPoints1 != prevState.board.specialPoints1 ||\r\n        state.board.specialPoints2 != prevState.board.specialPoints2\r\n      ) {\r\n        await sleep(dt);\r\n        this.board.uiUpdateFire();\r\n      }\r\n\r\n      await sleep(dt);\r\n      await Promise.all([\r\n        this.szMeter.uiUpdate(state.board.spaceCount1, state.board.spaceCount2),\r\n        this.spMeter1.uiUpdate(state.player1.specialPoints),\r\n        this.spMeter2.uiUpdate(state.player2.specialPoints),\r\n      ]);\r\n\r\n      await Promise.all([\r\n        this.hand.uiDrawCard(state.player1.hand[m1.handId], m1.handId),\r\n        this.card1.uiHideCard(),\r\n        this.card2.uiHideCard(),\r\n      ]);\r\n\r\n      const alpha = 0.5;\r\n      const a1 = this.addAnimation((t) => {\r\n        this.overlay.alpha = EaseFunc.LINEAR.interpolate(0, alpha, t);\r\n      });\r\n      const a2 = this.addAnimation((t) => {\r\n        this.overlay.alpha = EaseFunc.LINEAR.interpolate(alpha, 0, t);\r\n      });\r\n\r\n      this.overlay.visible = true;\r\n      await Promise.all([\r\n        a1\r\n          .play(0.2)\r\n          .then(() => this.addAnimation().play(1))\r\n          .then(() => a2.play(0.2)),\r\n        this.turnMeter.uiUpdate(i - 1),\r\n      ]);\r\n      this.overlay.visible = false;\r\n    }\r\n  }\r\n\r\n  getInputs(): Promise<PlayerMovement[]> {\r\n    const p1 = this.getValidPlayerInput();\r\n    const p2 = this.getRivalInput();\r\n    return Promise.all([p1, p2]);\r\n  }\r\n\r\n  async getRivalInput(): Promise<PlayerMovement> {\r\n    await this.addAnimation().play(0.5);\r\n    const m: PlayerMovement = {\r\n      type: \"discard\",\r\n      handId: 0,\r\n    };\r\n\r\n    const { state } = this.controller;\r\n    await this.card2.uiSelectCard(state.player2.hand[m.handId]);\r\n\r\n    return m;\r\n  }\r\n\r\n  async getValidPlayerInput(): Promise<PlayerMovement> {\r\n    let move: PlayerMovement;\r\n    this.board.update({\r\n      input: {\r\n        card: null,\r\n        rotation: 0,\r\n        pointer: null,\r\n        isSpecialAttack: false,\r\n      },\r\n      acceptInput: true,\r\n    });\r\n\r\n    const { state } = this.controller;\r\n    do {\r\n      move = await Promise.race([\r\n        this.getPlayerInputFromBoard(),\r\n        this.skipBtn.receive(\"skip\"),\r\n      ]);\r\n      if (state.isValidMovement(1, move)) {\r\n        break;\r\n      }\r\n      console.log(\"invalid movement:\", move);\r\n    } while (1);\r\n    console.log(move);\r\n\r\n    const card = state.player1.hand[move.handId];\r\n    this.board.update({ acceptInput: false });\r\n    this.spAttack.update(0);\r\n    await this.card1.uiSelectCard(card);\r\n\r\n    return move;\r\n  }\r\n\r\n  async getPlayerInputFromBoard(): Promise<PlayerMovement> {\r\n    // TODO: Promise.race();\r\n    const input: CardPlacement = await this.board.receive(\"player.input\");\r\n    const { handId, isSpecialAttack } = <any>this.board.props.input.value;\r\n    const { rotation, position } = input;\r\n    return {\r\n      type: isSpecialAttack ? \"special\" : \"trivial\",\r\n      handId,\r\n      params: {\r\n        rotation,\r\n        position,\r\n      },\r\n    };\r\n  }\r\n}\r\n","import { Filter, Texture } from \"pixi.js\";\r\nimport { App } from \"../2d/pixi/App\";\r\nimport { PixiScene, LoadingAnimation } from \"../2d/pixi/Scene\";\r\nimport InkResetGlsl from \"../shaders/InkReset.glsl\";\r\n\r\nexport class InkResetAnimation extends PixiScene implements LoadingAnimation {\r\n  private readonly shader: Filter;\r\n\r\n  private readonly velocity = 3.5;\r\n  private readonly wavelength = 0.2;\r\n  private readonly amplitude = this.wavelength / (2 * Math.PI);\r\n\r\n  layout = {\r\n    width: 1280,\r\n    height: 720,\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.shader = this.addShader(InkResetGlsl, {\r\n      uVelocity: this.velocity,\r\n      uWavelength: this.wavelength,\r\n      uAmplitude: this.amplitude,\r\n      uPhase: 0.0,\r\n      uTime: 0.0,\r\n      uColorPrimary: [0.21, 0.14, 0.45],\r\n      uColorSecondary: [0.22, 0.15, 0.46],\r\n      uThunderPattern: App.texture(\"thunder_pattern.png\"),\r\n    });\r\n\r\n    this.bg.filters = [this.shader];\r\n  }\r\n\r\n  play<T>(payload: () => Promise<T>): Promise<T> {\r\n    let resolve: (val: T) => void;\r\n    const ret = new Promise<T>((resolve1) => {\r\n      resolve = resolve1;\r\n    });\r\n\r\n    let done = false;\r\n    let val: T = null;\r\n    let t0: number = null;\r\n    const phase0 = (t: number) => {\r\n      this.shader.uniforms.uPhase = 0;\r\n      if (t0 == null) {\r\n        t0 = t;\r\n      }\r\n      t = (t - t0) / 1000;\r\n      this.shader.uniforms.uTime = t;\r\n      if (t * this.velocity > 1.1 + 2 * this.amplitude) {\r\n        window.requestAnimationFrame((t) => {\r\n          payload().then((val1) => {\r\n            done = true;\r\n            val = val1;\r\n          });\r\n          phase1(t);\r\n        });\r\n      } else {\r\n        window.requestAnimationFrame(phase0);\r\n      }\r\n    };\r\n    const phase1 = (t: number) => {\r\n      this.shader.uniforms.uPhase = 1;\r\n      if (done) {\r\n        t0 = null;\r\n        window.requestAnimationFrame(phase2);\r\n      } else {\r\n        window.requestAnimationFrame(phase1);\r\n      }\r\n    };\r\n    const phase2 = (t: number) => {\r\n      this.shader.uniforms.uPhase = 2;\r\n      if (t0 == null) {\r\n        t0 = t;\r\n      }\r\n      t = (t - t0) / 1000;\r\n      this.shader.uniforms.uTime = t;\r\n      if (t * this.velocity > 1.1 + 2 * this.amplitude) {\r\n        window.requestAnimationFrame(() => {\r\n          resolve(val);\r\n        });\r\n      } else {\r\n        window.requestAnimationFrame(phase2);\r\n      }\r\n    };\r\n    window.requestAnimationFrame(phase0);\r\n\r\n    return ret;\r\n  }\r\n}\r\n","export default \"uniform float uVelocity;\\r\\nuniform float uWavelength;\\r\\nuniform float uAmplitude;\\r\\nuniform float uPhase;\\r\\nuniform float uTime;\\r\\nuniform vec3 uColorPrimary;\\r\\nuniform vec3 uColorSecondary;\\r\\nuniform sampler2D uThunderPattern;\\r\\n\\r\\nconst float PI = 3.141592654;\\r\\n\\r\\nfloat wavey() {\\r\\n  float x = vVertexPosition.x * 2.0 * PI / uWavelength;\\r\\n  float y = uAmplitude * (sin(x) - 1.0) + uTime * uVelocity;\\r\\n  return y;\\r\\n}\\r\\n\\r\\nvec3 thunder() {\\r\\n  float ratio = inputSize.x / inputSize.y;\\r\\n  vec2 scale = vec2(ratio, 1.0) * 2.0;\\r\\n  vec3 v = texture2D(uThunderPattern, vVertexPosition * scale).rgb;\\r\\n  v = mix(uColorSecondary, uColorPrimary, v);\\r\\n  return v;\\r\\n}\\r\\n\\r\\nvec4 phase0() {\\r\\n  if (vVertexPosition.y > wavey()) {\\r\\n    return vec4(0.0);\\r\\n  } else {\\r\\n    return vec4(thunder(), 1.0);\\r\\n  }\\r\\n}\\r\\n\\r\\nvec4 phase1() {\\r\\n  return vec4(thunder(), 1.0);\\r\\n}\\r\\n\\r\\nvec4 phase2() {\\r\\n  if (vVertexPosition.y < wavey()) {\\r\\n    return vec4(0.0);\\r\\n  } else {\\r\\n    return vec4(thunder(), 1.0);\\r\\n  }\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n  if (uPhase < 0.5) {\\r\\n    gl_FragColor = phase0();\\r\\n  }\\r\\n  else if (uPhase < 1.5) {\\r\\n    gl_FragColor = phase1();\\r\\n  }\\r\\n  else {\\r\\n    gl_FragColor = phase2();\\r\\n  }\\r\\n}\\r\\n\"","import { Texture } from \"pixi.js\";\r\nimport { Color } from \"./pixi/Color\";\r\nimport { Component } from \"./pixi/Component\";\r\nimport { EaseFunc } from \"./pixi/animations/Ease\";\r\nimport { WheelHandler } from \"./pixi/events/WheelHandler\";\r\nimport { TargetAnimation } from \"./pixi/animations/TargetAnimation\";\r\nimport { DragHandler } from \"./pixi/events/DragHandler\";\r\nimport { getLocalPos } from \"./pixi/events/Utils\";\r\nimport regression from \"regression\";\r\n\r\ninterface IItemListComponentOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\ninterface IItemListComponentProps<T> {\r\n  items: T[];\r\n  bg: {\r\n    color: Color;\r\n    alpha: number;\r\n  };\r\n  layout: {\r\n    xlimit: number;\r\n    padding?: {\r\n      x: number;\r\n      y?: number;\r\n    };\r\n    anchor?: {\r\n      x: number;\r\n      y?: number;\r\n    };\r\n  };\r\n}\r\n\r\nexport class ItemListComponent<\r\n  T extends Component = Component\r\n> extends Component<IItemListComponentProps<T>> {\r\n  private items: T[] = [];\r\n\r\n  private height: number = 0;\r\n\r\n  constructor(options: IItemListComponentOptions) {\r\n    super({\r\n      items: [],\r\n      bg: {\r\n        color: Color.WHITE,\r\n        alpha: 0.5,\r\n      },\r\n      layout: {\r\n        xlimit: 4,\r\n      },\r\n    });\r\n\r\n    const self = this;\r\n    const { width, height } = options;\r\n    this.layout = { width, height };\r\n\r\n    const bg = this.addSprite({\r\n      width,\r\n      height,\r\n      texture: Texture.WHITE,\r\n    });\r\n\r\n    const root = this.addContainer();\r\n    root.mask = this.addSprite({\r\n      width,\r\n      height,\r\n      texture: Texture.WHITE,\r\n    });\r\n\r\n    const itemRoot = this.addContainer({\r\n      parent: root,\r\n    });\r\n    this.props.items.onUpdate((items) => {\r\n      itemRoot.removeChildren();\r\n      this.items = items.slice();\r\n      if (items.length != 0) {\r\n        const { width, height } = items[0].layout;\r\n        console.assert(\r\n          items.every(\r\n            ({ layout: { width: w, height: h } }) => width == w && height == h\r\n          )\r\n        );\r\n        items.forEach((item) => itemRoot.addChild(item.ui));\r\n        this.updateLayout();\r\n      }\r\n    });\r\n\r\n    this.props.layout.onUpdate(() => {\r\n      if (this.items.length != 0) {\r\n        this.updateLayout();\r\n      }\r\n    });\r\n\r\n    this.props.bg.onUpdate(({ color, alpha }) => {\r\n      bg.tint = color.i32;\r\n      bg.alpha = alpha;\r\n    });\r\n\r\n    const VF_SCALE = 8;\r\n    const scroll = TargetAnimation.of(0)\r\n      .onEase(0, EaseFunc.viscousFluid(VF_SCALE))\r\n      .onUpdate((y) => (itemRoot.y = -y));\r\n\r\n    this.handle(\r\n      class extends WheelHandler {\r\n        stops: EventType[] = [\"wheel\"];\r\n        wheel(pos: Coordinate, dy: number) {\r\n          const v = 1;\r\n          const dt = 0.5;\r\n          const y1 = self.height - self.layout.height;\r\n          const y = Math.max(0, Math.min(y1, scroll.targetValue - dy * v));\r\n          scroll.update(y, dt);\r\n        }\r\n      }\r\n    );\r\n    this.handle(\r\n      class extends DragHandler {\r\n        stops: EventType[] = [\"wheel\", \"drag\"];\r\n        y0: number;\r\n        li: [number, number][];\r\n        drag(pos: Coordinate): void {\r\n          this.li = [];\r\n          const y = scroll.value;\r\n          this.y0 = y + this.getLocalY(pos);\r\n          this.scrollTo(y);\r\n        }\r\n        move(pos: Coordinate): void {\r\n          const y = this.y0 - this.getLocalY(pos);\r\n          const t = performance.now();\r\n          this.li.push([t, y]);\r\n          if (this.li.length > 32) {\r\n            this.li.shift();\r\n          }\r\n          this.scrollTo(y);\r\n        }\r\n        drop(pos: Coordinate): void {\r\n          const t = performance.now();\r\n          const li = this.li.filter(([t0, _]) => t - t0 < 100);\r\n          let v = 0;\r\n          if (li.length > 1) {\r\n            const order = 1;\r\n            const e = regression.polynomial(li, { order });\r\n            e.equation.slice(0, -1).forEach((a, i) => {\r\n              const b = order - i;\r\n              v += a * b * t ** (b - 1);\r\n            });\r\n          }\r\n          const dt = 0.5;\r\n          const y = this.y0 - this.getLocalY(pos);\r\n          const dy = (dt * v * 1000) / VF_SCALE;\r\n          this.scrollTo(y + dy, dt);\r\n        }\r\n        private scrollTo(y: number, dt?: number) {\r\n          const y1 = self.height - self.layout.height;\r\n          y = Math.max(0, Math.min(y1, y));\r\n          scroll.update(y, dt);\r\n        }\r\n        private getLocalY(pos: Coordinate) {\r\n          const { height } = self.layout;\r\n          return getLocalPos(pos, this.sender).y * height;\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  private updateLayout() {\r\n    const {\r\n      xlimit,\r\n      padding = { x: 0 },\r\n      anchor = { x: 0 },\r\n    } = this.props.layout.value;\r\n    const { x: dx, y: dy = dx } = padding;\r\n    const { x: ax, y: ay = ax } = anchor;\r\n\r\n    const { width: w, height: h } = this.items[0].layout;\r\n    const w1 = (this.layout.width - (xlimit + 1) * dx) / xlimit;\r\n    const e = w1 / w;\r\n    const h1 = h * e;\r\n\r\n    const ny = Math.ceil(this.items.length / xlimit);\r\n    this.height = ny * h1 + (ny + 1) * dy;\r\n\r\n    this.items.forEach((item) => item.scaleToFit(w1, h1));\r\n    let y = 0;\r\n    for (; ; ++y) {\r\n      for (let x = 0; x < xlimit; ++x) {\r\n        const i = x + y * xlimit;\r\n        if (i >= this.items.length) {\r\n          return;\r\n        }\r\n        const item = this.items[i];\r\n        item.position.set(\r\n          (w1 + dx) * x + dx + w1 * ax,\r\n          (h1 + dy) * y + dy + h1 * ay\r\n        );\r\n        item.anchor.set(ax, ay);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Card } from \"../../core/Card\";\r\nimport { ButtonComponent } from \"../2d/ButtonComponent\";\r\nimport { CardComponent } from \"../2d/CardComponent\";\r\nimport { SmallCardComponent } from \"../2d/SmallCardComponent\";\r\nimport { ItemListComponent } from \"../2d/ItemListComponent\";\r\nimport { Color } from \"../2d/pixi/Color\";\r\nimport { PointerHandler } from \"../2d/pixi/events/PointerHandler\";\r\nimport { PixiScene } from \"../2d/pixi/Scene\";\r\nimport { Logger } from \"../2d/pixi/Logger\";\r\n\r\nexport class DeckEditScene extends PixiScene {\r\n  layout = {\r\n    width: 1920,\r\n    height: 1080,\r\n  };\r\n\r\n  private readonly cardIdMap = new Map<number, CardComponent>();\r\n  private readonly cards: SmallCardComponent[] = [];\r\n  private readonly deckView: ItemListComponent<SmallCardComponent>;\r\n\r\n  constructor() {\r\n    super({\r\n      bgTint: Color.fromHex(0x333333),\r\n    });\r\n\r\n    const self = this;\r\n    for (let i = 0; i < 15; ++i) {\r\n      const card = new SmallCardComponent().update({ card: Card.fromId(1) });\r\n      card.interactions.onTap(() => {\r\n        const items = this.deckView.props.items.value.slice();\r\n        const idx = items.findIndex((e) => e == card);\r\n        Logger.assert(idx != -1);\r\n        items.splice(idx, 1);\r\n        const { id } = card.props.card.value.meta;\r\n        this.cardIdMap.get(id).interactions.disabled.update(false);\r\n        this.deckView.update({ items });\r\n      });\r\n      this.cards.push(card);\r\n    }\r\n\r\n    // init card collection\r\n    for (let i = 1; i <= 162; ++i) {\r\n      const card = new CardComponent();\r\n      card.update({ card: Card.fromId(i) });\r\n      card.interactions.onTap(() => {\r\n        const items = this.deckView.props.items.value.slice();\r\n        if (items.length >= 15) {\r\n          return;\r\n        }\r\n        const { id } = card.props.card.value.meta;\r\n        const idx = items.findIndex(\r\n          (card) => card.props.card.value.meta.id == id\r\n        );\r\n        Logger.assert(idx == -1);\r\n        for (const card of this.cards) {\r\n          if (!items.includes(card)) {\r\n            card.update({ card: Card.fromId(id) });\r\n            items.push(card);\r\n            this.deckView.update({ items });\r\n            this.cardIdMap.get(id).interactions.disabled.update(true);\r\n            return;\r\n          }\r\n        }\r\n        Logger.unreachable();\r\n      });\r\n      this.cardIdMap.set(i, card);\r\n    }\r\n\r\n    // init collection view\r\n    this.addComponent(\r\n      new ItemListComponent({\r\n        width: 1460,\r\n        height: 1080,\r\n      })\r\n    ).update({\r\n      items: Array.from(this.cardIdMap.values()),\r\n      layout: {\r\n        xlimit: 7,\r\n        padding: {\r\n          x: 20,\r\n        },\r\n        anchor: {\r\n          x: 0.5,\r\n        },\r\n      },\r\n    });\r\n\r\n    // init deck view\r\n    this.deckView = this.addComponent(\r\n      new ItemListComponent<SmallCardComponent>({\r\n        width: 460,\r\n        height: 1080,\r\n      }),\r\n      {\r\n        x: 1460,\r\n      }\r\n    ).update({\r\n      bg: {\r\n        color: Color.fromHex(0x101010),\r\n        alpha: 1,\r\n      },\r\n      layout: {\r\n        xlimit: 3,\r\n        padding: {\r\n          x: 10,\r\n        },\r\n        anchor: {\r\n          x: 0.5,\r\n        },\r\n      },\r\n    });\r\n\r\n    this.addComponent(\r\n      new ButtonComponent({\r\n        width: 200,\r\n        height: 80,\r\n      }),\r\n      {\r\n        x: 1800,\r\n        y: 1020,\r\n      }\r\n    )\r\n      .update({\r\n        text: \"okBtn\",\r\n      })\r\n      .handle(\r\n        class extends PointerHandler {\r\n          tap(pos: Coordinate): void {\r\n            self.send(\"action\", {\r\n              ok: true,\r\n              deck: self.deckView.props.items.value.map(\r\n                (e) => e.props.card.value.meta.id\r\n              ),\r\n            });\r\n          }\r\n        }\r\n      );\r\n\r\n    this.addComponent(\r\n      new ButtonComponent({\r\n        width: 200,\r\n        height: 80,\r\n      }),\r\n      {\r\n        x: 1580,\r\n        y: 1020,\r\n      }\r\n    )\r\n      .update({\r\n        text: \"cancelBtn\",\r\n      })\r\n      .handle(\r\n        class extends PointerHandler {\r\n          tap(pos: Coordinate): void {\r\n            self.send(\"action\", {\r\n              ok: false,\r\n            });\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  reset(deck: number[]) {\r\n    this.cardIdMap.forEach((card, id) => {\r\n      card.interactions.disabled.update(deck.includes(id));\r\n    });\r\n    this.deckView.update({\r\n      items: deck.map((id, i) =>\r\n        this.cards[i].update({ card: Card.fromId(id) })\r\n      ),\r\n    });\r\n  }\r\n}\r\n","import { Card } from \"../core/Card\";\r\nimport { App } from \"./2d/pixi/App\";\r\nimport { EntryScene } from \"./scripts/EntryScene\";\r\nimport { GamePlayScene } from \"./scripts/GamePlayScene\";\r\nimport { InkResetAnimation } from \"./scripts/InkResetAnimation\";\r\nimport { DeckEditScene } from \"./scripts/DeckEditScene\";\r\nimport { shuffle } from \"../core/Utils\";\r\nimport { TestScene } from \"./scripts/TestScene\";\r\n\r\nexport async function main() {\r\n  const inkReset = new InkResetAnimation();\r\n  const game = new GamePlayScene();\r\n  const deckEdit = new DeckEditScene();\r\n\r\n  // const test = new TestScene();\r\n  // App.run(test);\r\n  // return;\r\n\r\n  let deck = [33, 159, 92, 25, 30, 52, 65, 50, 66, 64, 53, 58, 28, 74, 69];\r\n\r\n  const entry = new EntryScene();\r\n  App.run(entry);\r\n\r\n  const loopFn = async () => {\r\n    const action = await entry.receive(\"action\");\r\n    switch (action) {\r\n      case \"gamePlay\":\r\n        {\r\n          App.wait(inkReset, async () => {\r\n            game.reset({\r\n              board: 6,\r\n              decks: [\r\n                shuffle(deck),\r\n                [\r\n                  86, 110, 105, 161, 53, 118, 125, 69, 109, 20, 143, 44, 12,\r\n                  113, 75,\r\n                ],\r\n              ],\r\n            });\r\n            App.run(game);\r\n          });\r\n          // await\r\n        }\r\n        break;\r\n      case \"deckEdit\":\r\n        {\r\n          App.wait(inkReset, async () => {\r\n            deckEdit.reset(deck);\r\n            App.run(deckEdit);\r\n          });\r\n          const { ok, deck: newDeck } = await deckEdit.receive(\"action\");\r\n          if (ok && newDeck.length == 15) {\r\n            deck = newDeck.slice();\r\n          }\r\n          App.wait(inkReset, async () => {\r\n            App.run(entry);\r\n          });\r\n        }\r\n        break;\r\n    }\r\n  };\r\n\r\n  while (true) {\r\n    await loopFn();\r\n  }\r\n}\r\n"],"names":["module","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_toConsumableArray","arr","Array","isArray","arr2","from","DEFAULT_OPTIONS","order","precision","period","determinationCoefficient","data","results","predictions","observations","forEach","d","push","mean","reduce","a","observation","ssyy","difference","accum","index","prediction","residual","round","number","factor","Math","pow","methods","linear","options","sum","len","n","run","rise","gradient","intercept","predict","x","points","map","point","equation","r2","string","exponential","log","denominator","exp","b","coeffA","coeffB","logarithmic","power","polynomial","lhs","rhs","k","l","c","j","_l","coefficients","input","matrix","maxrow","abs","tmp","_j","_k","_j2","total","_k2","gaussianElimination","v","coeff","_i","concat","reverse","exports","keys","accumulator","name","_round","value","supplied","obj","defineProperty","enumerable","configurable","writable","randomUUID","crypto","bind","getRandomValues","rnds8","Uint8Array","rng","Error","byteToHex","toString","slice","buf","offset","rnds","random","toLowerCase","unsafeStringify","type","sender","id","stops","allowFire","this","_bootstrap","setPrototypeOf","_pointermove","pos","_pointerdown","_pointerup","_wheel","evt","triggerThresholdPx","doubleTapThresholdMs","_first","_pos","_lastTapTime","enter","move","down","up","tap","doubleTap","leave","_pointerout","y","sqrt","time","performance","now","EventHandler","mUpdateFunc","mTargetFunc","mEaseSec","mEaseFunc","Ease","mEaseState","cancel","mTargetValue","onUpdate","func","onTarget","onEase","sec","update","v1","resolve","p","Promise","_resolve","t0","v0","fn","t","nextFn","isNaN","interpolate","window","requestAnimationFrame","of","TargetAnimation","color","Color","text","width","height","radius","layout","bg","addGraphics","beginFill","drawRoundedRect","text1","addText","anchor","style","fontSize","fontFamily","fill","overlay","alpha","set","scale","handle","PointerHandler","props","tint","i32","Component","Space","normal","special","invalid","flash","primary","secondary","Main","activeBtn","inactiveBtn","btn","Player1","fire","center","spCutIn","fg","ink","img","szMeter","Player2","bgTint","bgAlpha","addSprite","texture","zIndex","setTimeout","mount","root","canvas","position","scaleToFit","addChild","toggleVisibility","ok","ui","visible","document","createElement","classList","add","appendChild","remove","ColorPalette","self","addComponent","ButtonComponent","send","PixiScene","parse","str","spaces","charAt","Spaces","dx","console","assert","print","m","meta","specialPoints1","specialPoints2","spaceCount1","spaceCount2","get","absv","isCharged","ms","turn","li","Set","board","Board","card","rotate","rotation","has","EIGHT_NEIGHBOURS","dy","p1","isValidPosition","isValidMovement","isSpecialAttack","neighbour","_","pos1","MatrixUtil","space","fromId","ID_LOOKUP","fromName","NAME_LOOKUP","Map","MiniGameBoardInfo","info","spaceCount","filter","Card","ROTATION_MATRICES","e","f","rarity","specialCost","shuffle","floor","temp","cards","Deck","fromCardIds","cardIds","fromPreset","deck","match","deckName","hand","specialPoints","movement","handId","cardId","pop","PlayerState","player1","player2","cardPlacements","m1","m2","JSON","stringify","p2","earnSpecialPoints1","earnSpecialPoints2","params","dn","GameState","player","initial","deck1","deck2","states","stateId","onNewState","forward","to","onNewStateCallback","state","backward","splice","callback","fromGameRecord","record","decks","moves","GameController","tileset","transform","addContainer","tilemap","clear","size","values","next","App","w","h","sx","sy","ax","ay","spec","tile","tileWidth","tileHeight","animate","mTexture","renderTexture","border","drawRect","s","V","EmptySpaceTexture","V50","RenderBuffer","r","shader","addShader","uColorPrimary","uColorSecondary","uAlphaSampler","uFlameSampler","uDistortionSampler","filters","circle","uniforms","rgb01","P1","SpFireTexture","P2","uValue","uScale","uAngle","uAngleV","uPatternSampler","angle","angleV","file","OverlayTexture","drag","drop","Logger","pointer","acceptInput","nrmOverlay","spOverlay","lk","onPlayerInputFn","w1","hitbox","parent","GridComponent","e1","e2","tileAlpha","spFire","flashAnimation","addAnimation","keyframe","getGridPos","sendPlayerInput","selection","play","Platform","wp","dp","DragHandler","uiUpdateInput","uiReset","lock","uiUpdateFire","uiPlaceCards","onPlayerInput","getAdjustedCardPosition","rotatedCard","xs","ys","minX","min","maxX","max","minY","maxY","flat","nrmTiles","flatTiles","opts","ease","v2","dt2","dt1","dt","dts","uTime0","uLightDsSampler","uGlowSampler","reset","HoverGlowTexture","on","Cell","disabled","selected","onTapFn","overlay1","glow","mask","cardTilt","overlayAlpha","overlayAlpha1","cardClickAnim","PulseAnimation","s0","hover","interaction","ok0","toggle","onTap","install","CardInteractions","padding","boardScale","bgColor","margin","spMeter","spMeterLayout","szMeterLayout","cardRoot","grid","CardGridComponent","spMeterRoot","sxy","tiles1","tiles2","spFireGrid","interactions","selectCardId","paddingX","paddingY","idx","SmallCardComponent","uiSelectCard","onSelectCard","uiDrawCard","a1","a2","selectCardCallBack","uiUpdateFilter","uiUpdateSpFire","card1","card2","cutin","ink1","ink2","y0","y1","anims","bgShader","uColorFgPrimary","uColorFgSecondary","uColorBg","imgShader","uColor","ciRoot","ci1","inkRoot","inkRoot1","imgLayout","imgRoot","imgRoot1","img1","a3","a4","sleep","all","then","uiPlay","inkbeat","bgRoot","value1","value2","preview","preview1","preview2","skew","PI","text2","previewRoot","ib","InkBeatComponent","inkbeat1","inkbeat2","playFn","dv1","dv2","uiUpdate","frame","dxy","cardName","cardName1","strokeThickness","szMeterRoot","szMeterBg","szMeter1","l0","Common","Rare","Fresh","l1","indexOf","h1","r1","beginHole","arrow","camera","setPlanes","sleeve","convertSubtreeTo3d","CardComponent","overlayRoot","toggleSleeve","fn1","uiShowCard","discard","euler","uiHideCard","drawCircle","panelRoot","counterRoot","counter1","counter","updateFn","wheel","deltaY","spAttack","gutter","gutterLayout","y2","root1","spGrid","root2","inks","turnMeter","BoardComponent","controller","updateCardRotation","WheelHandler","SzMeterComponent","HandComponent","targetValue","spMeter1","GamePlayCardComponent","SpMeterComponent","spMeter2","TurnMeterComponent","btnRoot","skipBtn","spAttackBtn","Boolean","spCutInAnim","SpCutInAnimation","getInputs","prevState","sp1","sp2","getValidPlayerInput","getRivalInput","race","getPlayerInputFromBoard","receive","velocity","wavelength","amplitude","uVelocity","uWavelength","uAmplitude","uPhase","uTime","uThunderPattern","payload","ret","resolve1","done","val","phase0","val1","phase1","phase2","items","xlimit","itemRoot","removeChildren","every","item","updateLayout","scroll","getLocalY","scrollTo","shift","ny","ceil","cardIdMap","deckView","findIndex","includes","ItemListComponent","main","inkReset","InkResetAnimation","game","GamePlayScene","deckEdit","DeckEditScene","entry","EntryScene","loopFn","newDeck"],"sourceRoot":""}